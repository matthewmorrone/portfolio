/**
 * almond 0.2.7 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

//     Underscore.js 1.5.2
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*
 * CutJS
 * Copyright (c) 2013-2014 Ali Shakiba, Piqnt LLC and other contributors
 * Available under the MIT license
 * @license
 */

/*
 * ExtraJS
 * Copyright (c) 2013-2014 Ali Shakiba, Piqnt LLC and other contributors
 * Available under the MIT license
 * @license
 */

function checkDomain(e){var t=document.location.hostname;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])!=-1)return!0}function Cut(){if(!(this instanceof Cut))return Cut.Loader.load.apply(Cut.Loader,arguments);Cut._stats.create++,this._id="",this._visible=!0,this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._pin=new Cut.Pin(this),this._cutouts=[],this._tickBefore=[],this._tickAfter=[],this._alpha=1}function Pool(e,t,n,r){var i=[],s=4,o="",u=0,a=0,f=0,l=0;this.create=function(t){return e=t,this},this.exit=function(e){return t=func,this},this.enter=function(e){return n=func,this},this.discard=function(e){return r=e,this},this.max=function(e){return arguments.length?(s=e,this):s},this.name=function(e){return arguments.length?(o=e,this):o},this.checkOut=function(n){var r;return i.length?r=i.shift():(u++,r=(n||e).apply(this)),a++,t&&t.call(this,r),r},this.checkIn=function(e,t){i.length<s?(f++,n&&n.call(this,e),i.push(e)):(l++,(t=t||r)&&t.call(this,e))},this.toString=function(){return"Pool ("+o+"):"+" +"+u+" >"+a+" <"+f+" -"+l+" ="+i.length+"/"+s}}function Randomize(){this._options=[],this._nope=null,this._map=function(e){return e}}function ForceLayout(e,t){this._size=[1,1],this._friction=.9,this._linkDistance=20,this._linkStrength=1,this._charge=-30,this._gravity=.1,this._theta=.8,this._minAlpha=.005,this._nodes=e,this._links=t,this._alpha=null,this._distances=null,this._strengths=null,this._charges=null,this._quad=null}function QuadTree(e){this.leaf=!0,this.quads=null,this.point=null,this.x=null,this.y=null;if(e){var t,n,r=e.length,i,s,o,u;o=u=-(i=s=Infinity);for(n=0;n<r;n++)t=e[n],t.x<i&&(i=t.x),t.y<s&&(s=t.y),t.x>o&&(o=t.x),t.y>u&&(u=t.y);var a=o-i,f=u-s;a>f?u=s+a:o=i+f;for(n=0;n<r;n++)t=e[n],this.insert(t,t.x,t.y,i,s,o,u)}}function Four(){}function BaseMode(){}function LearnMode(){}function CollectMode(){}function StreamMode(){}function SpeedMode(){}function CrossMode(){}function DesignMode(){}function CompeteMode(){}function Graph(){this.links=[],this.nodes=[]}function Item(){this.selected=!1}function Dot(){this.isNode=!0,this.id=ID++,this.links=[]}function Link(){this.isLink=!0,this.id=ID++}function Hint(){Hint.prototype._super.call(this),this.isHint=!0}function Marker(e,t){var n=null;return this.insert=function(){return this.onInsert(e),this},this.update=function(e){return e&&(this.same(e)||t&&t.same(e))?this:(this.onUpdate(n=e),this)},this.tick=function(){return this.onUpdate(n),this},this.same=function(e){return n&&e&&n.x==e.x&&n.y==e.y},this}function DragLine(){var e=null,t=null;return this.update=function(n,r){return this.onUpdate(t=n,e=r),this},this.tick=function(){return this.onUpdate(t,e),this},this.insert=function(){return this.onInsert(),this},this}function Line(){Line.prototype._super.apply(this,arguments),this.x=0,this.y=0,this.dx=0,this.dy=0,this.pin({pivot:.5,handle:.5}),this.tick(function(){this.duration&&this.time&&this.draw((+(new Date)-this.time)%this.duration/this.duration)})}var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),E=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!E)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.2";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else{var o=x.keys(e);for(var i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)return}};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return arguments.length<2||n?e[x.random(e.length-1)]:x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={},s=n==null?x.identity:k(n);return T(t,function(n,o){var u=s.call(r,n,o,t);e(i,u,n)}),i}};x.groupBy=L(function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u;return function(){s=this,i=arguments,o=new Date;var a=function(){var f=new Date-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i)))},f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i)),u}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},x.pairs=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){var t={},n=x.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(){});const DEBUG=!1,HELP=!1;!checkDomain(["piqnt.com"]),define("def",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,Cut._create=function(){if(typeof Object.create=="function")return function(){return Object.create.apply(null,arguments)};var e=function(){};return function(t){if(arguments.length>1)throw Error("Second argument is not supported!");if(t===null||typeof t!="object")throw Error("Invalid prototype!");return e.prototype=t,new e}}(),Cut._stats={create:0,tick:0,paint:0,paste:0},Cut.create=function(){return new Cut},Cut.prototype.render=function(e){Cut._stats.tick=Cut._stats.paint=Cut._stats.paste=0;var t=Cut._now(),n=this._lastTime?t-this._lastTime:0;this._lastTime=t,this._tick(n),this._paint(e),Cut._stats.fps=1e3/(Cut._now()-t)},Cut.prototype.MAX_ELAPSE=Infinity,Cut.prototype._tick=function(e){if(!this._visible)return;e>this.MAX_ELAPSE&&(e=this.MAX_ELAPSE),this._pin.tick();var t=this._tickBefore.length;for(var n=0;n<t;n++)Cut._stats.tick++,this._tickBefore[n].call(this,e);var r,i=this._first;while(r=i)i=r._next,r._tick(e);var t=this._tickAfter.length;for(var n=0;n<t;n++)Cut._stats.tick++,this._tickAfter[n].call(this,e)},Cut.prototype.tick=function(e,t){t?this._tickBefore.push(e):this._tickAfter.push(e)},Cut.prototype.untick=function(e){var t;!e||((t=this._tickBefore.indexOf(e))>=0?this._tickBefore.splice(t,1):(t=this._tickAfter.indexOf(e))>=0&&this._tickAfter.splice(t,1))},Cut.prototype._paint=function(e){if(!this._visible)return;Cut._stats.paint++;var t=this._pin.absoluteMatrix();e.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;e.globalAlpha!=n&&(e.globalAlpha=n);var r=this._cutouts.length;for(var i=0;i<r;i++)this._cutouts[i].paste(e);e.globalAlpha!=this._alpha&&(e.globalAlpha=this._alpha);var s,o=this._first;while(s=o)o=s._next,s._paint(e)},Cut.prototype.toString=function(){return"["+this._id+"]"},Cut.prototype.id=function(e){return arguments.length?(this._id=e,this):this._id},Cut.prototype.attr=function(e,t){return arguments.length<2?this._attrs?this._attrs[e]:undefined:((this._attrs?this._attrs:this._attrs={})[e]=t,this)},Cut.prototype.on=Cut.prototype.listen=function(e,t){if(typeof t!="function")return this;e=(Cut._isArray(e)?e.join(" "):e).split(/\s+/);for(var n=0;n<e.length;n++){var r=e[n];r&&(this._listeners=this._listeners||{},this._listeners[r]=this._listeners[r]||[],this._listeners[r].push(t))}return this},Cut.prototype.listeners=function(e){return this._listeners&&this._listeners[e]},Cut.prototype.publish=function(e,t){var n=this.listeners(e);if(!n||!n.length)return!1;for(var r=0;r<n.length;r++)n[r].apply(this,t);return!0},Cut.prototype.visit=function(e){var t=e.reverse,n=e.visible;if(e.start&&e.start(this))return;var r,i=t?this.last(n):this.first(n);while(r=i){i=t?r.prev(n):r.next(n);if(r.visit(e,t))return!0}return e.end&&e.end(this)},Cut.prototype.visible=function(e){return arguments.length?(this._visible=e,this._parent&&(this._parent._ts_children=Cut._TS++),this._ts_pin=Cut._TS++,this.touch(),this):this._visible},Cut.prototype.hide=function(){return this.visible(!1)},Cut.prototype.show=function(){return this.visible(!0)},Cut.prototype.parent=function(){return this._parent},Cut.prototype.next=function(e){var t=this._next;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.prev=function(e){var t=this._prev;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.first=function(e){var t=this._first;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.last=function(e){var t=this._last;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.append=function(){for(var e=0;e<arguments.length;e++){if(!Cut._isCut(arguments[e]))throw"It is not a Cut node!";arguments[e].appendTo(this)}return this},Cut.prototype.prepend=function(){for(var e=0;e<arguments.length;e++){if(!Cut._isCut(arguments[e]))throw"It is not a Cut node!";arguments[e].prependTo(this)}return this},Cut.prototype.appendTo=function(e){if(!e)throw"Parent is null!";if(!Cut._isCut(e))throw"It is not a Cut node!";return this.remove(),e._last&&(e._last._next=this,this._prev=e._last),this._parent=e,e._last=this,e._first||(e._first=this),this._ts_parent=Cut._TS++,e._ts_children=Cut._TS++,e.touch(),this},Cut.prototype.prependTo=function(e){if(!e)throw"Parent is null!";if(!Cut._isCut(e))throw"It is not a Cut node!";return this.remove(),e._first&&(e._first._prev=this,this._next=e._first),this._parent=e,e._first=this,e._last||(e._last=this),this._ts_parent=Cut._TS++,e._ts_children=Cut._TS++,e.touch(),this},Cut.prototype.insertNext=function(){if(arguments.length)for(var e=0;e<arguments.length;e++){if(!Cut._isCut(arguments[e]))throw"It is not a Cut node!";arguments[e]&&arguments[e].insertAfter(this)}return this},Cut.prototype.insertPrev=function(){if(arguments.length)for(var e=0;e<arguments.length;e++){if(!Cut._isCut(arguments[e]))throw"It is not a Cut node!";arguments[e]&&arguments[e].insertBefore(this)}return this},Cut.prototype.insertBefore=function(e){if(!e)throw"Next is null!";if(!Cut._isCut(e))throw"It is not a Cut node!";this.remove();var t=e._parent,n=e._prev;return e._prev=this,n&&(n._next=this)||t&&(t._first=this),this._parent=t,this._prev=n,this._next=e,this._ts_parent=Cut._TS++,this.touch(),this},Cut.prototype.insertAfter=function(e){if(!e)throw"Prev is null!";if(!Cut._isCut(e))throw"It is not a Cut node!";this.remove();var t=e._parent,n=e._next;return e._next=this,n&&(n._prev=this)||t&&(t._last=this),this._parent=t,this._prev=e,this._next=n,this._ts_parent=Cut._TS++,this.touch(),this},Cut.prototype.remove=function(){if(arguments.length){for(var e=0;e<arguments.length;e++){if(!Cut._isCut(arguments[e]))throw"It is not a Cut node!";arguments[e]&&arguments[e].remove()}return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev)),this._parent&&(this._parent._ts_children=Cut._TS++,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=Cut._TS++,this},Cut.prototype.empty=function(){var e,t=this._first;while(e=t)t=e._next,e._prev=e._next=e._parent=null;return this._first=this._last=null,this._ts_children=Cut._TS++,this.touch(),this},Cut.prototype.touch=function(){return this._ts_touch=Cut._TS++,this._parent&&this._parent.touch(),this},Cut.prototype.pin=function(){if(!arguments.length)return this._pin;var e=this._pin.update.apply(this._pin,arguments);return e===this._pin?this:e},Cut.prototype.matrix=function(){return this._pin.absoluteMatrix(this,this._parent?this._parent._pin:null)},Cut.prototype.tween=function(e,t){return(this._tween||(this._tween=new Cut.Tween(this))).tween(e,t)},Cut.Tween=function(e){var t=this;this._owner=e,this._queue=[],this._next=null,e.tick(function(n){if(!t._queue.length)return;this.touch();var r=t._queue[0];r.time?r.time+=n:r.time=1;if(r.time<r.delay)return;var i=(r.time-r.delay)/r.duration,s=i>=1;i=i>1?1:i,i=r.easing?r.easing(i):i;if(!r.start){r.start={};for(var o in r.end){var u=e.pin(o);r.start[o]=u||0}}for(var o in r.start){var a=r.start[o],f=r.end[o];e.pin(o,a+(f-a)*i)}s&&(t._queue.shift(),r.then&&r.then.call(e))},!0)},Cut.Tween.prototype.tween=function(e,t){return this._next={id:Cut._TS++,end:{},duration:e||400,delay:t||0},this},Cut.Tween.prototype.pin=function(e){this._next!==this._queue[this._queue.length-1]&&(this._owner.touch(),this._queue.push(this._next));var t=this._next.end;return arguments.length===1?Cut._extend(t,arguments[0]):arguments.length===2&&(t[arguments[0]]=arguments[1]),this},Cut.Tween.prototype.clear=function(e){var t;while(t=this._queue.shift())e&&this._owner.pin(t.end);return this},Cut.Tween.prototype.then=function(e){return this._next.then=e,this},Cut.Tween.prototype.easing=function(e){return this._next.easing=e,this},Cut.root=function(e,t){return new Cut.Root(e,t)},Cut.Root=function(e,t){Cut.String.prototype._super.apply(this,arguments),this._paused=!0,this._render=t,this._request=e;var n=this,r=function(){if(n._paused===!0)return;n._mo_touch=n._ts_touch,n._render(),n.request(),n._mo_touch==n._ts_touch&&n.pause()};this.request=function(){this._request.call(null,r)},this.on("viewport",function(e,t){return this._size={width:e,height:t},this._updateViewbox(),!0})},Cut.Root.prototype=Cut._create(Cut.prototype),Cut.Root.prototype._super=Cut,Cut.Root.prototype.constructor=Cut.Root,Cut.Root.prototype.viewbox=function(e,t,n){return this._viewbox={width:e,height:t,mode:typeof n=="undefined"?"in":n},this._updateViewbox(),this},Cut.Root.prototype._updateViewbox=function(){var e=this._viewbox,t=this._size;!t||(e?this.pin({width:e.width,height:e.height,resizeMode:e.mode,resizeWidth:t.width,resizeHeight:t.height}):this.pin({width:t.width,height:t.height}))},Cut.Root.prototype.start=function(){return this.resume()},Cut.Root.prototype.resume=function(e){if(this._paused||e)this._paused=!1,this.request();return this},Cut.Root.prototype.pause=function(){return this._paused=!0,this},Cut.Root.prototype.touch=function(){return this.resume(),Cut.prototype.touch.apply(this,arguments)},Cut.image=function(e){var t=new Cut.Image;return e&&t.setImage(e),t},Cut.Image=function(){Cut.Image.prototype._super.apply(this,arguments)},Cut.Image.prototype=Cut._create(Cut.prototype),Cut.Image.prototype._super=Cut,Cut.Image.prototype.constructor=Cut.Image,Cut.Image.prototype.setImage=function(e){return this._cutouts[0]=Cut.Out.select(e),this._cutouts.length=1,this.pin({width:this._cutouts[0]?this._cutouts[0].dWidth():0,height:this._cutouts[0]?this._cutouts[0].dHeight():0}),this._cutout=this._cutouts[0].clone(),this},Cut.Image.prototype.cropX=function(e,t){return this.setImage(this._cutouts[0].cropX(e,t))},Cut.Image.prototype.cropY=function(e,t){return this.setImage(this._cutouts[0].cropY(e,t))},Cut.Image.prototype._slice=function(e){return this._cutouts[e]||(this._cutouts[e]=this._cutout.clone())},Cut.Image.prototype.tile=function(e){return this.untick(this._repeatTicker),this._repeatTicker=function(){if(this._mo_tile==this._ts_touch)return;this._mo_tile=this._ts_touch;var t=this._cutout._left,n=this._cutout._right,r=this._cutout._top,i=this._cutout._bottom,s=this._cutout.dWidth()-t-n,o=this._cutout.dHeight()-r-i,u=this.pin("width");u=e?u:u-t-n;var a=this.pin("height");a=e?a:a-r-i;var f=e?-t:0,l=e?-r:0,c=0;r&&t&&this._slice(c++).cropX(t,0).cropY(r,0).offset(f,l),i&&t&&this._slice(c++).cropX(t,0).cropY(i,o+r).offset(f,l+a+r),r&&n&&this._slice(c++).cropX(n,s+t).cropY(r,0).offset(f+u+t,l),i&&n&&this._slice(c++).cropX(n,s+t).cropY(i,o+r).offset(f+u+t,l+a+r);var h=f+t,p=u;while(p>0){var d=Math.min(s,p);p-=s;var v=l+r,m=a;while(m>0){var g=Math.min(o,m);m-=o,this._slice(c++).cropX(d,t).cropY(g,r).offset(h,v),p<=0&&(t&&this._slice(c++).cropX(t,0).cropY(g,r).offset(f,v),n&&this._slice(c++).cropX(n,s+t).cropY(g,r).offset(h+d,v)),v+=g}r&&this._slice(c++).cropX(d,t).cropY(r,0).offset(h,l),i&&this._slice(c++).cropX(d,t).cropY(i,o+r).offset(h,v),h+=d}this._cutouts.length=c},this.tick(this._repeatTicker),this},Cut.Image.prototype.stretch=function(e){return this.untick(this._repeatTicker),this._repeatTicker=function(){if(this._mo_stretch==this._pin._ts_transform)return;this._mo_stretch=this._pin._ts_transform;var t=this._cutout._left,n=this._cutout._right,r=this._cutout._top,i=this._cutout._bottom,s=this._cutout.dWidth(),o=this._cutout.dHeight(),u=this.pin("width"),a=this.pin("height");u=e?u+t+n:Math.max(u,t+n),a=e?a+r+i:Math.max(a,r+i);var f=0;r&&t&&this._slice(f++).cropX(t,0).cropY(r,0).offset(0,0),i&&t&&this._slice(f++).cropX(t,0).cropY(i,o-i).offset(0,a-i),r&&n&&this._slice(f++).cropX(n,s-n).cropY(r,0).offset(u-n,0),i&&n&&this._slice(f++).cropX(n,s-n).cropY(i,o-i).offset(u-n,a-i),r&&this._slice(f++).cropX(s-t-n,t).cropY(r,0).offset(t,0).dWidth(u-t-n),i&&this._slice(f++).cropX(s-t-n,t).cropY(i,o-i).offset(t,a-i).dWidth(u-t-n),t&&this._slice(f++).cropX(t,0).cropY(o-r-i,r).offset(0,r).dHeight(a-r-i),n&&this._slice(f++).cropX(n,s-n).cropY(o-r-i,r).offset(u-n,r).dHeight(a-r-i),this._slice(f++).cropX(s-t-n,t).cropY(o-r-i,r).offset(t,r).dWidth(u-t-n).dHeight(a-r-i),this._cutouts.length=f},this.tick(this._repeatTicker),this},Cut.anim=function(e,t){var n=(new Cut.Anim).setFrames(e).gotoFrame(0);return t&&n.fps(t),n},Cut.Anim=function(){Cut.Anim.prototype._super.apply(this,arguments),this._fps=Cut.Anim.FPS,this._ft=1e3/this._fps,this._time=0,this._frame=0,this._frames=[],this._labels={},this.tick(function(){if(this._time&&this._frames.length>1){var e=Cut._now()-this._time;if(e>=this._ft){var t=e<2*this._ft?1:Math.floor(e/this._ft);this._time+=t*this._ft,this.moveFrame(t),this._repeat&&(this._repeat-=t)<=0&&(this.stop(),this._callback&&this._callback())}this.touch()}},!1)},Cut.Anim.prototype=Cut._create(Cut.prototype),Cut.Anim.prototype._super=Cut,Cut.Anim.prototype.constructor=Cut.Anim,Cut.Anim.FPS=22,Cut.Anim.prototype.fps=function(e){return arguments.length?(this._fps=e||Cut.Anim.FPS,this._ft=1e3/this._fps,this):this._fps},Cut.Anim.prototype.setFrames=function(e){this._time=this._time||0,this._frame=0,this._frames=[],this._labels={},e=Cut.Out.select(e,!0);if(e&&e.length)for(var t=0;t<e.length;t++){var n=e[t];this._frames.push(n),this._labels[n.name]=t}return this},Cut.Anim.prototype.length=function(){return this._frames?this._frames.length:0},Cut.Anim.prototype.gotoFrame=function(e,t){return e=Cut.Math.rotate(e,this._frames.length)|0,this._frame=e,t=t||!this._cutouts[0],this._cutouts[0]=this._frames[this._frame],t&&this.pin({width:this._cutouts[0].dWidth(),height:this._cutouts[0].dHeight()}),this._ts_frame=Cut._TS++,this.touch(),this},Cut.Anim.prototype.moveFrame=function(e){return this.gotoFrame(this._frame+e)},Cut.Anim.prototype.gotoLabel=function(e,t){return this.gotoFrame(this._labels[e]||0,t)},Cut.Anim.prototype.repeat=function(e,t){return this._repeat=e*this._frames.length-1,this._callback=t,this.play(),this},Cut.Anim.prototype.play=function(e){return arguments.length?(this.gotoFrame(e),this._time=Cut._now()):this._time||(this._time=Cut._now()),this},Cut.Anim.prototype.stop=function(e){return this._time=null,arguments.length&&this.gotoFrame(e),this},Cut.string=function(e){return(new Cut.String).setFont(e)},Cut.String=function(){Cut.String.prototype._super.apply(this,arguments),this.row()},Cut.String.prototype=Cut._create(Cut.prototype),Cut.String.prototype._super=Cut,Cut.String.prototype.constructor=Cut.String,Cut.String.prototype.setFont=function(e){return typeof e=="string"?this._font=function(t){return e+t}:Cut._isFunc(e)&&(this._font=e),this},Cut.String.prototype.setValue=function(e){if(this.value===e)return this;this.value=e,typeof e!="string"&&!Cut._isArray(e)&&(e+="");var t=this._first;for(var n=0;n<e.length;n++){var r=this._font(e[n]);t?t.setImage(r).show():t=Cut.image(r).appendTo(this),t=t._next}while(t)t.hide(),t=t._next;return this},Cut.row=function(e){return Cut.create().row(e)},Cut.prototype.row=function(e){return this.sequence("row",e),this},Cut.column=function(e){return Cut.create().column(e)},Cut.prototype.column=function(e){return this.sequence("column",e),this},Cut.sequence=function(e,t){return(new Cut.create).sequence(e,t)},Cut.prototype.sequence=function(e,t){return this.untick(this._layoutTicker),this._layoutTicker=function(){if(this._mo_seq==this._ts_touch)return;this._mo_seq=this._ts_touch;var n=this._mo_seqAlign!=this._ts_children;this._mo_seqAlign=this._ts_children;var r=0,i=0,s,o=this.first(!0),u=!0;while(s=o){o=s.next(!0),s._pin.relativeMatrix();var a=s._pin._boxWidth,f=s._pin._boxHeight;e=="column"?(!u&&(i+=this._spacing||0),s.pin("offsetY")!=i&&s.pin("offsetY",i),r=Math.max(r,a),i+=f,n&&s.pin("alignX",t)):e=="row"&&(!u&&(r+=this._spacing||0),s.pin("offsetX")!=r&&s.pin("offsetX",r),r+=a,i=Math.max(i,f),n&&s.pin("alignY",t)),u=!1}r+=2*this._padding||0,i+=2*this._padding||0,this.pin("width")!=r&&this.pin("width",r),this.pin("height")!=i&&this.pin("height",i)},this.tick(this._layoutTicker),this},Cut.box=function(){return(new Cut.create).box()},Cut.prototype.box=function(){return this._boxTicker?this:(this._boxTicker=function(){if(this._mo_box==this._ts_touch)return;this._mo_box=this._ts_touch;var e=0,t=0,n,r=this.first(!0);while(n=r){r=n.next(!0),n._pin.relativeMatrix();var i=n._pin._boxWidth,s=n._pin._boxHeight;e=Math.max(e,i),t=Math.max(t,s)}e+=2*this._padding||0,t+=2*this._padding||0,this.pin("width")!=e&&this.pin("width",e),this.pin("height")!=t&&this.pin("height",t)},this.tick(this._boxTicker),this)},Cut.prototype.padding=function(e){return this._padding=e,this},Cut.prototype.spacing=function(e){return this._spacing=e,this},Cut._images={},Cut.loadImages=function(e,t){function a(){DEBUG&&console.log("Loading image completed."),l()}function f(e){DEBUG&&console.log("Error loading image: "+e),l()}function l(){--n<=0&&t&&t()}var n=0,r=!0,i=Cut._textures;for(var s in i)if(i[s].getImagePath()){n++;var o=i[s].getImagePath(),u=e(o,a,f);Cut.addImage(u,o),r=!1}r&&(DEBUG&&console.log("No image to load."),t&&t())},Cut.getImage=function(e){return Cut._images[e]},Cut.addImage=function(e,t){return Cut._images[t]=e,this},Cut._textures={},Cut.addTexture=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];Cut._textures[t.name]=new Cut.Texture(t)}return this},Cut.Texture=function(e){function r(){return n||(n=Cut.getImage(e.imagePath)),n}function s(t){if(!t)return t;if(t.isCutout)return t;typeof e.map=="function"?t=e.map(t):typeof e.filter=="function"&&(t=e.filter(t));var n=e.ratio||1;n!=1&&(t.x*=n,t.y*=n,t.width*=n,t.height*=n,t.top*=n,t.bottom*=n,t.left*=n,t.right*=n);var r=e.trim||0;return r&&(t.x+=r,t.y+=r,t.width-=2*r,t.height-=2*r,t.top-=r,t.bottom-=r,t.left-=r,t.right-=r),t}function o(t){return t.isCutout||(t=new Cut.Out(t,r,e.imageRatio)),t}e.cutouts=e.cutouts||[];var t={},n=null;this.getImagePath=function(){return e.imagePath};for(var i=0;i<e.cutouts.length;i++)s(e.cutouts[i]);this.select=function(n,r){if(!r){var i=n+"?",u=t[i];if(typeof u=="undefined"){for(var a=0;a<e.cutouts.length;a++){var f=e.cutouts[a];if(f.name==n){u=f;break}}!u&&e.factory&&(u=s(e.factory(n))),t[i]=u}if(!u)throw"Cutout not found: '"+e.name+":"+n+"'";return o(u)}var i=n+"*",l=t[i];if(typeof l=="undefined"){l=[];var c=n.length;for(var a=0;a<e.cutouts.length;a++){var f=e.cutouts[a];f.name&&f.name.substring(0,c)==n&&l.push(e.cutouts[a])}t[i]=l}if(!l.length)throw"Cutouts not found: '"+e.name+":"+n+"'";for(var a=0;a<l.length;a++)l[a]=o(l[a]);return l}},Cut.Out=function(e,t,n){this.isCutout=!0,this._data=e,this.name=e.name,this._image=t,this._ratio=n||1,this._sx=e.x*this._ratio,this._sy=e.y*this._ratio,this._sw=e.width*this._ratio,this._sh=e.height*this._ratio,this._dx=0,this._dy=0,this._dw=e.width,this._dh=e.height,this._top=e.top||0,this._bottom=e.bottom||0,this._left=e.left||0,this._right=e.right||0},Cut.Out.prototype.clone=function(){return new Cut.Out(this._data,this._image,this._ratio)},Cut.Out.prototype.dWidth=function(e){return arguments.length?(this._dw=e,this):this._dw},Cut.Out.prototype.dHeight=function(e){return arguments.length?(this._dh=e,this):this._dh},Cut.Out.prototype.cropX=function(e,t){return t=t||0,e=Math.min(e,this._data.width-t),this._dw=e,this._sw=e*this._ratio,this._sx=(this._data.x+t)*this._ratio,this},Cut.Out.prototype.cropY=function(e,t){return t=t||0,e=Math.min(e,this._data.height-t),this._dh=e,this._sh=e*this._ratio,this._sy=(this._data.y+t)*this._ratio,this},Cut.Out.prototype.offset=function(e,t){return this._dx=e,this._dy=t,this},Cut.Out.prototype.paste=function(e){Cut._stats.paste++;var t=this._image();try{t&&e.drawImage(t,this._sx,this._sy,this._sw,this._sh,this._dx,this._dy,this._dw,this._dh)}catch(n){this.failed||console.log("Unable to paste: ",this._sx,this._sy,this._sw,this._sh,this._dx,this._dy,this._dw,this._dh,t),this.failed=!0}},Cut.Out.prototype.toString=function(){return"["+this.name+": "+this._dw+"x"+this._dh+"]"},Cut.Out.select=function(e,t){if(typeof e!="string")return e;var n=e.indexOf(":");if(n<0)throw"Invalid selector: '"+e+"'";var r=[e.slice(0,n),e.slice(n+1)],i=Cut._textures[r[0]];if(i==null)throw"Texture not found: '"+e+"'";return i.select(r[1],t)},Cut.drawing=function(){return Cut.image(Cut.Out.drawing.apply(Cut.Out,arguments))},Cut.Out.drawing=function(e,t,n,r,i,s){var o=document.createElement("canvas"),u=o.getContext("2d");return typeof i!="function"&&(typeof r=="function"?typeof e=="string"?(s=i,i=r,r=1):(s=i,i=r,r=n,n=t,t=e,e=Math.random()*1e3|0):typeof n=="function"&&(s=r,i=n,r=1,n=t,t=e,e=Math.random()*1e3|0)),o.width=Math.ceil(t*r),o.height=Math.ceil(n*r),s||(s={}),s.name||(s.name=e),s.x||(s.x=0),s.y||(s.y=0),s.width||(s.width=t),s.height||(s.height=n),s=new Cut.Out(s,function(){return o},r),i.call(s,u,r),s},Cut.Pin=function(e){this._owner=e,this._parent=null,this._relativeMatrix=new Cut.Matrix,this._absoluteMatrix=new Cut.Matrix,this.reset()},Cut.Pin.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=Cut._TS++,this._ts_transform=Cut._TS++,this._ts_matrix=Cut._TS++},Cut.Pin.prototype.tick=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=Cut._TS++),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=Cut._TS++),this},Cut.Pin.prototype.toString=function(){return this._owner.id()+" ["+this._alignX+", "+this._alignY+"] ["+this._handleX+", "+this._handleY+"] ["+(this._parent?this._parent._owner.id():null)+"]"},Cut.Pin.prototype.absoluteMatrix=function(){var e=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==e)return this._absoluteMatrix;this._mo_abs=e;var t=this._absoluteMatrix;return t.copyFrom(this.relativeMatrix()),this._parent&&t.concat(this._parent._absoluteMatrix),this._ts_matrix=Cut._TS++,t},Cut.Pin.prototype.relativeMatrix=function(){var e=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==e)return this._relativeMatrix;this._mo_rel=e;var t=this._relativeMatrix;t.identity(),this._pivoted&&t.translate(-this._pivotX*this._width,-this._pivotY*this._height),t.scale(this._scaleX,this._scaleY),t.skew(this._skewX,this._skewY),t.rotate(this._rotation),this._pivoted&&t.translate(this._pivotX*this._width,this._pivotY*this._height);if(this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var n,r,i=t;i.a>0&&i.c>0||i.a<0&&i.c<0?(n=0,r=i.a*this._width+i.c*this._height):(n=i.a*this._width,r=i.c*this._height),n>r?(this._boxX=r,this._boxWidth=n-r):(this._boxX=n,this._boxWidth=r-n),i.b>0&&i.d>0||i.b<0&&i.d<0?(n=0,r=i.b*this._width+i.d*this._height):(n=i.b*this._width,r=i.d*this._height),n>r?(this._boxY=r,this._boxHeight=n-r):(this._boxY=n,this._boxHeight=r-n)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth,this._y-=this._boxY+this._handleY*this._boxHeight,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),t.translate(this._x,this._y),this._relativeMatrix},Cut.Pin._SINGLE={},Cut.Pin.prototype.update=function(){if(arguments.length==1&&typeof arguments[0]=="string")return this["_"+arguments[0]];this._transform_flag=!1,this._translate_flag=!1;var e=null,t=null,n=null;if(arguments.length==2&&typeof arguments[0]=="string"){for(t in Cut.Pin._SINGLE)delete Cut.Pin._SINGLE[t];(e=Cut.Pin._SINGLE)[arguments[0]]=arguments[1]}else arguments.length==1&&typeof arguments[0]=="object"&&(e=arguments[0]);if(e)for(t in e)typeof (n=e[t])!="undefined"&&(setter=Cut.Pin._setters[t])&&setter.call(Cut.Pin._setters,this,n,e);return this._translate_flag&&(this._translate_flag=!1,this._ts_translate=Cut._TS++),this._transform_flag&&(this._transform_flag=!1,this._ts_transform=Cut._TS++),this._owner&&(this._owner._ts_pin=Cut._TS++,this._owner.touch()),this},Cut.Pin._setters={alpha:function(e,t,n){e._alpha=t},textureAlpha:function(e,t,n){e._textureAlpha=t},width:function(e,t,n){e._width_=t,e._width=t,e._transform_flag=!0},height:function(e,t,n){e._height_=t,e._height=t,e._transform_flag=!0},scale:function(e,t,n){e._scaleX=t,e._scaleY=t,e._transform_flag=!0},scaleX:function(e,t,n){e._scaleX=t,e._transform_flag=!0},scaleY:function(e,t,n){e._scaleY=t,e._transform_flag=!0},skew:function(e,t,n){e._skewX=t,e._skewY=t,e._transform_flag=!0},skewX:function(e,t,n){e._skewX=t,e._transform_flag=!0},skewY:function(e,t,n){e._skewY=t,e._transform_flag=!0},rotation:function(e,t,n){e._rotation=t,e._transform_flag=!0},pivot:function(e,t,n){e._pivotX=t,e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},pivotX:function(e,t,n){e._pivotX=t,e._pivoted=!0,e._transform_flag=!0},pivotY:function(e,t,n){e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},offset:function(e,t,n){e._offsetX=t,e._offsetY=t,e._translate_flag=!0},offsetX:function(e,t,n){e._offsetX=t,e._translate_flag=!0},offsetY:function(e,t,n){e._offsetY=t,e._translate_flag=!0},align:function(e,t,n){this.alignX.apply(this,arguments),this.alignY.apply(this,arguments)},alignX:function(e,t,n){e._alignX=t,e._aligned=!0,e._translate_flag=!0,this.handleX(e,t,n)},alignY:function(e,t,n){e._alignY=t,e._aligned=!0,e._translate_flag=!0,this.handleY(e,t,n)},handle:function(e,t,n){this.handleX(e,t,n),this.handleY(e,t,n)},handleX:function(e,t,n){e._handleX=t,e._handled=!0,e._translate_flag=!0},handleY:function(e,t,n){e._handleY=t,e._handled=!0,e._translate_flag=!0},resizeMode:function(e,t,n){Cut._isNum(n.resizeWidth)&&Cut._isNum(n.resizeHeight)&&(this.resizeWidth(e,n.resizeWidth,n,!0),this.resizeHeight(e,n.resizeHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)),e._width=n.resizeWidth/e._scaleX,e._height=n.resizeHeight/e._scaleY)},resizeWidth:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleX=t/e._width_,e._width=e._width_,e._transform_flag=!0},resizeHeight:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleY=t/e._height_,e._height=e._height_,e._transform_flag=!0},scaleMode:function(e,t,n){Cut._isNum(n.scaleWidth)&&Cut._isNum(n.scaleHeight)&&(this.scaleWidth(e,n.scaleWidth,n,!0),this.scaleHeight(e,n.scaleHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)))},scaleWidth:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleX=t/e._width_,e._transform_flag=!0},scaleHeight:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleY=t/e._height_,e._transform_flag=!0},matrix:function(e,t,n){this.scaleX(e,t.a,n),this.skewX(e,t.c/t.d,n),this.skewY(e,t.b/t.a,n),this.scaleY(e,t.d,n),this.offsetX(e,t.e,n),this.offsetY(e,t.f,n),this.rotation(e,0,n)}},Cut.Matrix=function(e,t,n,r,i,s){this.changed=!0,this.a=e||1,this.b=t||0,this.c=n||0,this.d=r||1,this.e=i||0,this.f=s||0},Cut.Matrix.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},Cut.Matrix.prototype.clone=function(){return new Cut.Matrix(this.a,this.b,this.c,this.d,this.e,this.f)},Cut.Matrix.prototype.copyTo=function(e){return e.copyFrom(this),this},Cut.Matrix.prototype.copyFrom=function(e){return this.changed=!0,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f,this},Cut.Matrix.prototype.identity=function(){return this.changed=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},Cut.Matrix.prototype.rotate=function(e){if(!e)return this;this.changed=!0;var t=e?Math.cos(e):1,n=e?Math.sin(e):0,r=t*this.a-n*this.b,i=t*this.b+n*this.a,s=t*this.c-n*this.d,o=t*this.d+n*this.c,u=t*this.e-n*this.f,a=t*this.f+n*this.e;return this.a=r,this.b=i,this.c=s,this.d=o,this.e=u,this.f=a,this},Cut.Matrix.prototype.translate=function(e,t){return!e&&!t?this:(this.changed=!0,this.e+=e,this.f+=t,this)},Cut.Matrix.prototype.scale=function(e,t){return!(e-1)&&!(t-1)?this:(this.changed=!0,this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.e*=e,this.f*=t,this)},Cut.Matrix.prototype.skew=function(e,t){if(!e&&!t)return this;this.changed=!0;var n=this.a+this.b*e,r=this.b+this.a*t,i=this.c+this.d*e,s=this.d+this.c*t,o=this.e+this.f*e,u=this.f+this.e*t;return this.a=n,this.b=r,this.c=i,this.d=s,this.e=o,this.f=u,this},Cut.Matrix.prototype.concat=function(e){this.changed=!0;var t=this,n=t.a*e.a+t.b*e.c,r=t.b*e.d+t.a*e.b,i=t.c*e.a+t.d*e.c,s=t.d*e.d+t.c*e.b,o=t.e*e.a+e.e+t.f*e.c,u=t.f*e.d+e.f+t.e*e.b;return this.a=n,this.b=r,this.c=i,this.d=s,this.e=o,this.f=u,this},Cut.Matrix.prototype.reverse=function(){if(this.changed){this.changed=!1,this.reversed=this.reversed||new Cut.Matrix;var e=this.a*this.d-this.b*this.c;this.reversed.a=this.d/e,this.reversed.b=-this.b/e,this.reversed.c=-this.c/e,this.reversed.d=this.a/e,this.reversed.e=(this.c*this.f-this.e*this.d)/e,this.reversed.f=(this.e*this.b-this.a*this.f)/e}return this.reversed},Cut.Matrix.prototype.map=function(e,t){return t=t||{},t.x=this.a*e.x+this.c*e.y+this.e,t.y=this.b*e.x+this.d*e.y+this.f,t},Cut.Matrix.prototype.mapX=function(e,t){return this.a*e+this.c*t+this.e},Cut.Matrix.prototype.mapY=function(e,t){return this.b*e+this.d*t+this.f},Cut.Math={},Cut.Math.random=function(e,t){return arguments.length==0?(t=1,e=0):arguments.length==1&&(t=e,e=0),e==t?e:Math.random()*(t-e)+e},Cut.Math.rotate=function(e,t,n){return arguments.length<3&&(n=t||0,t=0),n>t?(e=(e-t)%(n-t),e+(e<0?n:t)):(e=(e-n)%(t-n),e+(e<=0?t:n))},Cut.Math.length=function(e,t){return Math.sqrt(e*e+t*t)},Cut._TS=0,Cut._isCut=function(e){return e instanceof Cut},Cut._isNum=function(e){return typeof e=="number"},Cut._isFunc=function(e){return typeof e=="function"},Cut._isArray="isArray"in Array?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},Cut._extend=function(e,t,n){if(n)for(var r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}else for(var i in t)e[i]=t[i];return e},Cut._now=function(){return typeof performance!="undefined"&&performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return+(new Date)}}(),Cut._function=function(e){return typeof e=="function"?e:function(){return e}},Cut._status=function(e){if(!Cut._statusbox){var t=Cut._statusbox=document.createElement("div");t.style.position="absolute",t.style.color="black",t.style.background="white",t.style.zIndex=999,t.style.top="5px",t.style.right="5px",t.style.padding="1px 5px",document.body.appendChild(t)}Cut._statusbox.innerHTML=e},Cut.Loader=function(){var e=[],t=[],n=!1;return{load:function(r,i){n?t.push(this.init.apply(this,arguments)):e.push(arguments)},start:function(){n=!0;var r;while(r=e.shift())t.push(this.init.apply(this,r))},pause:function(){for(var n=e.length-1;n>=0;n--)t[n].pause()},resume:function(){for(var n=e.length-1;n>=0;n--)t[n].resume()}}}(),define("cut-core",function(){}),DEBUG=!0,Cut.prototype.spy=function(e){return arguments.length?(this._spy=e?!0:!1,this):this._spy},Cut.Mouse=function(){Cut.Mouse.subscribe.apply(Cut.Mouse,arguments)},Cut.Mouse.CLICK="click",Cut.Mouse.START="touchstart mousedown",Cut.Mouse.MOVE="touchmove mousemove",Cut.Mouse.END="touchend mouseup",Cut.Mouse.subscribe=function(e,t,n){function h(e){g(e,t),DEBUG&&console.log("Mouse Start: "+e.type+" "+f),!n&&t.addEventListener(o,d),e.preventDefault(),m(e.type,e),c.x=f.x,c.y=f.y,c.state=1}function p(e){try{DEBUG&&console.log("Mouse End: "+e.type+" "+f),!n&&t.removeEventListener(o,d),e.preventDefault(),m(e.type,e),c.state==1&&c.x==f.x&&c.y==f.y?(DEBUG&&console.log("Mouse Click [+]"),m("click",e),c.state=2):c.state=0}catch(r){console&&console.log(r)}}function d(e){try{g(e,t),e.preventDefault(),m(e.type,e)}catch(n){console&&console.log(n)}}function v(e){try{g(e,t),DEBUG&&console.log("Mouse Click: "+e.type+" "+f),e.preventDefault(),c.state!=2?m(e.type,e):DEBUG&&console.log("Mouse Click [-]")}catch(n){console&&console.log(n)}}function m(t,n){f.type=t,f.event=n,l.x=f.x,l.y=f.y,e.visit(a)}function g(t,n){var r=!1;if(t.touches){if(!t.touches.length)return;r=!0,f.x=t.touches[0].pageX,f.y=t.touches[0].pageY}else f.x=t.clientX,f.y=t.clientY,!document.body.scrollLeft&&!document.body.scrollTop&&document.documentElement&&(f.x+=document.documentElement.scrollLeft,f.y+=document.documentElement.scrollTop);f.x-=n.clientLeft||0,f.y-=n.clientTop||0;var i=n;while(i)f.x-=i.offsetLeft||0,f.y-=i.offsetTop||0,r||(f.x+=i.scrollLeft||0,f.y+=i.scrollTop||0),i=i.offsetParent;f.x*=e._ratio||1,f.y*=e._ratio||1}t=t||document;var r="ontouchstart"in window,i="click",s=r?"touchstart":"mousedown",o=r?"touchmove":"mousemove",u=r?"touchend":"mouseup";t.addEventListener(i,v),t.addEventListener(s,h),t.addEventListener(u,p),n&&t.addEventListener(o,d);var a=null,f={x:0,y:0,toString:function(){return(this.x|0)+"x"+(this.y|0)}},l={x:0,y:0,toString:function(){return f+" / "+(this.x|0)+"x"+(this.y|0)}},c={x:0,y:0,state:0};a={reverse:!0,visible:!0,start:function(t){if(!t.spy()&&e!==t){t.matrix().reverse().map(f,l);if(l.x<0||l.x>t._pin._width||l.y<0||l.y>t._pin._height)return!0}},end:function(e){var t=e.listeners(f.type);if(t){e.matrix().reverse().map(f,l);for(var n=0;n<t.length;n++)if(t[n].call(e,f.event,l))return!0}}}},define("cut-mouse",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,window.addEventListener("load",function(){DEBUG&&console.log("On load."),Cut.Loader.start()},!1),Cut.Loader.init=function(e,t){function f(){DEBUG&&console.log("Images loaded."),n=t.getContext("2d");var r=window.devicePixelRatio||1,i=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;o=r/i,t.resize=l,DEBUG&&console.log("Loading..."),e(u,t),l(),window.addEventListener("resize",l,!1),DEBUG&&console.log("Start playing..."),u.start()}function l(){r?(i=window.innerWidth>0?window.innerWidth:screen.width,s=window.innerHeight>0?window.innerHeight:screen.height,t.style.width=i+"px",t.style.height=s+"px"):(i=t.clientWidth,s=t.clientHeight),i*=o,s*=o,t.width=i,t.height=s,u._ratio=o,DEBUG&&console.log("Resize: "+i+" x "+s+" / "+o),u.visit({start:function(e){var t=!0,n=e.listeners("viewport");if(n)for(var r=0;r<n.length;r++)t&=!n[r].call(e,i,s);return t}})}var n=null,r=!1,i=0,s=0,o=1;DEBUG&&console.log("Creating root...");var u=Cut.root(requestAnimationFrame,function(){n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,i,s),this.render(n)});typeof t=="string"&&(t=document.getElementById(t)),t||(t=document.getElementById("cutjs"));if(!t){r=!0,DEBUG&&console.log("Creating element..."),t=document.createElement("canvas"),t.style.position="absolute";var a=document.body;a.insertBefore(t,a.firstChild)}return DEBUG&&console.log("Loading images..."),Cut.loadImages(function(e,t,n){var r=new Image;return DEBUG&&console.log("Loading image: "+e),r.onload=t,r.onerror=n,r.src=e,r},f),u},!function(){var e=["ms","moz","webkit","o"];for(var t=0;t<e.length&&!window.requestAnimationFrame;t++){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var t=(new Date).getTime();return r=Math.max(r+16,t),window.setTimeout(function(){e(r)},r-t)}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("cut-loader",function(){});var Extra=Extra||{},X=Extra;Extra.Pool=Pool,define("pool",function(){});var Extra=Extra||{},X=Extra;Extra.Randomize=Randomize,Randomize.prototype.reset=function(){return this._reset&&this._reset(),this},Randomize.prototype.map=function(e){return this._map=e||function(e){return e},this},Randomize.prototype.nope=function(e){return arguments.length?(this._nope=e,this):this._nope},Randomize.prototype.add=function(e,t,n){return this._options.push([e,Randomize._numbor(t,1)]),n&&(this._lock=e),this},Randomize.prototype.select=function(e){return this._map(this._options[e][0])},Randomize.prototype.random=function(){if(this._lock)return this._map(this._lock);var e=0;for(var t=0;t<this._options.length;t++){var n=this._options[t];n[2]=n[1].apply(null,arguments),e+=n[2]}var r=Math.random()*e,i=this._nope;for(var t=0;t<this._options.length;t++){var n=this._options[t];if((r-=n[2])<0){i=n[0];break}}return this._map(i)},Randomize.prototype.condition=function(e,t){return this._condition=e,this._reset=t,this},Randomize.prototype.test=function(){this._test=this._condition?this._condition.apply(null,arguments):null;if(!this._tested){var e=this;this._tested={random:function(){var t=e._test;return e._test=null,t===!1?e._map(e._nope):e.random.apply(e,arguments)}}}return this._tested},Randomize.prototype.spacing=function(e,t){e=Randomize._numbor(e,1);var n=t;return this.condition(function(t){return t=arguments.length?t:1,typeof n!="number"?(n=e.apply(null,arguments),!1):(n-=t)<0?(n=e.apply(null,arguments),!0):!1},function(){n=null}),this},Randomize.prototype.prob=function(e){return e=Randomize._numbor(e,1),this.condition(function(){return Math.random()<e()}),this},Randomize._numbor=function(e,t){return typeof e=="function"?e:(typeof e!="number"&&(e=t),function(){return e})},define("randomize",function(){}),Cut.addTexture({name:"bg",imagePath:"media/graphics/bg.jpg",cutouts:[{name:"full",x:0,y:0,width:1024,height:1024}]},{name:"four",imagePath:"media/graphics/four.png",imageRatio:2,filter:function(e){return e.y=256-(e.y+e.height),e},cutouts:[{name:"node_1",x:0,y:98,width:30,height:30},{name:"node_2",x:30,y:98,width:30,height:30},{name:"node_3",x:60,y:98,width:30,height:30},{name:"node_4",x:90,y:98,width:30,height:30},{name:"node_11",x:120,y:98,width:30,height:30},{name:"node_12",x:150,y:98,width:30,height:30},{name:"node_1_s",x:0,y:68,width:30,height:30},{name:"node_2_s",x:30,y:68,width:30,height:30},{name:"node_3_s",x:60,y:68,width:30,height:30},{name:"node_4_s",x:90,y:68,width:30,height:30},{name:"node_11_s",x:120,y:68,width:30,height:30},{name:"node_12_s",x:150,y:68,width:30,height:30},{name:"node_0",x:180,y:68,width:30,height:30},{name:"node_drop",x:180,y:68,width:30,height:30},{name:"bar_1",x:199,y:220,width:22,height:15,left:5,right:5},{name:"bar_2",x:199,y:205,width:22,height:15,left:5,right:5},{name:"bar_3",x:199,y:190,width:22,height:15,left:5,right:5},{name:"bar_4",x:199,y:175,width:22,height:15,left:5,right:5},{name:"bar_11",x:199,y:160,width:22,height:15,left:5,right:5},{name:"bar_12",x:199,y:145,width:22,height:15,left:5,right:5},{name:"bar_0",x:199,y:130,width:22,height:15,left:5,right:5},{name:"link",x:0,y:7,width:512,height:5},{name:"drag",x:0,y:1,width:512,height:5},{name:"link_drop",x:0,y:13,width:512,height:1},{name:"dragin",x:310,y:150,width:100,height:100},{name:"dragout",x:410,y:150,width:100,height:100},{name:"window",x:230,y:170,width:20,height:18,top:1,bottom:1,left:1,right:1},{name:"button",x:230,y:190,width:20,height:18,top:1,bottom:8,left:1,right:1},{name:"mode_3",x:232,y:98,width:46,height:45},{name:"mode_4",x:272,y:98,width:46,height:45},{name:"mode_6",x:312,y:98,width:46,height:45},{name:"mode_1",x:352,y:98,width:46,height:45},{name:"mode_2",x:392,y:98,width:46,height:45},{name:"help",x:432,y:98,width:46,height:45},{name:"menu_3",x:232,y:102,width:46,height:39},{name:"menu_4",x:272,y:102,width:46,height:39},{name:"menu_6",x:312,y:102,width:46,height:39},{name:"menu_1",x:352,y:102,width:46,height:39},{name:"menu_2",x:392,y:102,width:46,height:39},{name:"menu",x:392,y:102,width:6,height:39,left:2,right:2},{name:"player_1",x:300,y:10,width:20,height:20},{name:"player_2",x:320,y:10,width:20,height:20},{name:"player_3",x:340,y:10,width:20,height:20},{name:"player_4",x:360,y:10,width:20,height:20},{name:"d_0",x:225,y:64,width:13,height:24},{name:"d_1",x:240,y:64,width:13,height:24},{name:"d_2",x:255,y:64,width:13,height:24},{name:"d_3",x:270,y:64,width:13,height:24},{name:"d_4",x:285,y:64,width:13,height:24},{name:"d_5",x:300,y:64,width:13,height:24},{name:"d_6",x:315,y:64,width:13,height:24},{name:"d_7",x:330,y:64,width:13,height:24},{name:"d_8",x:345,y:64,width:13,height:24},{name:"d_9",x:360,y:64,width:13,height:24},{name:"d_-",x:375,y:64,width:8,height:24},{name:"d_!",x:390,y:64,width:6,height:24},{name:"d_:",x:405,y:64,width:6,height:24},{name:"d_?",x:420,y:64,width:10,height:24},{name:"d_>",x:435,y:64,width:11,height:24},{name:"d_^",x:450,y:64,width:10,height:24},{name:"d_<",x:465,y:64,width:11,height:24},{name:"d_/",x:480,y:64,width:14,height:24},{name:"d_ ",x:495,y:64,width:10,height:24},{name:"d_a",x:0,y:14,width:15,height:24},{name:"d_b",x:15,y:14,width:15,height:24},{name:"d_c",x:30,y:14,width:15,height:24},{name:"d_d",x:45,y:14,width:15,height:24},{name:"d_e",x:60,y:14,width:15,height:24},{name:"d_f",x:75,y:14,width:15,height:24},{name:"d_g",x:90,y:14,width:15,height:24},{name:"d_h",x:105,y:14,width:15,height:24},{name:"d_i",x:120,y:14,width:15,height:24},{name:"d_j",x:135,y:14,width:15,height:24},{name:"d_k",x:150,y:14,width:15,height:24},{name:"d_l",x:165,y:14,width:15,height:24},{name:"d_m",x:180,y:14,width:15,height:24},{name:"d_n",x:195,y:14,width:15,height:24},{name:"d_o",x:210,y:14,width:15,height:24},{name:"d_p",x:225,y:14,width:15,height:24},{name:"d_q",x:240,y:14,width:15,height:24},{name:"d_r",x:255,y:14,width:15,height:24},{name:"d_s",x:270,y:14,width:15,height:24},{name:"d_t",x:285,y:14,width:15,height:24},{name:"d_u",x:300,y:14,width:15,height:24},{name:"d_v",x:315,y:14,width:15,height:24},{name:"d_w",x:330,y:14,width:15,height:24},{name:"d_x",x:345,y:14,width:15,height:24},{name:"d_y",x:360,y:14,width:15,height:24},{name:"d_z",x:375,y:14,width:15,height:24},{name:"d_A",x:0,y:39,width:15,height:24},{name:"d_B",x:15,y:39,width:15,height:24},{name:"d_C",x:30,y:39,width:15,height:24},{name:"d_D",x:45,y:39,width:15,height:24},{name:"d_E",x:60,y:39,width:15,height:24},{name:"d_F",x:75,y:39,width:15,height:24},{name:"d_G",x:90,y:39,width:15,height:24},{name:"d_H",x:105,y:39,width:15,height:24},{name:"d_I",x:120,y:39,width:15,height:24},{name:"d_J",x:135,y:39,width:15,height:24},{name:"d_K",x:150,y:39,width:15,height:24},{name:"d_L",x:165,y:39,width:15,height:24},{name:"d_M",x:180,y:39,width:15,height:24},{name:"d_N",x:195,y:39,width:15,height:24},{name:"d_O",x:210,y:39,width:15,height:24},{name:"d_P",x:225,y:39,width:15,height:24},{name:"d_Q",x:240,y:39,width:15,height:24},{name:"d_R",x:255,y:39,width:15,height:24},{name:"d_S",x:270,y:39,width:15,height:24},{name:"d_T",x:285,y:39,width:15,height:24},{name:"d_U",x:300,y:39,width:15,height:24},{name:"d_V",x:315,y:39,width:15,height:24},{name:"d_W",x:330,y:39,width:15,height:24},{name:"d_X",x:345,y:39,width:15,height:24},{name:"d_Y",x:360,y:39,width:15,height:24},{name:"d_Z",x:375,y:39,width:15,height:24},{name:"d1_0",x:0,y:230,width:12,height:17},{name:"d1_1",x:20,y:230,width:12,height:17},{name:"d1_2",x:40,y:230,width:12,height:17},{name:"d1_3",x:60,y:230,width:12,height:17},{name:"d1_4",x:80,y:230,width:12,height:17},{name:"d1_5",x:100,y:230,width:12,height:17},{name:"d1_6",x:120,y:230,width:12,height:17},{name:"d1_7",x:140,y:230,width:12,height:17},{name:"d1_8",x:160,y:230,width:12,height:17},{name:"d1_9",x:180,y:230,width:12,height:17},{name:"d2_0",x:0,y:210,width:12,height:17},{name:"d2_1",x:20,y:210,width:12,height:17},{name:"d2_2",x:40,y:210,width:12,height:17},{name:"d2_3",x:60,y:210,width:12,height:17},{name:"d2_4",x:80,y:210,width:12,height:17},{name:"d2_5",x:100,y:210,width:12,height:17},{name:"d2_6",x:120,y:210,width:12,height:17},{name:"d2_7",x:140,y:210,width:12,height:17},{name:"d2_8",x:160,y:210,width:12,height:17},{name:"d2_9",x:180,y:210,width:12,height:17},{name:"d3_0",x:0,y:190,width:12,height:17},{name:"d3_1",x:20,y:190,width:12,height:17},{name:"d3_2",x:40,y:190,width:12,height:17},{name:"d3_3",x:60,y:190,width:12,height:17},{name:"d3_4",x:80,y:190,width:12,height:17},{name:"d3_5",x:100,y:190,width:12,height:17},{name:"d3_6",x:120,y:190,width:12,height:17},{name:"d3_7",x:140,y:190,width:12,height:17},{name:"d3_8",x:160,y:190,width:12,height:17},{name:"d3_9",x:180,y:190,width:12,height:17},{name:"d4_0",x:0,y:170,width:12,height:17},{name:"d4_1",x:20,y:170,width:12,height:17},{name:"d4_2",x:40,y:170,width:12,height:17},{name:"d4_3",x:60,y:170,width:12,height:17},{name:"d4_4",x:80,y:170,width:12,height:17},{name:"d4_5",x:100,y:170,width:12,height:17},{name:"d4_6",x:120,y:170,width:12,height:17},{name:"d4_7",x:140,y:170,width:12,height:17},{name:"d4_8",x:160,y:170,width:12,height:17},{name:"d4_9",x:180,y:170,width:12,height:17},{name:"d11_0",x:0,y:150,width:12,height:17},{name:"d11_1",x:20,y:150,width:12,height:17},{name:"d11_2",x:40,y:150,width:12,height:17},{name:"d11_3",x:60,y:150,width:12,height:17},{name:"d11_4",x:80,y:150,width:12,height:17},{name:"d11_5",x:100,y:150,width:12,height:17},{name:"d11_6",x:120,y:150,width:12,height:17},{name:"d11_7",x:140,y:150,width:12,height:17},{name:"d11_8",x:160,y:150,width:12,height:17},{name:"d11_9",x:180,y:150,width:12,height:17},{name:"d12_0",x:0,y:130,width:12,height:17},{name:"d12_1",x:20,y:130,width:12,height:17},{name:"d12_2",x:40,y:130,width:12,height:17},{name:"d12_3",x:60,y:130,width:12,height:17},{name:"d12_4",x:80,y:130,width:12,height:17},{name:"d12_5",x:100,y:130,width:12,height:17},{name:"d12_6",x:120,y:130,width:12,height:17},{name:"d12_7",x:140,y:130,width:12,height:17},{name:"d12_8",x:160,y:130,width:12,height:17},{name:"d12_9",x:180,y:130,width:12,height:17}]}),define("textures",function(){}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=this,n=Array.prototype.slice.call(arguments,1),r=function(){},i=function(){return t.apply(this instanceof r&&e?this:e,n.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),typeof Object.create!="function"&&function(){var e=function(){};Object.create=function(t){if(arguments.length>1)throw Error("Second argument not supported!");if(t===null||typeof t!="object")throw Error("Invalid prototype!");return e.prototype=t,new e}}(),define("polyfills",function(){}),ForceLayout.prototype.onStart=function(){},ForceLayout.prototype.onTick=function(){},ForceLayout.prototype.onEnd=function(){},ForceLayout.prototype.start=function(){function u(e,t){var n=f(i),r=-1,s=n.length,o;while(++r<s)if(!isNaN(o=n[r][e]))return o;return Math.random()*t}function f(){if(!a){a=[];for(s=0;s<e;++s)a[s]=[];for(s=0;s<t;++s){var n=this._links[s];a[n.source.index].push(n.target),a[n.target.index].push(n.source)}}return a[i]}var e=this._nodes.length,t=this._links.length,n=this._size[0],r=this._size[1],i,s,o;for(i=0;i<e;++i)o=this._nodes[i],o.index=i,o.weight=0;for(i=0;i<t;++i)o=this._links[i],typeof o.source=="number"&&(o.source=this._nodes[o.source]),typeof o.target=="number"&&(o.target=this._nodes[o.target]),++o.source.weight,++o.target.weight;for(i=0;i<e;++i)o=this._nodes[i],isNaN(o.x)&&(o.x=u("x",n)),isNaN(o.y)&&(o.y=u("y",r)),isNaN(o.px)&&(o.px=o.x),isNaN(o.py)&&(o.py=o.y);this._distances=[];if(typeof this._linkDistance=="function")for(i=0;i<t;++i)this._distances[i]=+this._linkDistance.call(this,this._links[i],i);else for(i=0;i<t;++i)this._distances[i]=this._linkDistance;this._strengths=[];if(typeof this._linkStrength=="function")for(i=0;i<t;++i)this._strengths[i]=+this._linkStrength.call(this,this._links[i],i);else for(i=0;i<t;++i)this._strengths[i]=this._linkStrength;this._charges=[];if(typeof this._charge=="function")for(i=0;i<e;++i)this._charges[i]=+this._charge.call(this,this._nodes[i],i);else for(i=0;i<e;++i)this._charges[i]=this._charge;var a=!1;return this.resume()},ForceLayout.prototype.tick=function(){if((this._alpha*=.99)<this._minAlpha)return this.onEnd(this._alpha=0),!0;var e=this._nodes.length,t=this._links.length,n,r,i,s,o,u,a,f;for(n=0;n<t;++n){r=this._links[n],i=r.source,s=r.target,a=s.x-i.x,f=s.y-i.y;if(o=a*a+f*f)o=this._alpha*this._strengths[n]*((o=Math.sqrt(o))-this._distances[n])/o,a*=o,f*=o,s.x-=a*(u=i.weight/(s.weight+i.weight)),s.y-=f*u,i.x+=a*(u=1-u),i.y+=f*u}if(u=this._alpha*this._gravity){a=this._size[0]/2,f=this._size[1]/2,n=-1;if(u)while(++n<e)r=this._nodes[n],r.x+=(a-r.x)*u,r.y+=(f-r.y)*u}if(this._charge){this._quad=new QuadTree(this._nodes),this.accumulate(this._quad),n=-1;while(++n<e)(r=this._nodes[n]).fixed||this._quad.visit(this.repulse(r))}n=-1;while(++n<e)r=this._nodes[n],r.fixed?(r.x=r.px,r.y=r.py):(r.x-=(r.px-(r.px=r.x))*this._friction,r.y-=(r.py-(r.py=r.y))*this._friction);this.onTick(this._alpha)},ForceLayout.prototype.alpha=function(e){return arguments.length?(e=+e,this._alpha?e>0?this._alpha=e:this._alpha=0:e>0&&this.onStart(this._alpha=e),this):this._alpha},ForceLayout.prototype.resume=function(){return this.alpha(.1)},ForceLayout.prototype.stop=function(){return this.alpha(0)},ForceLayout.prototype.size=function(e){return arguments.length?(this._size=e,this):this._size},ForceLayout.prototype.linkDistance=function(e){return arguments.length?(this._linkDistance=typeof e=="function"?e:+e,this):this._linkDistance},ForceLayout.prototype.linkStrength=function(e){return arguments.length?(this._linkStrength=typeof e=="function"?e:+e,this):this._linkStrength},ForceLayout.prototype.friction=function(e){return arguments.length?(this._friction=+e,this):this._friction},ForceLayout.prototype.charge=function(e){return arguments.length?(this._charge=typeof e=="function"?e:+e,this):this._charge},ForceLayout.prototype.gravity=function(e){return arguments.length?(this._gravity=+e,this):this._gravity},ForceLayout.prototype.theta=function(e){return arguments.length?(this._theta=+e,this):this._theta},ForceLayout.prototype.minAlpha=function(e){return arguments.length?(this._minAlpha=+e,this):this._minAlpha},ForceLayout.prototype.accumulate=function(e){var t=0,n=0;e.charge=0;if(!e.leaf){var r=e.quads,i=r.length,s=-1,o;while(++s<i)o=r[s],o&&(this.accumulate(o),e.charge+=o.charge,t+=o.charge*o.cx,n+=o.charge*o.cy)}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var u=this._alpha*this._charges[e.point.index];e.charge+=e.pointCharge=u,t+=u*e.point.x,n+=u*e.point.y}e.cx=t/e.charge,e.cy=n/e.charge},ForceLayout.prototype.repulse=function(e){return function(t,n,r,i,s){if(t.point!==e){var o=t.cx-e.x,u=t.cy-e.y,a=1/Math.sqrt(o*o+u*u);if((i-n)*a<this._theta){var f=t.charge*a*a;return e.px-=o*f,e.py-=u*f,!0}if(t.point&&isFinite(a)){var f=t.pointCharge*a*a;e.px-=o*f,e.py-=u*f}}return!t.charge}.bind(this)},QuadTree.prototype.visit=function(e,t,n,r,i){if(e(this,t,n,r,i))return;if(this.quads){var s=(t+r)*.5,o=(n+i)*.5,u=this.quads;u[0]&&u[0].visit(e,t,n,s,o),u[1]&&u[1].visit(e,s,n,r,o),u[2]&&u[2].visit(e,t,o,s,i),u[3]&&u[3].visit(e,s,o,r,i)}},QuadTree.prototype.insert=function(e,t,n,r,i,s,o){if(isNaN(t)||isNaN(n))return;if(!this.leaf)this.insertChild(e,t,n,r,i,s,o);else if(this.x==null)this.x=t,this.y=n,this.point=e;else if(Math.abs(this.x-t)+Math.abs(this.y-n)<.01)this.insertChild(e,t,n,r,i,s,o);else{var u=this.x,a=this.y,f=this.point;this.x=this.y=this.point=null,this.insertChild(f,u,a,r,i,s,o),this.insertChild(e,t,n,r,i,s,o)}},QuadTree.prototype.insertChild=function(e,t,n,r,i,s,o){this.leaf=!1;var u=(r+s)*.5,a=(i+o)*.5,f=t>=u,l=n>=a,c=(l<<1)+f;this.quads=this.quads||[];var h=this.quads[c]||(this.quads[c]=new QuadTree);f?r=u:s=u,l?i=a:o=a,h.insert(e,t,n,r,i,s,o)},define("force",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,TOP=typeof TOP=="number"?TOP:0,HELP=typeof HELP=="function"?HELP:null,START=typeof START=="function"?START:null;var ID=0,Level={},Conf={};Conf.scale=1,Conf.nodeRadius=14*Conf.scale,Conf.nodeSnap=Conf.nodeRadius*2,Conf.nodeMark=Conf.nodeRadius*5,Conf.distRange=50*Conf.scale,Conf.distOffset=100*Conf.scale,Conf.speedTime=6e4;var Color={};Color.rock=0,Color.r=1,Color.g=2,Color.b=3,Color.y=4,Color.wildcard=11,Color.bomb=12,Color.joker=13,Color.four=[Color.r,Color.g,Color.b,Color.y],Color.random=function(e,t){if(!e)return Color.four.sample();var n=Color.four.sample(t||_.random(1,e)),r=[];for(var i=0;i<e;i++)r.push(n.at(i));return r},Color.life=function(e){return e==Color.bomb||e==Color.wildcard?1:-1};var Mode={};Mode.design=0,Mode.stream=1,Mode.cross=2,Mode.learn=3,Mode.collect=4,Mode.test=5,Mode.speed=6,Mode.compete=7,Mode.loadover=1,Mode.timeover=2,Mode.fallback=Mode.collect,Mode.clazz={},Mode.clazz[Mode.design]=DesignMode,Mode.clazz[Mode.stream]=StreamMode,Mode.clazz[Mode.cross]=CrossMode,Mode.clazz[Mode.learn]=LearnMode,Mode.clazz[Mode.collect]=CollectMode,Mode.clazz[Mode.test]=BaseMode,Mode.clazz[Mode.speed]=SpeedMode,Mode.clazz[Mode.compete]=CompeteMode;var Status={};Status.mode=-1,Status.level=0,Status.score=0,Status.moves=0,Status.hits=0,Status.players=1,Status.player=0,Status.stats={},Status.luid=1,Four.saveKeys={me:!0,color:!0,joker:!0,x:!0,y:!0,owner:!0};var Temp={};Temp.progress={},Temp.lastScore=null,Temp.lastHits=null,Temp.lastPlayer=null;var Flag={};Flag.designing=!1,Flag.loadover=!1,Flag.timeover=!1,Flag.multi=!1,Four.nodes=[],Four.links=[],Four.hints=[],Four.layout=null,Four.dragIn=null,Four.dragOut=null,Four.dragLine=null,Four.init=function(){Four.layout?(Four.stopDrag(),Four.clearPrompt()):(Four.dragIn=(new Marker("in")).insert(),Four.dragOut=(new Marker("out",Four.dragIn)).insert(),Four.dragLine=(new DragLine).insert(),Four.layout=(new ForceLayout(Four.nodes,Four.links)).size([0,0]).linkDistance(45*Conf.scale).charge(-180*Conf.scale*Conf.scale).linkStrength(.5).friction(.8).minAlpha(.01),Four.layout.onTick=Four.tickLayout.bind(Four),Four.layout.onStart=Four.resume.bind(Four))},Four.animate=function(){Four.layout.tick()||Four.resume()},Four.start=function(e,t,n,r,i,s,o,u,a,f,l){a=a||[],f=f||[],Four.init(),Four.queueReset(),this.playmode=new Mode.clazz[e],Flag=_.mergedPrototypeProperty(Mode.clazz[e],"flag"),DEBUG&&console.log("flags: ",Flag),Status.mode=e,Status.luid=t||1,Status.level=n||1,Status.moves=s||0,Status.player=r||0,Status.players=i||Flag.players,Status.stats=l||{},Status.hits=o||(Status.players>1?_.repeat(0,Status.players):0),Status.score=u||(Status.players>1?_.repeat(0,Status.players):0),Temp.progress={},Item.removeAll(Four.links.splice(0)),Item.removeAll(Four.nodes.splice(0)),Item.removeAll(Four.hints.splice(0)),Four.stopLayout(),a&&a.length||f&&f.length?(a.forEach(function(e){Dot.insert(e,!0)}),f.forEach(function(e){Link.insert(e,!0)}),Four.kickInfo()):Four.kickOn()},Four.reset=function(e,t){DEBUG&&console.log("reset: "+e),e=Mode.clazz[e]?e:Mode.fallback;if(e==Mode.test){Four.loadGame(Mode.design,Mode.test);return}localStorage.setItem("mode",e),e!=Status.mode?Four.loadGame(e)||Four.start(e):t?Four.start(e):Four.confirm(["Reset?"],function(t){t&&Four.start(e)})},Four.loadGame=function(e,t){DEBUG&&console.log("load: "+e),e=e||localStorage.getItem("mode");if(!Mode.clazz[e])return!1;var n=localStorage.getItem("game_mode_"+e);if(!n)return!1;try{return n=JSON.parse(n),Four.deserializeGraph(n._nodes,n._links),Four.start(t||n._mode,n._luid,n._level,n._player,n._players,n._moves,n._hits,n._score,n._nodes,n._links,n._level_stats),!0}catch(r){return console.log(r),!1}},Four.saveGame=function(e){Four.kickInfo(),clearTimeout(this.addNodesTimeout),e>0?this.saveGameTimeout=setTimeout(function(){Four.saveGame()}.bind(this),e):this.saveGameTimeout=null,DEBUG&&console.log("save: "+Status.mode);var t=JSON.stringify({_mode:Status.mode,_level:Status.level,_score:Status.score,_moves:Status.moves,_hits:Status.hits,_players:Status.players,_player:Status.player,_luid:Status.luid,_nodes:Four.nodes,_links:Four.links,_level_stats:Status.stats},function(e,t){var n;if(e=="")n=t;else if(_.isNumber(e)||/\d+/.test(e))n=t;else if(e[0]=="_")n=t;else if(e=="x"||e=="y")n=_.isNumber(t)?Math.round(t):t;else if(e=="source"||e=="target")n=t.me;else{if(!Four.saveKeys[e])return;n=t}return n});localStorage.setItem("game_mode_"+Status.mode,t)},Four.deserializeGraph=function(e,t){var n={},r={};e&&e.forEach(function(t,r){e[r]=n[t.me||r]=Dot.create(t)}),t&&t.forEach(function(e,n){t[n]=r[e.me||n]=Link.create(e)}),t&&t.forEach(function(e){e.source&&!e.source.isNode&&(e.source=n[e.source],e.source.links.indexOf(e)<0&&e.source.links.push(e)),e.target&&!e.target.isNode&&(e.target=n[e.target],e.target.links.indexOf(e)<0&&e.target.links.push(e))}),e&&e.forEach(function(e){e.links&&e.links.forEach(function(t,n){_.isObject(t)||(e.links[n]=r[t])}),e.linkto&&e.linkto.map(function(t,r){_.isObject(t)||(e.linkto[r]=n[t])}),e.hintto&&e.hintto.forEach(function(t,r){_.isObject(t)||(e.hintto[r]=n[t])})})},Four.stopLayout=function(){Four.layout.stop()},Four.kickLayout=function(e){DEBUG&&console.log("kick-layout: "+Four.nodes.length+" "+Four.links.length),DEBUG&&console.log(""+Four.nodes),DEBUG&&console.log(""+Four.links),Four.layout.start()},Four.tickLayout=function(){for(var e=0;e<Four.nodes.length;e++)Four.nodes[e].onUpdate();for(var e=0;e<Four.links.length;e++)Four.links[e].onUpdate();for(var e=0;e<Four.hints.length;e++)Four.hints[e].onUpdate();Four.tickDrag()},Four.tickDrag=function(){Four.dragIn.tick(),Four.dragOut.tick(),Four.dragLine.tick()},Four.stopDrag=function(){Four.dragIn.update(null),Four.dragOut.update(null),Four.dragLine.update(null),Four.findDragOut(null,!0)},Four.kickInfo=function(){DEBUG&&console.log("kick-info"),Temp.maxNodes=Four.playmode.maxNodes(Status.level),Temp.progress.required=0,Temp.progress.progress=0,Temp.progress.remained=0,Temp.progress.completed=!1,Four.playmode.updateProgress(Temp.progress),Four.redrawInfo()},Four.kickOn=function(e){DEBUG&&console.log("kick-on"),Four.playmode.kickGame(e),Four.playmode.kickNodes()},Four.isLinkable=function(e){return Four.playmode.isLinkable?Four.playmode.isLinkable(e):!0},Four.mouseDown=function(e){DEBUG&&console.log("mouse-down: "+e),e=e?{x:e.x,y:e.y}:null;var t=Four.nearestNode(e,Conf.nodeSnap);DEBUG&&console.log("node-in: "+t),Item.select(t),t&&Four.dragIn.update(t),Four.tickDrag()},Four.mouseMove=function(e){e=e?{x:e.x,y:e.y}:null;if(Item.selected&&Item.selected.isNode)return Four.dragLine.update(Item.selected,e),Four.findDragOut(e),Four.tickDrag(),!0},Four.mouseUp=function(e){DEBUG&&console.log("mouse-up: "+e+" (in: "+t+")"),Four.stopDrag(),e=e?{x:e.x,y:e.y}:null;var t=Item.selected;if(!t||!e)return;var n=Four.nearestNode(e,Conf.nodeSnap);DEBUG&&console.log("node-out: "+n),!n&&Flag.designing&&(n=Dot.insert(e),Item.select(n)),n&&n!==t&&Link.insert({s:t,t:n},!1)},Four.mouseCancel=function(){return DEBUG&&console.log("mouse-cancel"),this.mouseUp(null)},Four.findDragOut=function(e,t){clearTimeout(Four.findDragOutTimeout),Four.findDragOutTimeout=null;if(!t){Four.findDragOutTimeout=setTimeout(Four.findDragOut.bind(this,e,!0),10);return}Four.dragOut.update(e?Four.nearestNode(e,Conf.nodeSnap):null)},Four.mouseDouble=function(e){DEBUG&&console.log("mouse-double: "+e),Flag.designing&&(Dot.insert(e,!0),Four.save(2e3))},Four.afterInsertNode=function(e,t){DEBUG&&console.log("after-insert-node: "+e+", "+t),Four.playmode.afterInsertNode&&Four.playmode.afterInsertNode(e,t)},Four.afterRemoveNode=function(e){DEBUG&&console.log("after-remove-node: "+e),Four.playmode.afterRemoveNode&&Four.playmode.afterRemoveNode(e)},Four.afterInsertLink=function(e,t){DEBUG&&console.log("after-insert-link: "+e+", "+t),Four.playmode.afterInsertLink&&Four.playmode.afterInsertLink(e,t)},Four.afterRemoveLink=function(e){DEBUG&&console.log("after-remove-link: "+e),Four.playmode.afterRemoveLink&&Four.playmode.afterRemoveLink(e)},BaseMode.prototype.flag={players:1},BaseMode.prototype.maxNodes=function(e){return Math.min(64,16*e)},BaseMode.prototype.updateProgress=function(e){},BaseMode.prototype.isLinkable=function(e){var t=e.source,n=e.target;return t.links&&t.links.length>=4||n.links&&n.links.length>=4?!1:t.color==Color.rock&&n.color!=Color.bomb&&n.color==Color.rock&&t.color!=Color.bomb?!1:!0},BaseMode.prototype.afterInsertLink=function(e,t){if(t)return;setTimeout(function(){var t=[],n=[];this.testLink(function(e,r){e&&e.length&&(t.push(e),n.push(r||[]))},e),this.removeFour(t,n)}.bind(this),50)},BaseMode.prototype.removeFour=function(e,t){e=_(e).flatten(1).filter(function(e){return e.remove()}),DEBUG&&console.log("four-remove: "+e),Four.kickOn.bind(this,e).delay()},BaseMode.prototype.kickGame=function(e){DEBUG&&console.log("kick-game: "+Status.mode);var t=null,n=null;e&&(Flag.multi?(t=_.repeat(0,Status.players),e.forEach(function(e){t[e.owner]++}),n=t.map(function(e,t){var n=e?Math.pow(e,2)+10:0;return t==Status.player&&n++,Status.hits[t]+=e,Status.score[t]+=n,n})):(t=e.length,n=1,t>0&&(n+=Math.pow(t,2)+10),Status.hits+=t,Status.score+=n),Status.moves++,!Flag.multi&&t&&Four.playCombo(e.length)),Temp.lastHits=t,Temp.lastScore=n,Temp.lastPlayer=Status.player,Four.kickInfo();if(Flag.loadover&&Four.nodes.length>Temp.maxNodes){Four.promptStatus(Mode.loadover,function(){Four.reset(Status.mode,!0)});return}e&&Flag.multi&&(Status.player=(Status.player+1)%Status.players)},BaseMode.prototype.kickNodes=function(){DEBUG&&console.log("kick-nodes");var e=[];for(var t=Four.nodes.length-1;t>-1;t--){var n=Four.nodes[t];n.joker&&n.setColor(Color.four.next(n.color)),n.life>0&&n.links.length==0&&--n.life==0&&n.remove(),n.color==Color.rock&&e.push(n)}for(var t=e.length-1;t>-1;t--){var n=e[t];n.links.length==0&&n.remove()}},BaseMode.prototype.randomNodes=function(e){if(Four.nodes.length==0)return(new Graph).array(Color.random(4,4));var t=new Graph;return BaseMode.randomBW.test().random(e)(t),BaseMode.randomGraph.test().random(e)(t),t.row(_.random(1,e)),t},BaseMode.prototype.testNodes=function(e,t,n){this.testColors(t)&&e(t,n)},BaseMode.prototype.testLink=function(e,t,n){DEBUG&&console.log("test-link: "+t+" "+n);var r=t.source,i=t.target;if(r.color===Color.rock||i.color===Color.rock)return;this.testNodes(e,[r,i],[t]),r.links.forEach(function(n){if(n===t)return;var o=n.otherSide(r);i.links.forEach(function(u){if(u===t)return;var a=u.otherSide(i);if(a===o)return;this.testNodes(e,[o,r,i,a],[n,t,u])},this)},this),n||(r.links.forEach(function(n){if(n===t)return;var o=n.otherSide(r);this.testNodes(e,[o,r,i],[n,t]),this.testLink(e,n,t)},this),i.links.forEach(function(n){if(n===t)return;var o=n.otherSide(i);this.testNodes(e,[r,i,o],[t,n]),this.testLink(e,n,t)},this))},BaseMode.prototype.testColors=function(e){DEBUG&&console.log("test-color: "+e);if(!_.isArray(e))return!1;var t=this.COLOR_TEST=this.COLOR_TEST||{};return t[Color.r]=0,t[Color.g]=0,t[Color.b]=0,t[Color.y]=0,t[Color.wildcard]=0,t[Color.bomb]=0,e.forEach(function(e){e.color==Color.wildcard||e.color==Color.bomb?t[e.color]+=1:t[e.color]=1}),t[Color.r]+t[Color.g]+t[Color.b]+t[Color.y]+t[Color.wildcard]+t[Color.bomb]*4>=4},LearnMode.prototype=new BaseMode,LearnMode.prototype._super=BaseMode,LearnMode.prototype.constructor=LearnMode,LearnMode.prototype.isLinkable=function(e){return!e.source.findHintto(e.target)&&!e.target.findHintto(e.source)?!1:BaseMode.prototype.isLinkable.call(this,e)},LearnMode.prototype.removeFour=function(e,t){function n(){return LearnMode.prototype._super.prototype.removeFour.call(this,e,t)}if(!e.length)return n();Four.nodes.forEach(function(e){e.mute()}),Four.links.forEach(function(e){e.mute()});var r=0,i=function(){if(r>=e.length)return Four.nodes.forEach(function(e){e.unmute()}),Four.links.forEach(function(e){e.unmute()}),n();var s=e.at(r),o=t.at(r);r++,s.forEach(function(e){e.unmute()}),o.forEach(function(e){e.unmute()}),function(){s.forEach(function(e){e.mute()}),o.forEach(function(e){e.mute()}),i()}.delay(900)};i()},LearnMode.prototype.kickGame=function(e){LearnMode.prototype._super.prototype.kickGame.call(this,e);if(Four.nodes.length==0){e&&Status.level++;var t=Status.level-1;t>=Level.learn.length?(Status.level=1,Four.saveGame(),Four.reset.delay(1)):(Four.saveGame(),t=JSON.parse(JSON.stringify(Level.learn[t])),Four.deserializeGraph(t.nodes),Four.queueAdd((new Graph).array(t.nodes)))}},LearnMode.prototype.kickNodes=function(){return},CollectMode.prototype=new BaseMode,CollectMode.prototype._super=BaseMode,CollectMode.prototype.constructor=CollectMode,CollectMode.prototype.flag={loadover:!0},CollectMode.prototype.updateProgress=function(e){e.colors=[Color.r,Color.y,Color.g,Color.b,Color.wildcard,Color.bomb],e.colors.forEach(function(t){var n=Level.collect[t];if(!n)return;var r=n[Status.level-1],i=Status.stats[t]||0,s=Math.max(0,r-i);e[t]={required:r,progress:i,remained:s},e.required+=r,e.progress+=i,e.remained+=s}),e.level={required:Level.collect.levels,progress:Status.level,remained:Level.collect.levels-Status.level},e.completed=e.remained<=0},CollectMode.prototype.kickGame=function(e){e&&e.forEach(function(e){Status.stats[e.color]=(Status.stats[e.color]||0)+1}),CollectMode.prototype._super.prototype.kickGame.call(this,e),Status.level=(Status.level-1)%Level.collect.levels+1,Temp.progress.completed&&(Status.level=Status.level%Level.collect.levels+1,Four.promptLevel(),Status.stats={},Item.removeAll(Four.links.splice(0)),Item.removeAll(Four.nodes.splice(0)),Item.removeAll(Four.hints.splice(0))),Four.kickInfo(),Four.queueAdd(this.randomNodes(Status.level),Four.saveGame)},StreamMode.prototype=new BaseMode,StreamMode.prototype._super=BaseMode,StreamMode.prototype.constructor=StreamMode,StreamMode.prototype.flag={loadover:!0},StreamMode.prototype.updateProgress=function(e){e.required=Level.stream.required(Status.level),e.progress=Status.score,e.remained=Math.max(0,e.required-e.progress),e.score=e,e.completed=e.remained<=0},StreamMode.prototype.kickGame=function(e){StreamMode.prototype._super.prototype.kickGame.call(this,e),Temp.progress.completed&&(Status.level++,Four.promptLevel()),Four.kickInfo(),Four.queueAdd(this.randomNodes(Status.level),Four.saveGame)},StreamMode.prototype.randomNodes=function(e){return Four.nodes.length==0?(new Graph).array(Color.random(4,Status.moves?1:4)):StreamMode.prototype._super.prototype.randomNodes.call(this,e)},SpeedMode.prototype=new BaseMode,SpeedMode.prototype._super=BaseMode,SpeedMode.prototype.constructor=SpeedMode,SpeedMode.prototype.maxNodes=function(e){return 64},SpeedMode.prototype.updateProgress=function(e){var t=+(new Date);e.required=Math.round((this.end-this.start)/1e3),e.progress=Math.round((t-this.start)/1e3),e.remained=Math.round((this.end-t)/1e3),e.time=e},SpeedMode.prototype.kickGame=function(e){SpeedMode.prototype._super.prototype.kickGame.call(this,e);var t=Temp.lastHits;if(Status.moves==0)Four.saveGame(),this.start=+(new Date),this.end=this.start+Conf.speedTime,Four.kickInfo();else if(Status.moves==1){this.start=+(new Date),this.end=this.start+Conf.speedTime;var n=this;function r(){if(Four.playmode!==n)return;+(new Date)>n.end?Four.promptStatus(Mode.timeover,function(){Four.reset(Status.mode,!0)}):(setTimeout(r,250),Four.kickInfo())}r()}else if(t){var i=t*t*100;this.end=Math.min(this.end+i,+(new Date)+Conf.speedTime)}Status.level=Math.ceil((this.end-this.start)/Conf.speedTime*3)||1,Four.queueAdd(this.randomNodes(Status.level))},SpeedMode.prototype.randomNodes=function(e){if(Four.nodes.length==0)return(new Graph).array(Color.random(4,4));var t=new Graph;return BaseMode.randomBW.test().random(e)(t),SpeedMode.randomGraph.test().random(e)(t),t.row(_.random(1,e)),t},SpeedMode.prototype.flag={loadover:!0,timeover:!0},CrossMode.prototype=new BaseMode,CrossMode.prototype._super=BaseMode,CrossMode.prototype.constructor=CrossMode,CrossMode.prototype.flag={},CrossMode.prototype.kickGame=function(e){CrossMode.prototype._super.prototype.kickGame.call(this,e);if(Four.nodes.length==0){e&&Status.level++;var t=new Graph;t.one({color:Color.wildcard,life:-1}),t.one(Color.bomb);var n=Math.min(Math.pow(Status.level+2,2)/4,94);for(var r=0;r<n;r++)t.row(4,.5);Four.queueAdd(t,Four.saveGame)}else Four.saveGame()},DesignMode.prototype=new BaseMode,DesignMode.prototype._super=BaseMode,DesignMode.prototype.constructor=DesignMode,DesignMode.prototype.flag={designing:!0},DesignMode.prototype.isLinkable=function(e){return!0},DesignMode.prototype.afterInsertNode=function(e,t){!Item.selected&&Item.select(e)},DesignMode.prototype.afterRemoveNode=function(e){Item.select(Four.nodes.length>0?Four.nodes[Four.nodes.length-1]:null),Four.kickOn()},DesignMode.prototype.afterInsertLink=function(e,t){Item.select(e),Four.saveGame(2e3)},DesignMode.prototype.kickGame=function(e){DesignMode.prototype._super.prototype.kickGame.call(this,e),this.addNodes()},DesignMode.prototype.addNodes=function(e){e&&Four.nodes.length<2?Four.queueAdd(1,function(){Four.save(2e3),this.addNodes(!1)}.bind(this)):(clearTimeout(this.addNodesTimeout),this.addNodesTimeout=setTimeout(function(){this.addNodes(!0)}.bind(this),Math.pow(Four.nodes.length,2)*200))},CompeteMode.prototype=new BaseMode,CompeteMode.prototype._super=BaseMode,CompeteMode.prototype.constructor=CompeteMode,CompeteMode.prototype.isLinkable=function(e){return e.source.notOwner(Status.player)&&e.target.notOwner(Status.player)?!1:BaseMode.prototype.isLinkable.call(this,e)},CompeteMode.prototype.flag={multi:!0,players:2},CompeteMode.prototype.kickGame=function(e){CompeteMode.prototype._super.prototype.kickGame.call(this,e);var t=Four.nodes.length==0?4:1;Four.queueAdd((new Graph).one(Color.random(t,t)),Four.saveGame)},Graph.prototype.array=function(e){return DEBUG&&console.log("graph-array: "+e),this.nodes.push.apply(this.nodes,Dot.array(e)),this},Graph.prototype.one=function(e){return DEBUG&&console.log("graph-one: "+e),this.nodes.push(Dot.create(e)),this},Graph.prototype.tree=function(e,t){DEBUG&&console.log("graph-tree: "+e+"/"+t);var n=[];for(var r=0;r<t.length;r++)for(var i=0;i<Math.pow(e,r);i++){var s=Dot.create(t[r]);this.nodes.push(s),n.length>0&&s.addLinkto(n.shift());for(var o=0;o<e;o++)n.push(s)}return this},Graph.prototype.star=function(e){DEBUG&&console.log("graph-star: "+e),e=Dot.array(e);var t=null;return e.forEach(function(e){this.nodes.push(e),t?e.addLinkto(t):t=e},this),this},Graph.prototype.row=function(e,t){DEBUG&&console.log("graph-row: "+e),e=Dot.array(e);var n=null;return e.forEach(function(e){this.nodes.push(e),n&&(!t||t<Math.random())&&e.addLinkto(n),n=e},this),this},Graph.prototype.complete=function(e,t){DEBUG&&console.log("graph-complete: "+e),e=Dot.array(e);var n=[];return e.forEach(function(e){this.nodes.push(e),n.forEach(function(n){(!t||t<Math.random())&&e.addLinkto(n)},this),n.push(e)},this),this},Four.nearestNode=function(e,t){if(!e)return null;var n=e.x,r=n-t,i=n+t,s=e.y,o=s-t,u=s+t,a=null,f=t*t;for(var l=0;l<Four.nodes.length;l++){var c=Four.nodes[l];if(r<=c.x&&c.x<=i&&o<=c.y&&c.y<=u){var h=c.x-n,p=c.y-s,d=h*h+p*p;d<f&&(f=d,a=c)}}return a},Four.queueReset=function(){DEBUG&&console.log("queue-reset"),Four.queue=Four.queue||[],Four.queue.splice(0),Four.queueTimeout&&(clearTimeout(Four.queueTimeout),Four.queueTimeout=null)},Four.queueAdd=function(e,t){DEBUG&&console.log("queue-add: "+e.nodes.length),DEBUG&&console.log(""+e.nodes),Four.queue=Four.queue||[],Four.queue.push([function(){},10]),e.nodes.forEach(function(e){Four.queue.push([function(){Dot.insert(e,!0)},150])}),e.nodes.forEach(function(e){e.linkto&&e.linkto.forEach(function(t){Four.queue.push([function(){Link.insert({source:e,target:t},!0)},50])})}),e.nodes.forEach(function(e){e.hintto&&e.hintto.forEach(function(t){Four.queue.push([function(){Hint.insert({source:e,target:t})},0])})}),t&&Four.queue.push([t,0]),Four.queueTimeout||Four.queueRunner()},Four.queueRunner=function(){Four.queueTimeout=null;var e=Four.queue.shift();e&&e.length==2&&(e[0]&&e[0](),Four.queueTimeout=setTimeout(Four.queueRunner,e[1]))},Item.prototype.select=function(){return this.selected=!0,this.onUpdate(),this},Item.prototype.deselect=function(){return this.selected=!1,this.onUpdate(),this},Item.prototype.mute=function(){this.muted=!0,this.onUpdate()},Item.prototype.unmute=function(){this.muted=!1,this.onUpdate()},Item.prototype.hasOwner=function(){return this.owner===0||this.owner>0},Item.prototype.notOwner=function(e){return this.hasOwner()&&this.owner!=e},Item.prototype.changeOwner=function(e,t,n){DEBUG&&console.log("item-chown: "+e+" "+this);if(t>=2)return;n?this.hasOwner()||(this.owner=e):this.isLink?(this.owner=e,this.source.changeOwner(e,1,this.removed),this.target.changeOwner(e,1,this.removed)):this.isNode&&(this.owner=e,this.links.forEach(function(n){n.owner=e,n.otherSide(this).changeOwner(e,t+1)},this))},Item.select=function(e){DEBUG&&console.log("item-select: "+e),Item.selected&&Item.selected.deselect(),Item.selected=e&&(e.isNode||e.isLink&&Flag.designing)?e:null,Item.selected&&Item.selected.select()},Item.removeAll=function(e){e&&e.forEach(function(e){e.remove()})},Dot.prototype=new Item,Dot.prototype._super=Item,Dot.prototype.constructor=Dot,Dot.prototype.setColor=function(e){this.color=Color.four.next(this.color),this.onUpdate()},Dot.prototype.findLink=function(e,t){var n=!1,r=!1;for(var i=0;i<this.links.length;i++){var s=this.links[i];t&&s===t?r=!0:e&&s.hasNode(e)&&(n=!0)}return r?2:n?1:0},Dot.prototype.findLinkto=function(e){return this.linkto&&this.linkto.some(function(t){return t==e})},Dot.prototype.addLinkto=function(e,t){(this.linkto=this.linkto||[]).push(e),t&&(e.linkto=e.linkto||[]).push(this)},Dot.prototype.findHintto=function(e){return this.hintto&&this.hintto.some(function(t){return t==e})},Dot.prototype.addHintto=function(e,t){(this.hintto=this.hintto||[]).push(e),t&&(e.hintto=e.hintto||[]).push(this)},Dot.prototype.toString=function(){return"n:"+this.me+"/"+this.id+" ("+this.color+", "+Math.round(this.x)+"x"+Math.round(this.y)+")"},Dot.array=function(e){return DEBUG&&console.log("node-array: "+e),_.isArray(e)?e.map(function(e){return Dot.create(e)}):_.isNumber(e)?_.range(0,e).map(function(){return Dot.create()}):[]},Dot.pool=(new Pool(function(){return new Dot},function(e){},function(e){e.links=[],e.id=ID++,delete e.me,delete e.removed,delete e.muted,delete e.selected,delete e.color,delete e.joker,delete e.life,delete e.a,delete e.r,delete e.x,delete e.y,delete e.linkto,delete e.hintto,delete e.px,delete e.py,delete e.index,delete e.weight})).max(0).name("nodes"),Dot.create=function(e){DEBUG&&console.log("node-create: ",e&&e.isNode?e.toString():e);var t;_.isNumber(e)?(t=Dot.pool.checkOut(),t.color=e,e=t):e?e.isNode?t=e:t=Dot.pool.checkOut():(t=Dot.pool.checkOut(),e=t),t.me=_.isNumber(e.me)?e.me:Status.luid++,t.color=_.isNumber(e.color)?e.color:Flag.designing?Color.rock:Color.random(),t.life=e.life||Color.life(t.color);if(_.isNumber(e.x)&&_.isNumber(e.y))t.x=e.x,t.y=e.y;else{var n=(_.isNumber(e.a)?e.a:Math.random())*2*Math.PI,r=_.isNumber(e.r)?e.r:Math.random()*Conf.distRange+Conf.distOffset;t.x=Math.sin(n)*r,t.y=Math.cos(n)*r}return t.linkto=e.linkto,t.hintto=e.hintto,DEBUG&&console.log("node-created: "+t),t},Dot.insert=function(e,t){return e.removed?null:(DEBUG&&console.log("node-insert: "+e),e=Dot.create(e),Four.nodes.push(e),e.onInsert(),Four.kickLayout(),Four.afterInsertNode(e,t),e)},Dot.prototype.remove=function(){return DEBUG&&console.log("node-remove: "+this+" "+this.links),this.removed?!1:(this.removed=!0,Four.nodes.drop(this),this.onRemove(),Item.removeAll(this.links.slice(0)),_(Four.hints).filter(function(e){return e.hasNode(this)},this).forEach(function(e){e.remove()}),Four.afterRemoveNode(this),!0)},Link.prototype=new Item,Link.prototype._super=Item,Link.prototype.constructor=Link,Link.prototype.hasNode=function(e){return this.source===e||this.target===e},Link.prototype.otherSide=function(e){return e===this.target?this.source:this.target},Link.prototype.toString=function(){return"l:"+this.me+"/"+this.id+" ("+this.source+", "+this.target+")"},Link.pool=(new Pool(function(){return new Link},function(e){},function(e){e.id=ID++,delete e.me,delete e.removed,delete e.muted,delete e.selected,delete e.source,delete e.target,delete e.duration})).max(0).name("links"),Link.create=function(e){DEBUG&&console.log("link-create: ",e&&e.isLink?e.toString():e);var t;return e?e.isLink?t=e:t=Link.pool.checkOut():(t=Link.pool.checkOut(),e=t),t.me=_.isNumber(e.me)?e.me:Status.luid++,t.source=e.source||e.s,t.target=e.target||e.t,t},Link.insert=function(e,t){DEBUG&&console.log("link-insert: "+e),e=Link.create(e);if(e.removed||e.source.removed||e.target.removed)return null;e.source=Dot.create(e.source),e.target=Dot.create(e.target);if(!t&&!Four.isLinkable(e,t))return null;var n=e.source.findLink(e.target,e),r=e.target.findLink(e.source,e);return n==1||r==1?null:(n==0&&e.source.links.push(e),r==0&&e.target.links.push(e),e.onInsert(),Four.links.push(e),Four.kickLayout(),Four.afterInsertLink(e,t),e)},Link.prototype.remove=function(){return DEBUG&&console.log("link-remove: "+this),this.removed?!1:(this.removed=!0,Four.links.drop(this),this.onRemove(),this.source.links.drop(this),this.target.links.drop(this),Four.afterRemoveLink(this),!0)},Hint.prototype=new Link,Hint.prototype._super=Link,Hint.prototype.constructor=Hint,Hint.insert=function(e){return e=Link.create(e),DEBUG&&console.log("hint-remove: "+e),e.removed||e.source.removed||e.target.removed?null:(e.duration=2e3,e.onInsert(),Four.hints.push(e),Four.kickLayout(),e)},Hint.prototype.remove=function(){if(this.removed)return!1;DEBUG&&console.log("hint-remove: "+link),this.removed=!0,Four.hints.drop(this),this.onRemove(),Four.kickLayout()},Cut(function(e,t){function f(e,t){h().empty(),h().onClose=t;var n=Cut.column(0).pin("align",.5);for(var r=0;r<e.length;r++){var s=e[r];Cut.string("four:d_").setValue(s).appendTo(n)}h().append(n).appendTo(i)}function l(e,t){h().empty(),h().onClose=t;var n=Cut.column(0).pin("align",.5).spacing(15);for(var s=0;s<e.length;s++){var o=e[s];Cut.string("four:d_").setValue(o).appendTo(n)}var u=Cut.row().appendTo(n).spacing(10),a=Cut.string("four:d_").setValue("Yes").pin("align",.5),f=Cut.string("four:d_").setValue("No").pin("align",.5);Cut.image("four:button").box().padding(5).stretch().appendTo(u).append(a).on(r.CLICK,function(){return h().remove(),t&&t(!0),!0}),Cut.image("four:button").box().padding(5).stretch().appendTo(u).append(f).on(r.CLICK,function(){return h().remove(),t&&t(!1),!0}),h().append(n).appendTo(i)}function h(){return c||(c=Cut.image("four:window").box().padding(20).stretch().pin({textureAlpha:.8,align:.5}).spy(!0).on(r.CLICK,function(){this.remove(),this.onClose&&this.onClose()})),c}START&&START();var n=Cut.Math,r=Cut.Mouse;Cut.Mouse(e,t),e.viewbox(400,600);var i=e;i.bg=Cut.image("bg:full").appendTo(i).pin("align",.5),i.on("viewport",function(e,t){return this.bg.pin({scaleWidth:this.pin("width"),scaleHeight:this.pin("height"),scaleMode:"out"}),!0});var s=Cut.create().appendTo(i).spy(!0);s.gameover=Cut.string("four:d_").appendTo(s).pin({align:.5});var o=Cut.create().spy(!0).appendTo(s).pin({align:.5,handle:0}),u=Four;u.ui=s,s.markers=Cut.create().appendTo(o),s.links=Cut.create().appendTo(o),s.nodes=Cut.create().appendTo(o),o.tick(function(){u.animate()}),o.on(r.START,function(e,t){return u.mouseDown(t)}),o.on(r.MOVE,function(e,t){return u.mouseMove(t,this)}),o.on(r.END,function(e,t){return u.mouseUp(t)}),Cut.create().insertBefore(s).pin("align",.5).spy(!0).on(r.END,function(e,t){this.clickRadius=null,this.clickAngle=null}).on(r.MOVE,function(e,t){var r=t.x,i=t.y,s=Math.sqrt(r*r+i*i),u=Math.atan2(i,r);if(this.clickRadius!==null){var a=(s/this.clickRadius+1)/2;o.pin("scale",Math.max(.5,Math.min(2,o.pin("scaleX")*a)))}if(this.clickAngle!==null){var f=n.rotate(this.clickAngle-u,-Math.PI,Math.PI);f/=-2,o.pin("rotation",o.pin("rotation")+f)}this.clickRadius=s,this.clickAngle=u}),menu=Cut.column(0).spacing(2).appendTo(s).pin({alignX:0,alignY:1,offsetX:14,offsetY:-64}).hide(),active=Cut.image().appendTo(s).pin({alignX:0,alignY:1,offsetX:14,offsetY:-14}).on(r.CLICK,function(e,t){return DEBUG&&console.log("ui.active"),menu.visible(!menu.visible()),!0}),HELP&&Cut.image("four:help").appendTo(s).pin({alignX:1,alignY:1,offsetX:-14,offsetY:-14}).on(r.CLICK,function(e,t){return DEBUG&&console.log("ui.play-help"),HELP("./help.html"),!0});var a=[{id:Mode.learn,name:"Tutorial",width:136},{id:Mode.collect,name:"Colors Mode",width:176},{id:Mode.stream,name:"Score Mode",width:163},{id:Mode.speed,name:"60s Mode",width:127},{id:Mode.cross,name:"Cross Mode",width:160}];a.forEach(function(e){var t=Cut.row(1).spacing(3).spy(!0).appendTo(menu),n=function(){return DEBUG&&console.log("ui.menu: "+e.id),menu.hide(),Four.reset(e.id),!0};t.append(Cut.image("four:menu_"+e.id).on(r.CLICK,n)),Cut.image("four:menu").stretch().pin({width:e.width}).append(Cut.string("four:d_").setValue(e.name).pin({offsetX:8,offsetY:11})).appendTo(t).padding(5).on(r.CLICK,n)}),s.status1=Cut.string("four:d_"),s.status2=Cut.string("four:d_"),Cut.column(0).spacing(10).append(s.status1,s.status2).appendTo(s).pin({offsetX:15,offsetY:10+TOP}).on(r.CLICK,function(){return DEBUG&&console.log("ui.prompt-score"),Four.promptStatus(),!0}),s.progbars=Cut.create(),s.progbars.row(0).spacing(5),s.progbars.width=190,s.progbars.colors=[Color.wildcard,Color.bomb,Color.r,Color.g,Color.b,Color.y],s.progbars.bars={},s.progbars.colors.forEach(function(e){this.bars[e]=Cut.image("four:bar_"+e).stretch().appendTo(this).hide()},s.progbars),s.progbars.main=Cut.image("four:bar_0").stretch().appendTo(s.progbars).hide(),s.progbars.setValue=function(e){var t=(e.colors&&e.colors.length?e.remained+e.colors.length*2:e.required+2)/this.width;return this.colors.forEach(function(n){this.resizeBar(this.bars[n],e[n],t)},this),this.resizeBar(this.main,e.score||e.time,t),this},s.progbars.resizeBar=function(e,t,n){return t&&t.remained?e.show().pin("width",t.remained/n+2):e.hide(),this},s.prognums=Cut.create(),s.prognums.row(0).spacing(5),s.prognums.colors=[Color.wildcard,Color.bomb,Color.r,Color.g,Color.b,Color.y],s.prognums.nums={},s.prognums.colors.forEach(function(e){this.nums[e]=Cut.string("four:d"+e+"_").appendTo(this)},s.prognums),s.prognums.main=Cut.string("four:d_").appendTo(s.prognums),s.prognums.setValue=function(e){return this.colors.forEach(function(t){e[t]&&e[t].remained?this.nums[t].show().setValue(e[t].remained):this.nums[t].hide()},this),e.score?this.main.show().setValue(e.score.remained+">"):e.time?this.main.show().setValue(e.time.remained+"s"):this.main.hide(),this},Cut.column(1).spacing(10).append(s.progbars,s.prognums).appendTo(s).pin({alignX:1,alignY:0,offsetX:-10,offsetY:10+TOP}).on(r.CLICK,function(){return DEBUG&&console.log("ui.prompt-progress"),Four.promptProgress(),!0}),s.on("viewport",function(e,t){console.log("play resize");var e=this.parent().pin("width"),t=this.parent().pin("height");return this.pin({width:e,height:t}),!0}),s.open=function(){return Four.loadGame()||Four.reset(Mode.learn),this},s.updateMode=function(){var e=Status.mode;DEBUG&&console.log("ui.mode: "+e),active.setImage("four:mode_"+e)},s.updateInfo=function(){var e=Status.level+"^ "+Status.hits+"< "+Status.score+">";DEBUG&&console.log("ui.status1: "+e),this.status1.setValue(e);var t=Four.nodes.length+"/"+Temp.maxNodes+"!";DEBUG&&console.log("ui.status2: "+t),this.status2.setValue(t),Flag.loadover?this.status2.show():this.status2.hide(),this.progbars.setValue(Temp.progress),this.prognums.setValue(Temp.progress)},s.updateLoadover=function(e,t){DEBUG&&console.log("ui.load: "+e),t?this.gameover.setValue(e+"!").show():this.gameover.hide()},Four.resume=function(){o.touch()},Four.playCombo=function(e){},Four.redrawInfo=function(e){s.updateMode(),s.updateInfo();if(Flag.loadover){var t=Four.nodes.length+Four.queue.length,n=Temp.maxNodes;s.updateLoadover(n-t,t/n>.75)}else s.updateLoadover(0,!1)},Four.promptStatus=function(e,t){var n=[];Flag.timeover?n.push("Time: "+Temp.progress.required+"s"):n.push("Level: "+Status.level),n.push("Score: "+Status.score),n.push("Removed: "+Status.hits),n.push("Connected: "+Status.moves),n.push("Load: "+Four.nodes.length+(Flag.loadover?"/"+Temp.maxNodes:"")),Flag.loadover&&!e&&n.push(Temp.maxNodes-Four.nodes.length+" to game over!");var r="Status";e==Mode.loadover?r="Game Over!":e==Mode.timeover&&(r="Time Over!"),n.unshift(r),f(n,t)},Four.promptLevel=function(){f(["Level Up!","Level: "+Status.level])},Four.promptProgress=function(){var e=null;Flag.collect?e=["Progress","Colors to next level!"]:Flag.stream?e=["Progress","Score to next level!"]:Flag.speed?e=["Progress","Seconds to time over!"]:e=["Progress remaining!"],e&&f(e)},Four.confirm=function(e,t){l(e,t)},Four.clearPrompt=function(){h().remove()};var c;s.open()}),Dot.prototype.onInsert=function(){this.ui||(this.ui=(this.uix||Cut.image().pin("handle",.5)).appendTo(Four.ui.nodes)),this.onUpdate()},Dot.prototype.onRemove=function(){this.ui&&this.ui.remove(),this.ui=null},Dot.prototype.onUpdate=function(){if(!this.ui)return;var e=this.ui,t=this.muted?"drop":this.color+(this.selected?"_s":"");e.type!=t&&(e.type=t,e.setImage("four:node_"+t)),this.ui.pin({offsetX:this.x,offsetY:this.y})},Link.prototype.onInsert=function(){this.ui||(this.ui=(this.uix||new Line).appendTo(Four.ui.links)),this.onUpdate()},Link.prototype.onRemove=function(){this.ui&&this.ui.remove(),this.ui=null},Link.prototype.onUpdate=function(){if(this.ui){var e=this.duration||this.selected?"drag":"link"+(this.muted?"_drop":"");this.ui.type!=e&&(this.ui.type=e,this.ui.setImage("four:"+e),this.ui.duration=this.duration,this.ui.time=+(new Date)),this.ui.setPoints(this.source,this.target)}},Marker.prototype.onInsert=function(e){this.ui||(this.ui=Cut.image("four:drag"+e).pin("handle",.5).appendTo(Four.ui.markers).hide())},Marker.prototype.onRemove=function(){this.ui&&this.ui.remove()},Marker.prototype.onUpdate=function(e){this.ui&&(e?this.ui.show().pin({offsetX:e.x,offsetY:e.y}):this.ui.hide())},DragLine.prototype.onInsert=function(){this.ui||(this.ui=(new Line).setImage("four:drag").appendTo(Four.ui.markers).hide())},DragLine.prototype.onUpdate=function(e,t){this.ui&&(e&&t?this.ui.setPoints(e,t).show():this.ui.hide())},DragLine.prototype.onRemove=function(){this.ui&&this.ui.remove()},BaseMode.randomBW=(new Randomize).prob(.2).nope(function(){}).add(function(e){e.one(Color.wildcard)}).add(function(e){e.one(Color.bomb)}),BaseMode.randomGraph=(new Randomize).prob(.08).nope(function(){}).add(function(e){e.complete(Color.random(3,3))},function(e){return e<2?0:1}).add(function(e){e.tree(2,Color.random(3,3))},function(e){return e<2?0:1}).add(function(e){e.one({joker:!0})},function(e){return e<3?0:1}).add(function(e){e.tree(3,Color.random(3,3))},function(e){return e<3?0:1}).add(function(e){e.star(Color.random(4,_.random(1,4)))},function(e){return e<4?0:1}).add(function(e){e.complete(Color.random(4,_.random(1,4)))},function(e){return e<4?0:1}).add(function(e){e.star(Color.random(5,_.random(1,5)))},function(e){return e<5?0:1}).add(function(e){e.tree(2,Color.random(3,2))},function(e){return e<5?0:1}).add(function(e){e.tree(3,Color.random(3,2))},function(e){return e<6?0:1}),SpeedMode.randomGraph=(new Randomize).prob(.12).nope(function(){}).add(function(e){e.complete(Color.random(3,3))}).add(function(e){return e<2?0:1}).add(function(e){e.star(Color.random(3,_.random(1,3)))}).add(function(e){return e<3?0:1}).add(function(e){e.star(Color.random(4,_.random(1,4)))}).add(function(e){return e<4?0:1}).add(function(e){e.star(Color.random(5,_.random(1,5)))}).add(function(e){return e<2?0:1}),Level.stream={required:function(e){return--e==0?100:500*e*++e}},Level.collect={levels:6},Level.collect[Color.bomb]=[1,2,4,8,16,32],Level.collect[Color.wildcard]=[1,2,4,8,16,32],Level.collect[Color.r]=[8,16,32,64,128,256],Level.collect[Color.g]=[8,16,32,64,128,256],Level.collect[Color.b]=[8,16,32,64,128,256],Level.collect[Color.y]=[8,16,32,64,128,256],Level.learn=[{nodes:[{a:1/8,color:Color.r},{hintto:[2],a:3/8,color:Color.g},{hintto:[3],a:5/8,color:Color.b},{hintto:[0],a:7/8,color:Color.y}]},{nodes:[{linkto:[1],a:1/8,color:Color.r},{hintto:[2],a:3/8,color:Color.g},{linkto:[3],a:5/8,color:Color.b},{a:7/8,color:Color.y}]},{nodes:[{hintto:[1],a:.9,color:Color.r},{a:.3,color:Color.g},{linkto:[1],a:.5,color:Color.b},{linkto:[0],a:.7,color:Color.y},{linkto:[0],a:.1,color:Color.y}]},{nodes:[{hintto:[5],linkto:[1],a:7/12,color:Color.r},{linkto:[2],a:.75,color:Color.b},{a:11/12,color:Color.g},{linkto:[4],a:1/12,color:Color.g},{linkto:[5],a:.25,color:Color.b},{a:5/12,color:Color.y}]},{nodes:[{a:1/16,color:Color.r},{a:5/16,color:Color.r},{a:9/16,color:Color.r},{a:.8125,color:Color.r},{linkto:[0,1],a:3/16,color:Color.b},{linkto:[2,3],a:.6875,color:Color.b},{linkto:[4,5],a:7/16,color:Color.g},{hintto:[6],a:15,color:Color.y}]},{nodes:[{linkto:[1],a:.25,color:Color.r},{linkto:[2],a:3/8,color:Color.g},{linkto:[0],a:.5,color:Color.b},{hintto:[0],a:7/8,color:Color.y}]},{nodes:[{linkto:[1],a:1/8,color:Color.r},{linkto:[2],a:3/8,color:Color.b},{hintto:[3],a:5/8,color:Color.y},{a:7/8,color:Color.wildcard}]},{nodes:[{linkto:[1],a:1/8,color:Color.wildcard},{linkto:[2],a:3/8,color:Color.g},{hintto:[3],a:5/8,color:Color.b},{a:7/8,color:Color.wildcard}]},{nodes:[{linkto:[1],a:1/8,color:Color.r},{linkto:[2],a:3/8,color:Color.wildcard},{hintto:[3],a:5/8,color:Color.wildcard},{a:7/8,color:Color.wildcard}]},{nodes:[{color:Color.y},{hintto:[0],color:Color.bomb}]},{nodes:[{linkto:[3],color:Color.b},{linkto:[3],color:Color.r},{linkto:[3],color:Color.r},{color:Color.r},{hintto:[3],color:Color.bomb}]},{nodes:[{linkto:[1],a:1/12,color:Color.r},{linkto:[2],a:.25,color:Color.r},{linkto:[3],a:5/12,color:Color.b},{linkto:[4],a:7/12,color:Color.b},{a:.75,color:Color.r},{hintto:[2],a:11/12,color:Color.bomb}]}],Line.prototype=Object.create(Cut.Image.prototype),Line.prototype._super=Cut.Image,Line.prototype.constructor=Line,Line.prototype.setPoints=function(e,t){return this.x=e.x,this.y=e.y,this.dx=t.x-e.x,this.dy=t.y-e.y,this.length=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.pin("rotation",Math.atan2(this.dy,this.dx)),this.duration||this.draw(1),this},Line.prototype.draw=function(e){this.cropX(this.length*e+1),this.pin({offsetX:this.x+this.dx*e/2,offsetY:this.y+this.dy*e/2})},_.mixin({repeat:function(e,t){var n=[];for(var r=0;r<t;r++)n[r]=e;return n},mergedPrototypeProperty:function(e,t,n){n=n||"_super";var r={};do{var i=e.prototype[t];if(i)for(var s in i)r[s]=r[s]||i[s]}while(e=e.prototype[n]);return r}}),Array.prototype.sample=function(e){if(!_.isNumber(e)||!e)return this[Math.floor(Math.random()*this.length)];e=Math.min(e,this.length);var t=this.slice(0),n=[];for(var r=0;r<e;r++)n.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);return n},Array.prototype.drop=function(e){var t=this.indexOf(e);return t>-1&&this.splice(t,1),e},Array.prototype.next=function(e,t){t=t||1;var n=(this.indexOf(e)+t)%this.length;return this[n<0?n+this.length:n]},Array.prototype.at=function(e){return e=this.length>1?e%this.length:0,e=e<0?e+this.length:e,this[e]},Function.prototype.delay=function(e){return _(this).delay(e)},Function.prototype.debounce=function(e){return _(this).debounce(e)},Function.prototype.throttle=function(e){return _(this).throttle(e)},Function.prototype.debounced=function(){var e={},t=function(t,n){n=n||"global",e[n]&&clearTimeout(e[n]),e[n]=setTimeout(this,t)};return t}(),define("app",function(){}),requirejs.config({baseUrl:"../src",paths:{"cut-core":"bower_components/cutjs/cut-core","cut-mouse":"bower_components/cutjs/cut-mouse","cut-loader":"bower_components/cutjs/cut-loader",pool:"bower_components/extrajs/pool",randomize:"bower_components/extrajs/randomize",underscore:"bower_components/underscore/underscore",domReady:"../req/bower_components/requirejs-domready/domReady"},shim:{app:{deps:["def","cut-core","cut-mouse","cut-loader","textures","polyfills","force","underscore"]},cut:{exports:"Cut"},"cut-mouse":{deps:["cut-core"]},"cut-loader":{deps:["cut-core"]},textures:{deps:["cut-core"]},underscore:{exports:"_"}}}),require(["domReady","underscore","def","cut-core","cut-mouse","cut-loader","pool","randomize","textures","polyfills","force","app"],function(e){}),define("../req/req.dev",function(){});