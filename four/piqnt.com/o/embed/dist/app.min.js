/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*
 * CutJS
 * Copyright (c) 2013-2014 Ali Shakiba, Piqnt LLC and other contributors
 * Available under the MIT license
 * @license
 */

function checkDomain(e){var t=document.location.hostname;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])!=-1)return!0}function Cut(){if(arguments[0]===Cut.Proto)return;Cut._stats.create++,this._id="",this._visible=!0,this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._pin=(new Cut.Pin).tick(this),this._outs=[],this._tickBefore=[],this._tickAfter=[],this._spy=!1,this._alpha=1}function Game(){this.data=Conf.loadData();var e=this.data.upgrades||(this.data.upgrades={});for(var t=0;t<Conf.ups.length;t++){var n=Conf.ups[t];e[n]=e[n]||0}e.flags=Math.max(e.flags||0,2);var i=this.data.stats=this.data.stats||{};i.coins=i.coins||0,i.dist=i.dist||0;var s=this.data.flags=this.data.flags||[];this.upgrade=function(t){var n=this.price(t);DEBUG&&console.log("upgrade: "+t+" at "+n),n>0&&n<=i.coins&&(i.coins-=n,e[t]+=1,Conf.saveData(this.data)),this.uiUpgrade()},this.price=function(t){return Math.pow(10,(e[t]||0)+2)};var o=[],u=[],a={},f=0,l=0,c=0,h=0,p=0;this.player=null,this.coins=0,this.speed=0,this.power=0,this.energy=0,this.dist=0,this.tick=function(){for(b=u.length-1;b>=0;b--)n=u[b],n.x+(n.radius||0)<this.dist+Conf.width&&(u.splice(b,1),n.uiEnter(),o.push(n));if(this.speed<=0)return;var e,t,n,i,s,d,v,m,g,y,b,w;e=l||+(new Date),l=+(new Date),e=Math.min(l-e,100),t=e*this.speed,f+=e,this.dist+=t,this.power-=t,this.speed=Conf.speed+this.dist*Conf.acceleration*this.player.slow,this.energy-=t*this.player.energy,this.uiEnergy(this.energy),i=this.player.x,s=this.player.y;for(b=o.length-1;b>=0&&this.speed>0;b--){n=o[b];if(n.x-(n.radius||0)<this.dist){n.remove(),o.splice(b,1);continue}m=n.x-i,g=n.y-s,y=M.length(m,g),this.player.pull&&n.pull&&(w=this.player.pull*n.pull,w=w*5e3/y/y/y,r=Math.min(1,w*e/1e3),n.x-=m*r,n.y-=g*r),this.player.push&&n.push&&(w=this.player.push*n.push,w=w*.3/(1+Math.pow(1.1,y-10*(w+1))),r=Math.min(1,w*e/1e3),n.x+=m*r,n.y+=g*r),m=n.x-i,g=n.y-s,y=M.length(m,g);if(y<n.radius+this.player.radius&&n.collide&&n.collide()){n.remove(),o.splice(b,1);continue}if(this.speed<=0)return;n.setPower&&n.setPower(this.power,this.player.power),n.vx&&(n.x+=e*n.vx),n.vy&&(n.y+=e*n.vy),n.uiXY()}this.energy>0?(a&&a.fresh&&(m=a.x-i,g=a.y-s,y=M.length(m,g),y<.1&&(a.fresh=!1),y=Math.max(1,y/this.player.speed/e),i+=m/y,s+=g/y,a.x+=t),i+=t,this.player.x=i,this.player.y=s,this.player.uiXY(),this.setDist(this.dist)):i<this.dist-Conf.width/2&&this.end(!1);while(h+Conf.dotSpace<=this.dist)h+=Conf.dotSpace,--p<0&&(p=Conf.randomPattern.random(this))&&(p=p(this,h+Conf.width)+M.random(this.dist)/7500);while(c+Conf.objSpace<=this.dist)c+=Conf.objSpace,n=Conf.randomCoin.random(this)||Conf.randomEnemy.random(this),n&&(d=c+Conf.width,v=M.random(Conf.min,Conf.max),n(this,d,v));this.uiMove(this.dist,f,t,e)},this.startFrom=function(t){return t<0?(this.startDist=0,this.startFlag=-1,!0):t<=e.flags&&s[t]?(this.startDist=s[t],this.startFlag=t,!0):!1},this.start=function(){DEBUG&&console.log("game start"),this.clear(),this.coins=0,this.speed=Conf.speed,this.power=0,this.energy=1,this.dist=this.startDist||0,a={},f=0,l=0,c=this.dist,h=this.dist,p=0,Conf.randomPattern.reset(),Conf.randomPower.reset(),Conf.randomCoin.reset(),Conf.randomEnemy.reset(),this.uiCoins(this.coins),this.uiEnergy(this.energy),this.uiStart(),this.player=this.player||new Player(this),this.player.x=Conf.width/5+this.dist,this.player.y=0,this.player.uiXY(),this.player.upgrade(e),this.player.uiLive()},this.end=function(t){DEBUG&&console.log("game end");if(this.speed<=0)return;this.speed=0;var n=this.startFlag+1;if(n<e.flags){while(n<s.length&&s[n]<=this.dist)s.splice(n,1);n>=s.length&&s.length<=e.flags&&s.splice(n,0,this.dist|0)}this.dist>i.dist&&(i.dist=this.dist|0),i.coins+=this.coins,Conf.saveData(this.data),this.player.uiDie(t,this.uiEnd.bind(this.ui))},this.clear=function(){DEBUG&&console.log("game clear");for(var e=0;e<o.length;e++)o[e].remove();o.length=0;for(var e=0;e<u.length;e++)u[e].remove();u.length=0},this.pointer=function(e,t){return a.x=e,a.y=t,a.fresh=!0,this.speed>0},this.insert=function(e,t){u.push(e),t&&(e=Conf.randomPower.random(this))&&e(this,t.x,t.y)},this.dots=(new Pool(function(){return new Dot(this)}.bind(this),function(e){e.onCheckOut()},function(e){e.onCheckIn()},function(e){e.uiRemove()})).max(127)}function Player(e){this.radius=Conf.radius.Player,this.game=e,this.name="player",e.uiNewPlayer(this)}function Dot(e){this.radius=Conf.radius.Dot,this.pull=Conf.pull.Dot,this.game=e,e.uiNewDot(this)}function Power(e){this.radius=Conf.radius.Power,this.pull=Conf.pull.Power,this.game=e,e.uiNewPower(this)}function Enemy(e,t){this.radius=Conf.radius.Enemy,this.push=Conf.push.Enemy,this.game=e,this.name=t,e.uiNewEnemy(this)}function Coin(e,t){this.radius=Conf.radius.Coin,this.game=e,this.value=t,e.uiNewCoin(this)}function App(e){App.prototype._super.apply(this,arguments),this.spy(!0),this.elem=e,this.game=new Game,this.sound={},this.sound.play=function(e){},this.home=(new Home(this)).appendTo(this).hide().spy(!0).pin({align:.5}),this.play=(new Play(this)).appendTo(this).hide().spy(!0).pin({align:.5}),this.open("home"),this.listen("resize",function(e,t){return this.pin({width:App.width,height:App.height,resizeMode:"in",resizeWidth:e,resizeHeight:t-TOP,offsetY:TOP}),!0})}function Home(e){function f(n){return function(){return n==t.data.upgrades.flags?t.upgrade("flags"):t.startFrom(n)&&e.open("play"),!0}}function h(){for(var e=0;e<o.length;e++){var n=o[e].empty();n.pin("alpha",1).pinChildren({alpha:1});if(e<=t.data.upgrades.flags){var r=Conf.k(t.data.flags[e-1]);r=e>0?r||"-":0,Cut.string("base:d_").appendTo(n).pin({alignY:.5,alignX:.45,handle:.5,scale:.8}).setValue(r);continue}var s=t.price("flags");n.pin("alpha",.9).pinChildren({alpha:s<=t.data.stats.coins?1:.5}),e==t.data.upgrades.flags+1&&Cut.string("base:d_").setValue(Conf.$(s)).pin({alignY:.5,alignX:.4,handle:.5,alpha:.8,scale:.6}).appendTo(n)}i.empty(),Cut.string("base:d_").appendTo(i).pin({alignX:.5,alignY:1,offsetX:-2,offsetY:-6,alpha:.6,scale:.8}).setValue("0-"+Conf.k(t.data.stats.dist)),Cut.string("base:d_").appendTo(i).pin({alignX:.5,alignY:0,offsetX:-4,offsetY:10.5,alpha:.5,scale:.7}).setValue(Conf.$(t.data.stats.coins));for(var e=0;e<Conf.ups.length;e++){var u=Conf.ups[e],n=l[u].empty(),s=t.price(u),a=t.data.upgrades[u]||0;n.pin("alpha",.9).pinChildren({alpha:s<=t.data.stats.coins?1:.5}),Cut.image("base:up_"+u).pin("align",.5).appendTo(n),Cut.string("base:d_").setValue(Conf.$(s)).pin({align:1,offsetX:-1.6,offsetY:-1.4,alpha:.8,scale:.6}).appendTo(n),a<=6&&Cut.image("base:up_"+a).pin({alignX:0,alignY:0,offsetX:1.6,offsetY:1.4,alpha:.8,scale:.6}).appendTo(n)}}Home.prototype._super.apply(this,arguments);var t=e.game;this.listen("resize",function(e,t){this.pin({width:this.parent().pin("width"),height:this.parent().pin("height")}),n.pin({scaleMode:"out",scaleWidth:this.pin("width"),scaleHeight:this.pin("height")})}),this.listen("open",t.uiUpgrade=function(){h()}),this.listen("close",function(){this.hide()});var n=Cut.image("base:homebg").appendTo(this).pin("align",.5),r=Cut.column(0).appendTo(this).pin("align",.5).spacing(4),i=Cut.image("base:tombstone").appendTo(r),s=Cut.row().appendTo(r).spacing(4),o=[];for(var u=0;u<6;u++){var a=Cut.image("base:play").appendTo(s).listen(Cut.Mouse.CLICK,f(u-1));o.push(a)}var s=Cut.row().appendTo(r).spacing(4),l={};for(var u=0;u<Conf.ups.length;u++){var c=Conf.ups[u];l[c]=Cut.image("base:option").appendTo(s).attr("name",c).listen(Cut.Mouse.CLICK,function(){t.upgrade(this.attr("name"))})}}function Play(e){function h(e,t){l.first().gotoLabel("coin_"+e+"_").pin("scale",t||1),l.last().setValue(Conf.$(e)).visible(e>100),l.show(),clearTimeout(c),c=setTimeout(function(){l.hide()},1e3)}function y(e){var t=[];for(var n=0;n<e;n++)t[n]=n;for(var n=0;n<e;n++){var r=Math.floor(Math.random()*(e-n))+n,i=t[n];t[n]=t[r],t[r]=i}return t}Play.prototype._super.apply(this,arguments);var t=e.game;this.listen("resize",function(e,t){this.pin({width:this.parent().pin("width"),height:this.parent().pin("height")}),n.pin({scaleMode:"out",scaleWidth:this.pin("width"),scaleHeight:this.pin("height")});var r=TOP/this.pin("scaleX")/this.parent().pin("scaleX");s.pin({width:this.pin("width"),height:r,offsetY:-r})}),this.listen("open",function(){e.elem.style&&(e.elem.style.cursor="none"),t.start()}),this.listen("close",function(){e.elem.style&&(e.elem.style.cursor=""),t.end(),this.hide()}),this.tick(function(){t.tick()},!0);var n=Cut.image("base:playbg").appendTo(this).pin("align",.5),r=Cut.anim("base:c_").appendTo(n).pin({alpha:.6,align:.5,scale:3}),i=Cut.image("base:border").stretch().appendTo(this).pin({width:Conf.width,height:Conf.height,align:.5,alpha:.5}),s=Cut.image("base:shadow").stretch().appendTo(this),o=Cut.create().appendTo(this).spy(!0).pin({width:Conf.width,height:Conf.height,alignX:.5,alignY:.5,handleY:0}),u=Cut.image("base:energy").stretch().appendTo(this).pin({alignX:0,alignY:0,offsetX:3,offsetY:2}),a=Cut.string("base:d_").appendTo(this).pin({alignX:0,alignY:0,offsetX:3,offsetY:9}),f=Cut.string("base:d_").appendTo(this).pin({alignX:1,alignY:0,offsetX:-3,offsetY:3}),l=Cut.column(.5).appendTo(this).pin({alignX:.5,alignY:0,offsetX:10,offsetY:2}).append(Cut.anim("base:coin_"),Cut.string("base:d_").pin("scale",.8)).hide(),c=null,p=Cut.image("base:cursor").pin("handle",.5).appendTo(o).hide(),d=Cut.create().appendTo(o),v=Cut.create().appendTo(o),m=Cut.create().appendTo(o);o.listen([Cut.Mouse.MOVE,Cut.Mouse.START],function(e,n){p.xy(n.x,n.y).visible(t.pointer(n.x,n.y))});var g={list:y(r._frames.length),i:0,next:function(){return this.list[this.i++%this.list.length]}};t.uiStart=function(){DEBUG&&console.log("app start"),r.gotoFrame(g.next())},t.uiMove=function(e,t,n,r){p.x(p.x()+n),o.x(-e)},t.uiEnd=function(){DEBUG&&console.log("app end"),setTimeout(function(){e.open("home")},1e3)},t.setDist=function(e){a.setValue(Conf.k(e))},t.uiEnergy=function(e){u.pin("width",Math.max(0,e)*40)},t.uiCoins=function(e){f.setValue(Conf.$(e))},t.uiNewPlayer=function(t){DEBUG&&console.log("player create"),t.ui=Cut.anim("base:"+t.name+"_").pin("handle",.5).appendTo(m),t.uiXY=function(){this.ui.xy(this.x,this.y)},t.uiLive=function(t,n,r){DEBUG&&console.log("player live"),this.freeze=!!r,!this.freeze&&e.sound.play("start"),this.ui.setFrames("base:"+this.name+"_").show(),!this.freeze&&this.ui.play(),n&&n()},t.uiDie=function(t,n){DEBUG&&console.log("player die"),t?(!this.freeze&&e.sound.play("die"),p.hide(),this.ui.setFrames("base:die").play().repeat(1,n)):n&&n()}},t.uiNewDot=function(t){t.ui=Cut.image("base:dot").pin("handle",.5).appendTo(d).hide(),t.uiEnter=function(){this.ui.show()},t.uiXY=function(){this.ui.xy(this.x,this.y)},t.onCheckOut=function(){},t.onCheckIn=function(){this.ui.hide()},t.uiRemove=function(){this.ui.remove(),this.ui=null},t.uiEat=function(t){e.sound.play("dot")}},t.uiNewPower=function(t){t.ui=Cut.image("base:power").pin("handle",.5).appendTo(v).hide(),t.uiEnter=function(){this.ui.show()},t.uiXY=function(){this.ui.xy(this.x,this.y)},t.uiEat=function(){e.sound.play("power")},t.uiRemove=function(){this.ui.remove(),this.ui=null}},t.uiNewEnemy=function(t){t.ui=Cut.anim("base:"+t.name).pin("handle",.5).appendTo(v).hide(),t.uiEnter=function(){this.ui.show()},t.uiMode=function(e){e==0?this.ui.setFrames("base:"+this.name+"_").play():e==-1?this.ui.setFrames("base:un"+this.name).gotoFrame(0).pin({alpha:.8,rotation:0}):e==1?this.ui.setFrames("base:"+this.name+"z_").play():this.ui.setFrames("base:"+this.name+"").play()},t.uiXY=function(){this.ui.xy(this.x,this.y),(this.vx||this.vy)&&this.ui.pin("rotation",Math.atan2(this.vx,this.vy)-Math.PI/2)},t.uiRemove=function(){this.ui.remove(),this.ui=null},t.uiEat=function(){e.sound.play("enemy")}},t.uiNewCoin=function(t){t.scale=Conf.coinsScale["c"+t.value]||1,t.ui=Cut.anim("base:coin_"+t.value+"_").pin("handle",.5).appendTo(v).pin("scale",t.scale).hide(),t.uiEnter=function(){this.ui.show()},t.uiXY=function(){this.ui.xy(this.x,this.y)},t.uiRemove=function(){this.ui.remove(),this.ui=null},t.uiEat=function(){h(this.value,this.scale),e.sound.play("coin")}}}var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c});const DEBUG=!1;!checkDomain(["piqnt.com"]),define("def",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,Cut.Proto={},Cut._stats={create:0,tick:0,paint:0,paste:0},Cut.create=function(){return new Cut},Cut.prototype.render=function(e){Cut._stats.tick=Cut._stats.paint=Cut._stats.paste=0;var t=+(new Date);this._tick(),this._paint(e),Cut._stats.fps=1e3/(+(new Date)-t)},Cut.prototype._tick=function(){if(!this._visible)return;this._pin.tick(this);var e=this._tickBefore.length;for(var t=0;t<e;t++)Cut._stats.tick++,this._tickBefore[t].call(this);var n,r=this._first;while(n=r)r=n._next,n._tick();var e=this._tickAfter.length;for(var t=0;t<e;t++)Cut._stats.tick++,this._tickAfter[t].call(this)},Cut.prototype.tick=function(e,t){t?this._tickBefore.push(e):this._tickAfter.push(e)},Cut.prototype._paint=function(e){if(!this._visible)return;Cut._stats.paint++;var t=this.matrix();e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;e.globalAlpha!=n&&(e.globalAlpha=n);var r=this._outs.length;for(var i=0;i<r;i++)this._outs[i].paste(e);e.globalAlpha!=this._alpha&&(e.globalAlpha=this._alpha);var s,o=this._first;while(s=o)o=s._next,s._paint(e)},Cut.prototype.toString=function(){return"["+this._id+"]"},Cut.prototype.id=function(e){return arguments.length?(this._id=e,this):this._id},Cut.prototype.attr=function(e,t){return arguments.length<2?this._attrs?this._attrs[e]:undefined:((this._attrs?this._attrs:this._attrs={})[e]=t,this)},Cut.prototype.listen=function(e,t){if(typeof t!="function")return this;e=(Cut._isArray(e)?e.join(" "):e).split(/\s+/);for(var n=0;n<e.length;n++){var r=e[n];r&&(this._listeners=this._listeners||{},this._listeners[r]=this._listeners[r]||[],this._listeners[r].push(t))}return this},Cut.prototype.listeners=function(e){return this._listeners&&this._listeners[e]},Cut.prototype.publish=function(e,t){var n=this.listeners(e);if(!n||!n.length)return!1;for(var r=0;r<n.length;r++)n[r].apply(this,t);return!0},Cut.prototype.visit=function(e){var t=e.reverse,n=e.visible;if(e.start&&e.start(this))return;var r,i=t?this.last(n):this.first(n);while(r=i){i=t?r.prev(n):r.next(n);if(r.visit(e,t))return!0}return e.end&&e.end(this)},Cut.prototype.visible=function(e){return arguments.length?(this._visible=e,this._parent&&(this._parent._children_ts=Cut._TS++),this._pin_ts=Cut._TS++,this.touch(),this):this._visible},Cut.prototype.hide=function(){return this.visible(!1)},Cut.prototype.show=function(){return this.visible(!0)},Cut.prototype.parent=function(){return this._parent},Cut.prototype.next=function(e){var t=this._next;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.prev=function(e){var t=this._prev;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.first=function(e){var t=this._first;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.last=function(e){var t=this._last;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.append=function(){for(var e=0;e<arguments.length;e++)arguments[e].appendTo(this);return this},Cut.prototype.prepend=function(){for(var e=0;e<arguments.length;e++)arguments[e].prependTo(this);return this},Cut.prototype.appendTo=function(e){if(!e)throw"Parent is null!";return this.remove(),e._last&&(e._last._next=this,this._prev=e._last),this._parent=e,e._last=this,e._first||(e._first=this),this._parent_ts=Cut._TS++,e._children_ts=Cut._TS++,e.touch(),this},Cut.prototype.prependTo=function(e){if(!e)throw"Parent is null!";return this.remove(),e._first&&(e._first._prev=this,this._next=e._first),this._parent=e,e._first=this,e._last||(e._last=this),this._parent_ts=Cut._TS++,e._children_ts=Cut._TS++,e.touch(),this},Cut.prototype.insertNext=function(){if(arguments.length)for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].insertAfter(this);return this},Cut.prototype.insertPrev=function(){if(arguments.length)for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].insertBefore(this);return this},Cut.prototype.insertBefore=function(e){if(!e)throw"Next is null!";this.remove();var t=e._parent,n=e._prev;e._prev=this,n&&(n._next=this)||t&&(t._first=this),this._parent=t,this._prev=n,this._next=e,this._parent_ts=Cut._TS++,this.touch()},Cut.prototype.insertAfter=function(e){if(!e)throw"Prev is null!";this.remove();var t=e._parent,n=e._next;e._next=this,n&&(n._prev=this)||t&&(t._last=this),this._parent=t,this._prev=e,this._next=n,this._parent_ts=Cut._TS++,this.touch()},Cut.prototype.remove=function(){if(arguments.length){for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev)),this._parent&&(this._parent._children_ts=Cut._TS++,this._parent.touch()),this._prev=this._next=this._parent=null,this._parent_ts=Cut._TS++,this},Cut.prototype.empty=function(){var e,t=this._first;while(e=t)t=e._next,e._prev=e._next=e._parent=null;return this._first=this._last=null,this._children_ts=Cut._TS++,this.touch(),this},Cut.prototype.touch=function(){return this._touch_ts=Cut._TS++,this._parent&&this._parent.touch(),this},Cut.prototype.spy=function(e){return arguments.length?(this._spy=e?!0:!1,this):this._spy},Cut.prototype.pin=function(){if(!arguments.length)return this._pin;var e=this._pin.update.apply(this._pin,arguments);return e===this._pin?this:e},Cut.prototype.pinChildren=function(e){return e&&Cut._extend(this._pinAll=this._pinAll||{},e),this._pinAllTicker?this:(this._pinAllTicker=function(){if(this._pinAll_mo==this._children_ts)return;this._pinAll_mo=this._children_ts;var e,t=this.first(!0);while(e=t)t=e.next(!0),e.pin(this._pinAll)},this.tick(this._pinAllTicker,!0),this)},Cut.prototype.matrix=function(){return this._pin.absoluteMatrix(this,this._parent?this._parent._pin:null)},Cut.prototype.tween=function(e,t){return Cut.Tween(this).tween(e,t)},Cut.Tween=function(e){function s(){return i!==r[r.length-1]&&(t=Cut._now(),e.touch(),r.push(i)),i}if(e._tween)return e._tween;var t=0,n={},r=[],i=null;return n.queue=function(e){return this},n.tween=function(e,t){return i={end:{},duration:e||400,delay:t||0},this},n.pin=function(e){var t=s().end;return arguments.length===1?Cut._extend(t,arguments[0]):arguments.length===2&&(t[arguments[0]]=arguments[1]),this},n.then=function(e){return s().then=e,this},n.easing=function(e){return s().easing=e,this},n.clear=function(t){var n;while(n=r.shift())t&&e.pin(n.end);return this},e.tick(function(){if(!r.length)return;this.touch();var n=Cut._now(),i=n-t;if(!i)return;var s=r[0];if(s.delay>0){s.delay-=i,t=n;return}var o=i/s.duration,u=o>=1;o=o>1?1:o,o=s.easing?s.easing(o):o;if(!s.start){s.start={};for(var a in s.end){var f=e.pin(a);s.start[a]=f||0}}for(var a in s.start){var l=s.start[a],c=s.end[a];e.pin(a,l+(c-l)*o)}u&&(r.shift(),t=n,s.then&&s.then.call(e))},!0),e._tween=n},Cut.root=function(e,t){return new Cut.Root(e,t)},Cut.Root=function(e,t){function i(){if(n===!0)return;var s=r._touch_ts;e(r),t(i),s==r._touch_ts&&r.pause()}Cut.String.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;var n=!0,r=this;this.start=function(){return this.resume()},this.pause=function(){return n=!0,this},this.resume=function(e){if(n||e)n=!1,t(i);return this},this.touch=function(){return this.resume(),Cut.prototype.touch.apply(this,arguments)};var s=null;this.viewbox=function(e,t,n){return s={width:e,height:t,mode:typeof n=="undefined"?"in":n},this},this.listen("resize",function(e,t){return s?this.pin({width:s.width,height:s.height,resizeMode:s.mode,resizeWidth:e,resizeHeight:t}):this.pin({width:e,height:t}),!0})},Cut.Root.prototype=new Cut(Cut.Proto),Cut.Root.prototype._super=Cut,Cut.Root.prototype.constructor=Cut.Root,Cut.image=function(e){var t=new Cut.Image;return e&&t.setImage(e),t},Cut.Image=function(){Cut.Image.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return},Cut.Image.prototype=new Cut(Cut.Proto),Cut.Image.prototype._super=Cut,Cut.Image.prototype.constructor=Cut.Image,Cut.Image.prototype.setImage=function(e){return this._outs[0]=Cut.Out.select(e),this.pin({width:this._outs[0]?this._outs[0].width():0,height:this._outs[0]?this._outs[0].height():0}),this},Cut.Image.prototype.cropX=function(e,t){return this.setImage(this._outs[0].cropX(e,t))},Cut.Image.prototype.cropY=function(e,t){return this.setImage(this._outs[0].cropY(e,t))},Cut.anim=function(e,t){var n=(new Cut.Anim).setFrames(e).gotoFrame(0);return t&&n.fps(t),n},Cut.Anim=function(){Cut.Anim.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;this._fps=Cut.Anim.FPS,this._ft=1e3/this._fps,this._time=0,this._frame=0,this._frames=[],this._labels={},this.tick(function(){if(this._time&&this._frames.length>1){var e=+(new Date)-this._time;if(e>=this._ft){var t=e<2*this._ft?1:Math.floor(e/this._ft);this._time+=t*this._ft,this.moveFrame(t),this._repeat&&(this._repeat-=t)<=0&&(this.stop(),this._callback&&this._callback())}this.touch()}},!1)},Cut.Anim.prototype=new Cut(Cut.Proto),Cut.Anim.prototype._super=Cut,Cut.Anim.prototype.constructor=Cut.Anim,Cut.Anim.FPS=22,Cut.Anim.prototype.fps=function(e){return arguments.length?(this._fps=e||Cut.Anim.FPS,this._ft=1e3/this._fps,this):this._fps},Cut.Anim.prototype.setFrames=function(e){this._time=this._time||0,this._frame=0,this._frames=[],this._labels={};var t=Cut.Out.select(e,!0);if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n];this._frames.push(r),this._labels[t[n].name]=n}return this},Cut.Anim.prototype.gotoFrame=function(e,t){return e=Cut.Math.rotate(e,this._frames.length),this._frame=e,t=t||!this._outs[0],this._outs[0]=this._frames[this._frame],t&&this.pin({width:this._outs[0].width(),height:this._outs[0].height()}),this._frame_ts=Cut._TS++,this.touch(),this},Cut.Anim.prototype.randomFrame=function(){return this.gotoFrame(Math.floor(Math.random()*this._frames.length))},Cut.Anim.prototype.moveFrame=function(e){return this.gotoFrame(this._frame+e)},Cut.Anim.prototype.gotoLabel=function(e,t){return this.gotoFrame(this._labels[e]||0,t)},Cut.Anim.prototype.repeat=function(e,t){return this._repeat=e*this._frames.length-1,this._callback=t,this},Cut.Anim.prototype.play=function(e){if(!this._time||e)this._time=+(new Date),this.gotoFrame(0);return this},Cut.Anim.prototype.stop=function(e){return this._time=null,Cut._isNum(e)&&this.gotoFrame(e),this},Cut.string=function(e){return(new Cut.String).setFont(e)},Cut.String=function(){Cut.String.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;this.row()},Cut.String.prototype=new Cut(Cut.Proto),Cut.String.prototype._super=Cut,Cut.String.prototype.constructor=Cut.String,Cut.String.prototype.setFont=function(e){return this._font=e,e=e.split(":",2),this.prefix=e.length>1?e[1]:e[0],this},Cut.String.prototype.setValue=function(e){if(this.value===e)return this;this.value=e,e.length||(e+="");var t=this._first;for(var n=0;n<e.length;n++)t=t||Cut.anim(this._font).appendTo(this),t.gotoLabel(this.prefix+e[n],!0).show(),t=t._next;while(t)t.hide(),t=t._next;return this},Cut.row=function(e){return Cut.create().row(e)},Cut.prototype.row=function(e){return this.box("row").pinChildren({alignY:e}),this},Cut.column=function(e){return Cut.create().column(e)},Cut.prototype.column=function(e){return this.box("column").pinChildren({alignX:e}),this},Cut.box=function(e){return(new Cut.create).box()},Cut.prototype.box=function(e){return this._boxTicker?this:(this._padding=0,this.padding=function(e){return this._padding=e,this},this._spacing=0,this.spacing=function(e){return this._spacing=e,this},this._boxTicker=function(){if(this._box_mo==this._touch_ts)return;this._box_mo=this._touch_ts;var t=0,n=0,r,i=this.first(!0),s=!0;while(r=i)i=r.next(!0),r.pin().relativeMatrix(),e=="column"?(!s&&(n+=this._spacing||0),r.pin("offsetY")!=n&&r.pin("offsetY",n),t=Math.max(t,r._pin._boundWidth),n+=r._pin._boundHeight):e=="row"?(!s&&(t+=this._spacing||0),r.pin("offsetX")!=t&&r.pin("offsetX",t),t+=r._pin._boundWidth,n=Math.max(n,r._pin._boundHeight)):(t=Math.max(t,r._pin._boundWidth),n=Math.max(n,r._pin._boundHeight)),s=!1;t+=this._padding*2,n+=this._padding*2,this.pin("width")!=t&&this.pin("width",t),this.pin("height")!=n&&this.pin("height",n)},this.tick(this._boxTicker),this)},Cut.Image.prototype.tile=function(e){function r(e){return n._outs[e]||(n._outs[e]=t.clone())}if(this._tileTicker)return this;var t=null,n=this;return this._tileTicker=function(){if(this._tile_mo==this._touch_ts)return;this._tile_mo=this._touch_ts,t=t||this._outs[0].clone();var n=t.left,i=t.right,s=t.top,o=t.bottom,u=t.width()-n-i,a=t.height()-s-o,f=this.pin("width");f=e?f:f-n-i;var l=this.pin("height");l=e?l:l-s-o;var c=e?-n:0,h=e?-s:0,p=0;s&&n&&r(p++).cropX(n,0).cropY(s,0).offset(c,h),o&&n&&r(p++).cropX(n,0).cropY(o,a+s).offset(c,h+l+s),s&&i&&r(p++).cropX(i,u+n).cropY(s,0).offset(c+f+n,h),o&&i&&r(p++).cropX(i,u+n).cropY(o,a+s).offset(c+f+n,h+l+s);var d=c+n,v=f;while(v>0){var m=Math.min(u,v);v-=u;var g=h+s,y=l;while(y>0){var b=Math.min(a,y);y-=a,r(p++).cropX(m,n).cropY(b,s).offset(d,g),v<0&&(n&&r(p++).cropX(n,0).cropY(b,s).offset(c,g),i&&r(p++).cropX(i,u+n).cropY(b,s).offset(d+m,g)),g+=b}s&&r(p++).cropX(m,n).cropY(s,0).offset(d,h),o&&r(p++).cropX(m,n).cropY(o,a+s).offset(d,g),d+=m}this._outs.length=p},this.tick(this._tileTicker),this},Cut.Image.prototype.stretch=function(e){function r(e){return n._outs[e]||(n._outs[e]=t.clone())}if(this._stretchTicker)return this;var t=null,n=this;return this._stretchTicker=function(){if(this._stretch_mo==this._pin._transform_ts)return;this._stretch_mo=this._pin._transform_ts,t=t||this._outs[0].clone();var n=t.left,i=t.right,s=t.top,o=t.bottom,u=t.width(),a=t.height(),f=this.pin("width"),l=this.pin("height");f=e?f+n+i:Math.max(f,n+i),l=e?l+s+o:Math.max(l,s+o);var c=0;s&&n&&r(c++).cropX(n,0).cropY(s,0).offset(0,0),o&&n&&r(c++).cropX(n,0).cropY(o,a-o).offset(0,l-o),s&&i&&r(c++).cropX(i,u-i).cropY(s,0).offset(f-i,0),o&&i&&r(c++).cropX(i,u-i).cropY(o,a-o).offset(f-i,l-o),s&&r(c++).cropX(u-n-i,n).cropY(s,0).offset(n,0).width(f-n-i),o&&r(c++).cropX(u-n-i,n).cropY(o,a-o).offset(n,l-o).width(f-n-i),n&&r(c++).cropX(n,0).cropY(a-s-o,s).offset(0,s).height(l-s-o),i&&r(c++).cropX(i,u-i).cropY(a-s-o,s).offset(f-i,s).height(l-s-o),r(c++).cropX(u-n-i,n).cropY(a-s-o,s).offset(n,s).width(f-n-i).height(l-s-o),this._outs.length=c},this.tick(this._stretchTicker),this},Cut._images={},Cut.loadImages=function(e,t){function a(){DEBUG&&console.log("Loading image completed."),l()}function f(e){DEBUG&&console.log("Error loading image: "+e),l()}function l(){--n<=0&&t&&t()}var n=0,r=!0,i=Cut._textures;for(var s in i){if(i[s].imagePath){n++;var o=i[s].imagePath,u=e(o,a,f);Cut.addImage(u,o)}r=!1}r&&(DEBUG&&console.log("No image to load."),t&&t())},Cut.getImage=function(e){return Cut._images[e]},Cut.addImage=function(e,t){return Cut._images[t]=e,this},Cut._textures={},Cut.addTexture=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];Cut._textures[t.name]=t,Cut.Out._cache[t.name]={},t.getImage=function(e){return function(){return e._image||(e._image=Cut.getImage(e.imagePath)),e._image}}(t);var n,r=t.cutouts||t.sprites;if(typeof t.filter=="function")for(var i=r.length-1;i>=0;i--)(n=t.filter(r[i]))?r[i]=n:r.splice(i,1);var s=t.ratio||1,o=t.trim||0;for(var i=r.length-1;i>=0;i--)n=r[i],n.x*=s,n.y*=s,n.w*=s,n.h*=s,n.width*=s,n.height*=s,n.top*=s,n.bottom*=s,n.left*=s,n.right*=s,o&&(n.x+=o,n.y+=o,n.w-=2*o,n.h-=2*o,n.width-=2*o,n.height-=2*o,n.top-=o,n.bottom-=o,n.left-=o,n.right-=o)}return this},Cut.Out=function(e,t,n){this.cutout=e,this.name=e.name,this.image=t,this.ratio=n||1,e.w=e.w||e.width,e.h=e.h||e.height,this.sx=e.x*this.ratio,this.sy=e.y*this.ratio,this.sw=e.w*this.ratio,this.sh=e.h*this.ratio,this.dx=0,this.dy=0,this.dw=e.w,this.dh=e.h,this.top=e.top||0,this.bottom=e.bottom||0,this.left=e.left||0,this.right=e.right||0},Cut.Out.prototype.clone=function(){return new Cut.Out(this.cutout,this.image,this.ratio)},Cut.Out.prototype.width=function(e){return arguments.length?(this.dw=e,this):this.dw},Cut.Out.prototype.height=function(e){return arguments.length?(this.dh=e,this):this.dh},Cut.Out.prototype.cropX=function(e,t){return t=t||0,this.sx=(this.cutout.x+t)*this.ratio,this.dw=Math.min(this.cutout.w-t,e),this.sw=this.dw*this.ratio,this},Cut.Out.prototype.cropY=function(e,t){return t=t||0,this.sy=(this.cutout.y+t)*this.ratio,this.dh=Math.min(this.cutout.h-t,e),this.sh=this.dh*this.ratio,this},Cut.Out.prototype.offset=function(e,t){return this.dx=e,this.dy=t,this},Cut.Out.prototype.paste=function(e){Cut._stats.paste++;var t=this.image();try{t&&e.drawImage(t,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)}catch(n){this.failed||console.log("Unable to paste: ",this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh,t),this.failed=!0}},Cut.Out.prototype.toString=function(){return"["+this.name+": "+this.dw+"x"+this.dh+"]"},Cut.Out.drawing=function(e,t,n,r,i){var s=document.createElement("canvas"),o=s.getContext("2d");return s.width=Math.ceil(e*n),s.height=Math.ceil(t*n),typeof n!="number"&&(i=r,r=n,n=1),r(o),i||(i={}),i.x||(i.x=0),i.y||(i.y=0),i.w||i.width||(i.w=e),i.h||i.height||(i.h=t),new Cut.Out(i,function(){return s},n)},Cut.Out._cache={},Cut.Out.select=function(e,t){if(typeof e!="string")return e;e=e.split(":",2);if(e.length<2)throw"Invalid selector: '"+e+"'!";var n=e[0],r=e[1];n=Cut._textures[n];if(n==null)return t?[]:null;var i=n.cutouts||n.sprites;if(!t){var s=Cut.Out._cache[n.name][r+"$"];if(typeof s=="undefined"){for(var o=0;o<i.length;o++)if(i[o].name==r){s=i[o];break}Cut.Out._cache[n.name][r+"$"]=s}if(!s)throw"'"+e+"' cutout not found!";return s?new Cut.Out(s,n.getImage,n.imageRatio):null}var s=Cut.Out._cache[n.name][r+"*"];if(typeof s=="undefined"){s=[];var u=r.length;for(var o=0;o<i.length;o++){var a=i[o];a.name&&a.name.substring(0,u)==r&&s.push(i[o])}Cut.Out._cache[n.name][r+"*"]=s}if(!s.length)throw"'"+e+"' cutout not found!";var f=[];for(var o=0;o<s.length;o++)f.push(new Cut.Out(s[o],n.getImage,n.imageRatio));return f},Cut.Pin=function(){this._owner=null,this._parent=null,this._relativeMatrix=new Cut.Matrix,this._absoluteMatrix=new Cut.Matrix,this._boundMatrix=new Cut.Matrix,this.reset()},Cut.Pin._EMPTY={},Cut.Pin.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewX=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boundX=0,this._boundY=0,this._boundWidth=this._width,this._boundHeight=this._height,this._translate_ts=Cut._TS++,this._transform_ts=Cut._TS++,this._matrix_ts=Cut._TS++},Cut.Pin.prototype.tick=function(e){return this._owner=e,this._parent=e._parent&&e._parent._pin,this._handled&&this._handle_mo!=this._transform_ts&&(this._handle_mo=this._transform_ts,this._translate_ts=Cut._TS++),this._aligned&&this._parent&&this._align_mo!=this._parent._transform_ts&&(this._align_mo=this._parent._transform_ts,this._translate_ts=Cut._TS++),this},Cut.Pin.prototype.toString=function(){return this._owner.id()+" ["+this._alignX+", "+this._alignY+"] ["+this._handleX+", "+this._handleY+"] ["+(this._parent?this._parent._owner.id():null)+"]"},Cut.Pin.prototype.absoluteMatrix=function(){var e=Math.max(this._transform_ts,this._translate_ts,this._parent?this._parent._matrix_ts:0);if(this._abs_mo==e)return this._absoluteMatrix;this._abs_mo=e;var t=this._absoluteMatrix;return t.copyFrom(this.relativeMatrix()),this._parent&&t.concat(this._parent._absoluteMatrix),this._matrix_ts=Cut._TS++,t},Cut.Pin.prototype.relativeMatrix=function(){var e=Math.max(this._transform_ts,this._translate_ts,this._parent?this._parent._transform_ts:0);if(this._rel_mo==e)return this._relativeMatrix;this._rel_mo=e;var t=this._relativeMatrix;return t.identity(),this._pivoted&&t.translate(-this._pivotX*this._width,-this._pivotY*this._height),t.scale(this._scaleX,this._scaleY),t.rotate(this._rotation),t.skew(this._skewX,this._skewX),this._pivoted&&t.translate(this._pivotX*this._width,this._pivotY*this._height),this.boundMatrix(),this._x=this._offsetX-this._boundX,this._y=this._offsetY-this._boundY,this._handled&&(this._x-=this._handleX*this._boundWidth,this._y-=this._handleY*this._boundHeight),this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),t.translate(this._x,this._y),this._relativeMatrix},Cut.Pin.prototype.boundMatrix=function(){if(this._bound_mo==this._transform_ts)return;this._bound_mo=this._transform_ts;if(this._pivoted){this._boundX=0,this._boundY=0,this._boundWidth=this._width,this._boundHeight=this._height;return}var e=this._boundMatrix;e.identity(),e.scale(this._scaleX,this._scaleY),e.rotate(this._rotation),e.skew(this._skewX,this._skewX);var t,n;e.a>0&&e.c>0||e.a<0&&e.c<0?(t=0,n=e.a*this._width+e.c*this._height):(t=e.a*this._width,n=e.c*this._height),this._boundX=Math.min(t,n),this._boundWidth=Math.abs(t-n),e.b>0&&e.d>0||e.b<0&&e.d<0?(t=0,n=e.b*this._width+e.d*this._height):(t=e.b*this._width,n=e.d*this._height),this._boundY=Math.min(t,n),this._boundHeight=Math.abs(t-n)},Cut.Pin.prototype.update=function(){if(arguments.length==1&&typeof arguments[0]=="string")return this["_"+arguments[0]];this._transform_flag=!1,this._translate_flag=!1;if(arguments.length==1&&typeof arguments[0]=="object"){var e=arguments[0],t,n;for(t in e)!Cut.Pin._setters[t]&&!Cut.Pin._setters2[t]&&DEBUG&&console.log("Invalid pin: "+t+"/"+e[t]);ctx=Cut.Pin._setters;for(t in e)n=e[t],(setter=ctx[t])&&(n||n===0)&&setter.call(ctx,this,n,e);ctx=Cut.Pin._setters2;for(t in e)n=e[t],(setter=ctx[t])&&(n||n===0)&&setter.call(ctx,this,n,e)}else if(arguments.length==2&&typeof arguments[0]=="string"){var t=arguments[0],n=arguments[1];(ctx=Cut.Pin._setters)&&(setter=ctx[t])?(n||n===0)&&setter.call(ctx,this,n,Cut.Pin._EMPTY):(ctx=Cut.Pin._setters2)&&(setter=ctx[t])?(n||n===0)&&setter.call(ctx,this,n,Cut.Pin._EMPTY):DEBUG&&console.log("Invalid pin: "+t+"/"+n)}return this._translate_flag&&(this._translate_flag=!1,this._translate_ts=Cut._TS++),this._transform_flag&&(this._transform_flag=!1,this._transform_ts=Cut._TS++),this._owner&&(this._owner._pin_ts=Cut._TS++,this._owner.touch()),this},Cut.Pin._setters={alpha:function(e,t,n){e._alpha=t},textureAlpha:function(e,t,n){e._textureAlpha=t},width:function(e,t,n){e._width_=t,e._width=t,e._transform_flag=!0},height:function(e,t,n){e._height_=t,e._height=t,e._transform_flag=!0},scale:function(e,t,n){e._scaleX=t,e._scaleY=t,e._transform_flag=!0},scaleX:function(e,t,n){e._scaleX=t,e._transform_flag=!0},scaleY:function(e,t,n){e._scaleY=t,e._transform_flag=!0},skew:function(e,t,n){e._skewX=t,e._skewY=t,e._transform_flag=!0},skewX:function(e,t,n){e._skewX=t,e._transform_flag=!0},skewY:function(e,t,n){e._skewY=t,e._transform_flag=!0},rotation:function(e,t,n){e._rotation=t,e._transform_flag=!0},pivot:function(e,t,n){e._pivotX=t,e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},pivotX:function(e,t,n){e._pivotX=t,e._pivoted=!0,e._transform_flag=!0},pivotY:function(e,t,n){e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},offset:function(e,t,n){e._offsetX=t,e._offsetY=t,e._translate_flag=!0},offsetX:function(e,t,n){e._offsetX=t,e._translate_flag=!0},offsetY:function(e,t,n){e._offsetY=t,e._translate_flag=!0},align:function(e,t,n){this.alignX.apply(this,arguments),this.alignY.apply(this,arguments)},alignX:function(e,t,n){e._alignX=t,e._aligned=!0,e._translate_flag=!0,this.handleX(e,t,n)},alignY:function(e,t,n){e._alignY=t,e._aligned=!0,e._translate_flag=!0,this.handleY(e,t,n)},handle:function(e,t,n){this.handleX(e,t,n),this.handleY(e,t,n)},handleX:function(e,t,n){e._handleX=t,e._handled=!0,e._translate_flag=!0},handleY:function(e,t,n){e._handleY=t,e._handled=!0,e._translate_flag=!0}},Cut.Pin._setters2={resizeMode:function(e,t,n){Cut._isNum(n.resizeWidth)&&Cut._isNum(n.resizeHeight)&&(this.resizeWidth(e,n.resizeWidth,n,!0),this.resizeHeight(e,n.resizeHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)),e._width=n.resizeWidth/e._scaleX,e._height=n.resizeHeight/e._scaleY)},resizeWidth:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleX=t/e._width_,e._width=e._width_,e._transform_flag=!0},resizeHeight:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleY=t/e._height_,e._height=e._height_,e._transform_flag=!0},scaleMode:function(e,t,n){Cut._isNum(n.scaleWidth)&&Cut._isNum(n.scaleHeight)&&(this.scaleWidth(e,n.scaleWidth,n,!0),this.scaleHeight(e,n.scaleHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)))},scaleWidth:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleX=t/e._width_,e._transform_flag=!0},scaleHeight:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleY=t/e._height_,e._transform_flag=!0}},Cut.Matrix=function(e,t,n,r,i,s){this.changed=!0,this.a=e||1,this.b=t||0,this.c=n||0,this.d=r||1,this.tx=i||0,this.ty=s||0},Cut.Matrix.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.tx+", "+this.ty+"]"},Cut.Matrix.prototype.clone=function(){return new Cut.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},Cut.Matrix.prototype.copyTo=function(e){return e.copyFrom(this),this},Cut.Matrix.prototype.copyFrom=function(e){return this.changed=!0,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},Cut.Matrix.prototype.identity=function(){return this.changed=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Cut.Matrix.prototype.rotate=function(e){if(!e)return this;this.changed=!0;var t=e?Math.cos(e):1,n=e?Math.sin(e):0,r=t*this.a-n*this.b,i=t*this.b+n*this.a,s=t*this.c-n*this.d,o=t*this.d+n*this.c,u=t*this.tx-n*this.ty,a=t*this.ty+n*this.tx;return this.a=r,this.b=i,this.c=s,this.d=o,this.tx=u,this.ty=a,this},Cut.Matrix.prototype.translate=function(e,t){return!e&&!t?this:(this.changed=!0,this.tx+=e,this.ty+=t,this)},Cut.Matrix.prototype.scale=function(e,t){return!(e-1)&&!(t-1)?this:(this.changed=!0,this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.tx*=e,this.ty*=t,this)},Cut.Matrix.prototype.skew=function(e,t){return!e&&!t?this:(this.changed=!0,this.a+=this.b*t,this.d+=this.c*e,this.b+=this.a*e,this.c+=this.d*t,this.tx+=this.ty*t,this.ty+=this.tx*e,this)},Cut.Matrix.prototype.concat=function(e){this.changed=!0;var t=this.a*e.a+this.b*e.c,n=this.b*e.d+this.a*e.b,r=this.c*e.a+this.d*e.c,i=this.d*e.d+this.c*e.b,s=this.tx*e.a+e.tx+this.ty*e.c,o=this.ty*e.d+e.ty+this.tx*e.b;return this.a=t,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o,this},Cut.Matrix.prototype.reverse=function(){if(this.changed){this.changed=!1,this.reversed=this.reversed||new Cut.Matrix;var e=this.a*this.d-this.b*this.c;this.reversed.a=this.d/e,this.reversed.b=-this.b/e,this.reversed.c=-this.c/e,this.reversed.d=this.a/e,this.reversed.tx=(this.c*this.ty-this.tx*this.d)/e,this.reversed.ty=(this.tx*this.b-this.a*this.ty)/e}return this.reversed},Cut.Matrix.prototype.map=function(e,t){return t=t||{},t.x=this.a*e.x+this.c*e.y+this.tx,t.y=this.b*e.x+this.d*e.y+this.ty,t},Cut.Matrix.prototype.mapX=function(e,t){return this.a*e+this.c*t+this.tx},Cut.Matrix.prototype.mapY=function(e,t){return this.b*e+this.d*t+this.ty},Cut.Math={},Cut.Math.random=function(e,t){return arguments.length==0?(t=1,e=0):arguments.length==1&&(t=e,e=0),e==t?e:Math.random()*(t-e)+e},Cut.Math.rotate=function(e,t,n){return arguments.length<3&&(n=t||0,t=0),n>t?(e=(e-t)%(n-t),e+(e<0?n:t)):(e=(e-n)%(t-n),e+(e<=0?t:n))},Cut.Math.length=function(e,t){return Math.sqrt(e*e+t*t)},Cut._TS=0,Cut._isNum=function(e){return typeof e=="number"},Cut._isFunc=function(e){return typeof e=="function"},Cut._isArray="isArray"in Array?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},Cut._extend=function(e,t,n){if(n)for(var r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}else for(var i in t)e[i]=t[i];return e},Cut._now=function(){return typeof performance!="undefined"&&performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return+(new Date)}}(),define("cut-core",function(){}),DEBUG=!0,Cut.Mouse={CLICK:"click",START:"touchstart mousedown",MOVE:"touchmove mousemove",END:"touchend mouseup"},Cut.Mouse.subscribe=function(e,t,n){function h(e){g(e,t),DEBUG&&console.log("Mouse Start: "+e.type+" "+f),!n&&t.addEventListener(o,d),e.preventDefault(),m(e.type,e),c.x=f.x,c.y=f.y,c.state=1}function p(e){try{DEBUG&&console.log("Mouse End: "+e.type+" "+f),!n&&t.removeEventListener(o,d),e.preventDefault(),m(e.type,e),c.state==1&&c.x==f.x&&c.y==f.y?(DEBUG&&console.log("Mouse Click [+]"),m("click",e),c.state=2):c.state=0}catch(r){console&&console.log(r)}}function d(e){try{g(e,t),e.preventDefault(),m(e.type,e)}catch(n){console&&console.log(n)}}function v(e){try{g(e,t),DEBUG&&console.log("Mouse Click: "+e.type+" "+f),e.preventDefault(),c.state!=2?m(e.type,e):DEBUG&&console.log("Mouse Click [-]")}catch(n){console&&console.log(n)}}function m(t,n){f.type=t,f.event=n,l.x=f.x,l.y=f.y,e.visit(a)}function g(t,n){var r=!1;if(t.touches){if(!t.touches.length)return;r=!0,f.x=t.touches[0].pageX,f.y=t.touches[0].pageY}else f.x=t.clientX,f.y=t.clientY,!document.body.scrollLeft&&!document.body.scrollTop&&document.documentElement&&(f.x+=document.documentElement.scrollLeft,f.y+=document.documentElement.scrollTop);f.x-=n.clientLeft||0,f.y-=n.clientTop||0;var i=n;while(i)f.x-=i.offsetLeft||0,f.y-=i.offsetTop||0,r||(f.x+=i.scrollLeft||0,f.y+=i.scrollTop||0),i=i.offsetParent;f.x*=e.ratio||1,f.y*=e.ratio||1}t=t||document;var r="ontouchstart"in window,i="click",s=r?"touchstart":"mousedown",o=r?"touchmove":"mousemove",u=r?"touchend":"mouseup";t.addEventListener(i,v),t.addEventListener(s,h),t.addEventListener(u,p),n&&t.addEventListener(o,d);var a=null,f={x:0,y:0,toString:function(){return(this.x|0)+"x"+(this.y|0)}},l={x:0,y:0,toString:function(){return f+" / "+(this.x|0)+"x"+(this.y|0)}},c={x:0,y:0,state:0};a={reverse:!0,visible:!0,start:function(e){if(!e.spy()){e.matrix().reverse().map(f,l);if(l.x<0||l.x>e._pin._width||l.y<0||l.y>e._pin._height)return!0}},end:function(e){var t=e.listeners(f.type);if(t){e.matrix().reverse().map(f,l);for(var n=0;n<t.length;n++)if(t[n].call(e,f.event,l))return!0}}}},define("cut-mouse",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,window.addEventListener("load",function(){DEBUG&&console.log("On load."),Cut.Loader.start()},!1),Cut.Loader={start:function(){if(this.started)return;this.started=!0,Cut.Loader.play()},play:function(){this.played=!0;for(var e=this.loaders.length-1;e>=0;e--)this.roots.push(this.loaders[e]()),this.loaders.splice(e,1)},pause:function(){for(var e=this.loaders.length-1;e>=0;e--)this.roots[e].pause()},resume:function(){for(var e=this.loaders.length-1;e>=0;e--)this.roots[e].resume()},loaders:[],roots:[],load:function(e,t){function n(){function f(){DEBUG&&console.log("Images loaded."),n=t.getContext("2d");var r=window.devicePixelRatio||1,i=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;o=r/i,t.resize=l,DEBUG&&console.log("Loading..."),e(u,t),l(),window.addEventListener("resize",l,!1),DEBUG&&console.log("Start playing..."),u.start()}function l(){r?(i=window.innerWidth>0?window.innerWidth:screen.width,s=window.innerHeight>0?window.innerHeight:screen.height,t.style.width=i+"px",t.style.height=s+"px"):(i=t.clientWidth,s=t.clientHeight),i*=o,s*=o,t.width=i,t.height=s,u.ratio=o,DEBUG&&console.log("Resize: "+i+" x "+s+" / "+o),u.visit({start:function(e){var t=!0,n=e.listeners("resize");if(n)for(var r=0;r<n.length;r++)t&=!n[r].call(e,i,s);return t}})}var n=null,r=!1,i=0,s=0,o=1;DEBUG&&console.log("Creating root...");var u=Cut.root(function(e){n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,i,s),e.render(n)},requestAnimationFrame);t||(t=document.getElementById("cutjs"));if(!t){r=!0,DEBUG&&console.log("Creating element..."),t=document.createElement("canvas"),t.style.position="absolute";var a=document.body;a.insertBefore(t,a.firstChild)}return DEBUG&&console.log("Loading images..."),Cut.loadImages(function(e,t,n){var r=new Image;return DEBUG&&console.log("Loading image: "+e),r.onload=t,r.onerror=n,r.src=e,r},f),u}this.played?this.roots.push(n()):this.loaders.push(n)}},!function(){var e=["ms","moz","webkit","o"];for(var t=0;t<e.length&&!window.requestAnimationFrame;t++){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var t=(new Date).getTime();return r=Math.max(r+16,t),window.setTimeout(function(){e(r)},r-t)}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("cut-loader",function(){}),Cut.addTexture({name:"base",imagePath:"media/base.png",imageRatio:8,ratio:16,filter:function(e){return e.y=8-(e.y+e.h),e},sprites:[{name:"coin_1_",x:0,y:5,w:1,h:1},{name:"coin_2_",x:1,y:5,w:1,h:1},{name:"coin_5_",x:2,y:5,w:1,h:1},{name:"coin_10_",x:3,y:5,w:1,h:1},{name:"coin_20_",x:4,y:5,w:1,h:1},{name:"coin_50_",x:5,y:5,w:1,h:1},{name:"coin_100_",x:6,y:5,w:1,h:1},{name:"coin_1000_",x:7,y:5,w:1,h:1},{name:"coin_10000_",x:8,y:5,w:1,h:1},{name:"player_",x:0,y:1,w:1,h:1},{name:"player_",x:1,y:1,w:1,h:1},{name:"player_",x:2,y:1,w:1,h:1},{name:"player_",x:3,y:1,w:1,h:1},{name:"player_",x:4,y:1,w:1,h:1},{name:"player_",x:3,y:1,w:1,h:1},{name:"player_",x:2,y:1,w:1,h:1},{name:"player_",x:1,y:1,w:1,h:1},{name:"cursor",x:1,y:0,w:1,h:1},{name:"tombstone",x:12.375,y:4.375,w:3.625,h:3.625},{name:"energy",x:2,y:.4,w:2,h:.3,left:.125,right:.125},{name:"dot",x:4,y:0,w:1,h:1},{name:"power",x:5,y:0,w:1,h:1},{name:"up_power",x:6,y:4,w:1,h:1},{name:"up_energy",x:7,y:4,w:1,h:1},{name:"up_speed",x:8,y:4,w:1,h:1},{name:"up_pull",x:9,y:4,w:1,h:1},{name:"up_push",x:10,y:4,w:1,h:1},{name:"up_slow",x:11,y:4,w:1,h:1},{name:"up_0",x:9.5,y:1.35,w:1,h:.3},{name:"up_1",x:9.25,y:1.35,w:1,h:.3},{name:"up_2",x:9,y:1.35,w:1,h:.3},{name:"up_3",x:8.75,y:1.35,w:1,h:.3},{name:"up_4",x:8.5,y:1.35,w:1.25,h:.3},{name:"up_5",x:8.25,y:1.35,w:1.5,h:.3},{name:"up_6",x:8,y:1.35,w:1.5,h:.3},{name:"maximize",x:11,y:1,w:1,h:1},{name:"die_",x:2,y:1,w:1,h:1},{name:"die_",x:6,y:1,w:1,h:1},{name:"die_",x:5,y:1,w:1,h:1},{name:"die_",x:2,y:1,w:1,h:1},{name:"die_",x:6,y:1,w:1,h:1},{name:"die_",x:5,y:1,w:1,h:1},{name:"die_",x:2,y:1,w:1,h:1},{name:"die_",x:6,y:1,w:1,h:1},{name:"die_",x:5,y:1,w:1,h:1},{name:"die_",x:5,y:1,w:1,h:1},{name:"unbox",x:5,y:2,w:1,h:1},{name:"box_",x:1,y:2,w:1,h:1},{name:"box_",x:0,y:2,w:1,h:1},{name:"box_",x:0,y:2,w:1,h:1},{name:"box_",x:1,y:2,w:1,h:1},{name:"box_",x:2,y:2,w:1,h:1},{name:"boxz_",x:6,y:2,w:1,h:1},{name:"boxz_",x:7,y:2,w:1,h:1},{name:"boxz_",x:8,y:2,w:1,h:1},{name:"box_",x:3,y:2,w:1,h:1},{name:"box_",x:4,y:2,w:1,h:1},{name:"box_",x:4,y:2,w:1,h:1},{name:"box_",x:3,y:2,w:1,h:1},{name:"box_",x:2,y:2,w:1,h:1},{name:"boxz_",x:9,y:2,w:1,h:1},{name:"boxz_",x:10,y:2,w:1,h:1},{name:"boxz_",x:11,y:2,w:1,h:1},{name:"untri",x:5,y:3,w:1,h:1},{name:"tri_",x:1,y:3,w:1,h:1},{name:"tri_",x:0,y:3,w:1,h:1},{name:"tri_",x:1,y:3,w:1,h:1},{name:"tri_",x:2,y:3,w:1,h:1},{name:"triz_",x:6,y:3,w:1,h:1},{name:"triz_",x:7,y:3,w:1,h:1},{name:"triz_",x:8,y:3,w:1,h:1},{name:"tri_",x:3,y:3,w:1,h:1},{name:"tri_",x:4,y:3,w:1,h:1},{name:"tri_",x:3,y:3,w:1,h:1},{name:"tri_",x:2,y:3,w:1,h:1},{name:"triz_",x:9,y:3,w:1,h:1},{name:"triz_",x:10,y:3,w:1,h:1},{name:"triz_",x:11,y:3,w:1,h:1},{name:"d_0",x:6,y:.3,w:.29375,h:.4},{name:"d_1",x:6.5,y:.3,w:.19375,h:.4},{name:"d_2",x:7,y:.3,w:.28125,h:.4},{name:"d_3",x:7.5,y:.3,w:.26875,h:.4},{name:"d_4",x:8,y:.3,w:5/16,h:.4},{name:"d_5",x:8.5,y:.3,w:.275,h:.4},{name:"d_6",x:9,y:.3,w:.29375,h:.4},{name:"d_7",x:9.5,y:.3,w:.28125,h:.4},{name:"d_8",x:10,y:.3,w:.3,h:.4},{name:"d_9",x:10.5,y:.3,w:.3,h:.4},{name:"d_-",x:11,y:.3,w:3/16,h:.4},{name:"d_.",x:11.5,y:.3,w:.125,h:.4},{name:"d_k",x:12,y:.3,w:.25,h:.4},{name:"d_M",x:12.5,y:.3,w:7/16,h:.4},{name:"d_$",x:13,y:.3,w:.375,h:.4},{name:"d_ ",x:13.5,y:.3,w:5/16,h:.4},{name:"playbg",x:.1,y:7.1,w:.8,h:.8},{name:"homebg",x:1.1,y:7.1,w:.8,h:.8},{name:"c_10",x:2.1,y:7.1,w:.3,h:.3},{name:"c_20",x:2.1,y:7.6,w:.3,h:.3},{name:"c_11",x:2.6,y:7.1,w:.3,h:.3},{name:"c_12",x:3.1,y:7.1,w:.3,h:.3},{name:"c_13",x:3.6,y:7.1,w:.3,h:.3},{name:"c_14",x:4.1,y:7.1,w:.3,h:.3},{name:"c_15",x:4.6,y:7.1,w:.3,h:.3},{name:"c_16",x:5.1,y:7.1,w:.3,h:.3},{name:"c_17",x:5.6,y:7.1,w:.3,h:.3},{name:"c_18",x:6.1,y:7.1,w:.3,h:.3},{name:"c_21",x:2.6,y:7.6,w:.3,h:.3},{name:"c_22",x:3.1,y:7.6,w:.3,h:.3},{name:"c_23",x:3.6,y:7.6,w:.3,h:.3},{name:"c_24",x:4.1,y:7.6,w:.3,h:.3},{name:"c_25",x:4.6,y:7.6,w:.3,h:.3},{name:"c_26",x:5.1,y:7.6,w:.3,h:.3},{name:"c_27",x:5.6,y:7.6,w:.3,h:.3},{name:"c_28",x:6.1,y:7.6,w:.3,h:.3},{name:"shadow",x:6.6,y:7.9,w:.3,h:.1},{name:"option",x:9.5,y:6.25,w:1.5,h:1.5},{name:"play",x:7.5,y:6.25,w:1.5,h:1.5},{name:"border",x:0,y:6,w:1,h:1,top:1/8,bottom:1/8,left:1/8,right:1/8}]}),define("textures",function(){}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=this,n=Array.prototype.slice.call(arguments,1),r=function(){},i=function(){return t.apply(this instanceof r&&e?this:e,n.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),define("polyfills",function(){});var X=X||{};X.pool=function(){return new X.Pool},X.Pool=Pool=function(e,t,n,r){var i=[],s=4,o="",u=0,a=0,f=0,l=0;this.create=function(t){return e=t,this},this.exit=function(e){return t=func,this},this.enter=function(e){return n=func,this},this.discard=function(e){return r=e,this},this.max=function(e){return arguments.length?(s=e,this):s},this.name=function(e){return arguments.length?(o=e,this):o},this.checkOut=function(n){var r;return i.length?r=i.shift():(u++,r=(n||e).apply(this)),a++,t&&t.call(this,r),r},this.checkIn=function(e,t){i.length<s?(f++,n&&n.call(this,e),i.push(e)):(l++,(t=t||r)&&t.call(this,e))},this.toString=function(){return"Pool ("+o+"):"+" +"+u+" >"+a+" <"+f+" -"+l+" ="+i.length+"/"+s}},define("pool",function(){});var X=X||{};X.randomize=function(){return new X.Randomize},X.Randomize=Randomize=function(){this._options=[],this._nope=null,this._filter=function(e){return e}},Randomize.prototype.reset=function(){return this._reset&&this._reset(),this},Randomize.prototype.clone=function(){var e=new Randomize;return Array.push.apply(e._options,this._options),e._nope=this._nope,e._filter=this._filter,e._lock=this._lock,e._condition=this._condition,e},Randomize.prototype.filter=function(e){return this._filter=e||function(e){return e},this},Randomize.prototype.nope=function(e){return arguments.length?(this._nope=e,this):this._nope},Randomize.prototype.add=function(e,t,n){return this._options.push([e,Randomize._numbor(t,1)]),n&&(this._lock=this._options.length-1),this},Randomize.prototype.condition=function(e,t){return this._condition=e,this._reset=t,this},Randomize.prototype.select=function(e){return this._filter(this._options[e][0])},Randomize.prototype.random=function(){if(this._condition&&!this._condition.apply(null,arguments))return this._filter(this._nope);if(typeof this._lock=="number")return this.select(this._lock);var e=0;for(var t=0;t<this._options.length;t++){var n=this._options[t];n[2]=n[1].apply(null,arguments),e+=n[2]}var r=Math.random()*e,i=this._nope;for(var t=0;t<this._options.length;t++){var n=this._options[t];if((r-=n[2])<0){i=n[0];break}}return this._filter(i)},Randomize.prototype.spacing=function(e){e=Randomize._numbor(e,1);var t=null;return this.condition(function(){return t===null?(t=e.apply(null,arguments),!1):--t<0?(t=e.apply(null,arguments),!0):!1},function(){t=null}),this},Randomize.prototype.prob=function(e){return e=Randomize._numbor(e,1),this.condition(function(){var t=e();return console.log(t),t>Math.random()}),this},Randomize._numbor=function(e,t){return typeof e=="function"?e:(typeof e!="number"&&(e=t),function(){return e})},define("randomize",function(){}),TOP=typeof TOP=="number"?TOP:0;var M=Cut.Math,Conf={};Conf.width=240,Conf.height=120,Conf.max=Conf.height*.47,Conf.min=-Conf.max,Conf.objSpace=20,Conf.dotSpace=6,Conf.speed=.11,Conf.acceleration=8e-4/1e3,Conf.ups=["power","energy","speed","pull","push","slow"],Conf.radius={Player:6,Dot:1,Power:4,Enemy:5,Coin:6},Conf.pull={Dot:1,Power:.1},Conf.push={Enemy:1},Conf.$=function(e){return e=e||0,e<1e4||(e<1e6?e=(e/100|0)/10+"k":e=(e/1e4|0)/100+"M"),"$"+e},Conf.k=function(e){return e=e?e/10|0:0,e<1e4||(e<1e6?e=(e/100|0)/10+"k":e=(e/1e4|0)/100+"M"),e},Conf.coinsScale={c1:.7,c2:.75,c5:.8,c10:.9,c20:.95,c50:1,c100:1.1},Conf.saveKey="data",Conf.loadData=function(){var e=Conf.saveKey;DEBUG&&console.log("game load",e);try{var t=localStorage.getItem(e);return DEBUG&&console.log("game load",e,t),t&&JSON.parse(t)||{}}catch(n){console.log(n)}return{}},Conf.saveData=function(e){var t=Conf.saveKey;DEBUG&&console.log("game save",t);try{return e=JSON.stringify(e),DEBUG&&console.log("game save",t,e),localStorage.setItem(t,e),!0}catch(n){console.log(n)}return!1},Player.prototype.upgrade=function(e){this.power=500+e.power*250,this.energy=(1-e.energy/16)/1e3,this.speed=.2+e.speed*.02,this.pull=e.pull,this.push=e.push,this.slow=1/(e.slow*.2+1)},Game.prototype.newDot=function(e,t){var n=this.dots.checkOut();return n.x=e,n.y=t,n.vx=0,n.vy=0,n.uiXY(),this.insert(n,n),n},Dot.prototype.collide=function(){return this.game.energy=Math.min(1.5,this.game.energy+.01),this.game.uiEnergy(this.game.energy),this.uiEat(),!0},Dot.prototype.remove=function(){this.game.dots.checkIn(this)},Game.prototype.newPower=function(e,t){var n=new Power(this);return n.x=e,n.y=t,n.uiXY(),this.insert(n),n},Power.prototype.collide=function(){return this.game.power=Math.max(this.game.player.power,this.game.power),this.uiEat(),!0},Power.prototype.remove=function(){this.uiRemove()},Game.prototype.newEnemy=function(e,t,n,r,i){var s=new Enemy(this,e);return s.x=t,s.y=n,s.vx=r||0,s.vy=i||0,s.uiXY(),this.insert(s),s},Enemy.prototype.setPower=function(e,t){if(this.dead)return;e<=0?this.weak!=0&&(this.push=Conf.push.Enemy,this.weak=0,this.uiMode(0)):e<t/10?this.weak!=1&&(this.push=Conf.push.Enemy,this.weak=1,this.uiMode(0)):e<t/4?this.weak!=2&&(this.push=0,this.weak=2,this.uiMode(.5)):this.weak!=3&&(this.push=0,this.weak=3,this.uiMode(1))},Enemy.prototype.collide=function(){return this.dead||(this.weak==0?this.game.end(!0):this.weak>0&&(this.push=0,this.uiMode(-1),this.dead=!0,this.vx=this.vy=0,this.uiEat())),!1},Enemy.prototype.remove=function(){this.uiRemove()},Game.prototype.newCoin=function(e,t,n){var r=new Coin(this,e);return r.x=t,r.y=n,r.uiXY(),this.insert(r),r},Coin.prototype.collide=function(e){return this.game.coins+=this.value,this.game.uiCoins(this.game.coins),this.uiEat(),!0},Coin.prototype.remove=function(){this.uiRemove()},Cut.Anim.FPS=11,Cut.Loader.load(function(e,t){return Cut.Mouse.subscribe(e,t,!0),(new App(t)).appendTo(e)}),App.prototype=new Cut(Cut.Proto),App.prototype._super=Cut,App.prototype.constructor=App,App.width=Conf.width,App.height=Conf.height*1.2,App.prototype.open=function(e){var t=e;typeof t=="string"&&(t=this[t]);if(this.opened===t)return;this.opened&&(this.opened.publish("close")||this.opened.hide()),(this.opened=t).publish("open"),this.opened.show()},Home.prototype=new Cut(Cut.Proto),Home.prototype._super=Cut,Home.prototype.constructor=Home,Play.prototype=new Cut(Cut.Proto),Play.prototype._super=Cut,Play.prototype.constructor=Play,Conf.randomEnemy=(new Randomize).spacing(function(e){return M.random(5,50)/Conf.objSpace*10}),Conf.randomEnemy.add(function(e,t){var n=M.random(-1,1)*(Conf.height/2-10);return e.newEnemy("box",t,n)}),Conf.randomEnemy.add(function(e,t){var n=M.random()>=.5?1:-1,r=n*Conf.height/2,i=-n*e.speed/2*M.random(.7,1.4);return e.newEnemy("tri",t+400*e.speed,r-400*i,0,i)}),Conf.randomCoin=(new Randomize).spacing(function(e){return M.random(20,100)/Conf.objSpace*10}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(1,t,n)},function(e){return 1}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(2,t,n)},function(e){return e.dist>2e3?1:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(5,t,n)},function(e){return e.dist>5e3?2:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(10,t,n)},function(e){return e.dist>1e4?4:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(20,t,n)},function(e){return e.dist>2e4?8:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(50,t,n)},function(e){return e.dist>5e4?16:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(100,t,n)},function(e){return e.dist>1e5?32:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(1e3,t,n)},function(e){return e.dist>1e5?4*e.dist/1e5:0}),Conf.randomCoin.add(function(e,t,n){return e.newCoin(1e4,t,n)},function(e){return e.dist>1e5?e.dist/1e5:0}),Conf.randomPower=(new Randomize).spacing(function(e){return M.random(100,400)}),Conf.randomPower.add(function(e,t,n){return e.newPower(t,n)}),Conf.randomPattern=(new Randomize).spacing(function(e){return M.random(20,40)/Conf.objSpace*10}),Conf.randomPattern.range=function(e,t){var n=M.random(e,t)*(Conf.max-Conf.min),r=M.random(Conf.min+n/2,Conf.max-n/2);n*=Math.random()>=.5?1:-1;var i=r-n/2,s=r+n/2;return{a:i,b:s,h:n,c:r}},Conf.randomPattern.add(function(e,t){var n=M.random(40,50),r=M.random(Conf.min,Conf.max),i=0;for(var s=0;s<n;s++)i++,e.newDot(t+s*Conf.dotSpace,r);return i},function(e){return 1}),Conf.randomPattern.add(function(e,t){var n=M.random(20,40)|0,r=Conf.randomPattern.range(.2,.7),i=0;for(var s=0;s<n;s++)i++,e.newDot(t+s*Conf.dotSpace,r.a+s*r.h/n);return i},function(e){return e.dist<1e3?0:1}),Conf.randomPattern.add(function(e,t){var n=M.random(3,6)|0,r=M.random(5,15)|0,i=n*r,s=Conf.randomPattern.range(.3,.7),o=s.h/n,u=0;for(var a=0;a<i;a++)u++,e.newDot(t+a*Conf.dotSpace,s.a+(a*s.h/i/o|0)*o);return u},function(e){return e.dist<5e3?0:1}),Conf.randomPattern.add(function(e,t){var n=M.random(2,6)|0,r=M.random(7,13)|0,i=n*r,s=Conf.randomPattern.range(.1,.6),o=s.h,u=0;for(var a=0;a<i;a++)u++,e.newDot(t+a*Conf.dotSpace,s.a+(-a*s.h/r/o|0)*o+a*s.h/r);return u},function(e){return e.dist<2e4?0:1}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=Conf.dotSpace/M.random(10,30),i=M.random(10,30),s=M.random(Conf.min+i,Conf.max-i),o=0;for(var u=0;u<n;u++)o++,e.newDot(t+u*Conf.dotSpace,s+i*Math.sin(u*r));return o},function(e){return e.dist<1e4?0:2}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=Conf.dotSpace/M.random(10,40),i=M.random(10,30),s=Conf.dotSpace/M.random(10,40),o=M.random(10,30),u=M.random(Conf.min+i,Conf.max-i),a=0;for(var f=0;f<n;f++)a++,e.newDot(t+f*Conf.dotSpace+o*Math.cos(f*s),u+i*Math.sin(f*r));return a},function(e){return e.dist<25e3?0:e.dist<15e3?1:2}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=Conf.dotSpace/M.random(10,40),i=M.random(10,30),s=M.random(Conf.min+i,Conf.max-i),o=0;for(var u=0;u<n;u++)o++,e.newDot(t+u*Conf.dotSpace,s+i*M.zigzag(u*r));return o},function(e){return e.dist<15e3?0:2}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=Conf.dotSpace/M.random(10,40),i=M.random(10,30),s=Conf.dotSpace/M.random(10,40),o=M.random(10,30),u=M.random(Conf.min+i,Conf.max-i),a=0;for(var f=0;f<n;f++)a++,e.newDot(t+f*Conf.dotSpace+o*M.zagzig(f*s),u+i*M.zigzag(f*r));return a},function(e){return e.dist<3e4?0:e.dist<17500?1:2}),Conf.randomPattern.add(function(e,t){var n=M.random(3,8),r=n,i=M.random(Conf.min,Conf.max-r*Conf.dotSpace),s=0;for(var o=0;o<n;o++)for(var u=0;u<r;u++)s++,e.newDot(t+o*Conf.dotSpace,i+u*Conf.dotSpace);return s},function(e){return e.dist<7e4?0:1}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=Math.min(1,e.dist/1e5),i=Math.min(1,e.dist/2e5),s=Conf.randomPattern.range(i*.5,r*.7),o=0;for(var u=0;u<n;u++)o++,e.newDot(t+u*Conf.dotSpace,M.random(s.a,s.b));return o},function(e){return e.dist<5e4?0:e.dist<75e3?1:2}),Conf.randomPattern.add(function(e,t){var n=M.random(40,60),r=M.random(.2,.9)*Math.PI,i=5,s=0;for(var o=0;o<n;o++)s++,e.newDot(t+i*Math.sqrt(o+1)*Math.sin(o*r),i*Math.sqrt(o+1)*Math.cos(o*r));return s},function(e){return e.dist<1e5?0:1}),Cut.Math.zigzag=function(e){return e=Cut.Math.rotate(e,-Math.PI,Math.PI)/Math.PI*2,e>1?e=2-e:e<-1&&(e=-2-e),e},Cut.Math.zagzig=function(e){return Cut.Math.zigzag(e+Math.PI/2)},Array.prototype.at=function(e){return e=this.length>1?e%this.length:0,e=e<0?e+this.length:e,this[e]},Cut.prototype.xy=function(e,t){return this.pin({offsetX:e,offsetY:t}),this},Cut.prototype.x=function(e){return arguments.length?(this.pin("offsetX",e),this):this.pin("offsetX")},Cut.prototype.y=function(e){return arguments.length?(this.pin("offsetY",e),this):this.pin("offsetY")},define("app",function(){}),requirejs.config({paths:{def:"../req/def.dev","cut-core":"bower_components/cutjs/cut-core","cut-mouse":"bower_components/cutjs/cut-mouse","cut-loader":"bower_components/cutjs/cut-loader",pool:"bower_components/extrajs/pool",randomize:"bower_components/extrajs/randomize",domReady:"../req/bower_components/requirejs-domready/domReady"},shim:{app:{deps:["def","cut-core","cut-loader","cut-mouse","polyfills","pool","randomize"]},"cut-core":{exports:"Cut"},"cut-loader":{deps:["cut-core"]},"cut-mouse":{deps:["cut-core"]},textures:{deps:["cut-core"]}}}),require(["domReady","def","cut-core","cut-mouse","cut-loader","textures","polyfills","pool","randomize","app"],function(e){e(function(){Cut.Loader.start()})}),define("../req/dev",function(){});