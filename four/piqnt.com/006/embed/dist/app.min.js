/**
 * almond 0.2.7 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

//     Underscore.js 1.5.2
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*
 * CutJS
 * Copyright (c) 2013-2014 Ali Shakiba, Piqnt LLC and other contributors
 * Available under the MIT license
 * @license
 */

/*
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at
 
 http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License.
 */

function checkDomain(e){var t=document.location.hostname;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])!=-1)return!0}function Cut(){if(arguments[0]===Cut.Proto)return;Cut._stats.create++,this._id="",this._visible=!0,this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._pin=(new Cut.Pin).tick(this),this._outs=[],this._tickBefore=[],this._tickAfter=[],this._spy=!1,this._alpha=1}function Hex(){}function PlayMode(){}function FlipMode(){}function MoveMode(){this.n=4,this.key="colorlines"}function SlideMode(){this.n=3}function Cell(e,t,n,r,i){this.i=e,this.j=t,this.x=n,this.y=r,this.key=i}function Bit(e){this.color=e}function Status(){}function pSign(e){return(e>0?"+":"")+e}function App(){App.prototype._super.call(this),this.bg=Cut.image("bg:full").appendTo(this),this.spy(!0),this.box=(new Cut).appendTo(this).spy(!0),this.play=(new Play(this)).appendTo(this.box),this.home=(new Home(this)).appendTo(this.box),document.addEventListener("backbutton",function(e){this.play.visible()?this.openHome():navigator.app.exitApp()}.bind(this),!1),this.openHome(),this.box.listen("resize",function(e,t){return!0}),this.listen("resize",function(e,t){_ratio=window.devicePixelRatio||1,DEBUG&&console.log("Size: "+e+" x "+t+" / "+_ratio),this.pin({width:e,height:t});var n=Math.min(_heightMax*_ratio,t),r=Math.min(_widthMax*_ratio,e,n);return this.box.pin({width:_width,height:_height,resizeMode:"in",resizeWidth:r,resizeHeight:n,align:.5}),this.bg.pin({scaleMode:"out",scaleWidth:e,scaleHeight:t,align:.5}),!0})}function Home(e){Home.prototype._super.call(this),this.game=e,this.hide(),this.menu=Cut.column(.5).appendTo(this).pin({align:.5}),Cut.image("hex:logo").appendTo(this.menu),this.buttons=[1,2,3].map(function(t){var n=Cut.image("hex:mode_"+t).appendTo(this.menu);return n.listen(Cut.Mouse.CLICK,function(n,r){return e.openPlay(t),!0}),n},this),this.listen("resize",function(){this.pin({width:this.parent().pin("width"),height:this.parent().pin("height")})})}function Play(e){Play.prototype._super.call(this),this.game=e,this.hide(),this.board=(new Board(this)).appendTo(this).pin({align:.5,handle:0}),this.reset=Cut.anim("hex:reset",1).appendTo(this).pin({alignX:1,alignY:1}).listen(Cut.Mouse.CLICK,function(t,n){return DEBUG&&console.log("reset"),e.openPlay(),!0}),this.back=Cut.image("hex:back").appendTo(this).pin({alignX:0,alignY:1}).listen(Cut.Mouse.CLICK,function(t,n){return DEBUG&&console.log("back"),e.openHome(),!0}),this.queue=Cut.string("hex:c_").appendTo(this).pin({alignX:1,alignY:0,offsetX:-9,offsetY:10,scale:.4}),this.score=Cut.string("hex:num_").appendTo(this).pin({alignX:0,alignY:0,offsetX:9,offsetY:8,scale:1.1}),this.scoreAdded=Cut.string("hex:num_").appendTo(this).pin({alignX:.5,alignY:0,offsetX:0,offsetY:8,scale:.9}),this.timeout=Cut.string("hex:num_").appendTo(this).pin({alignX:1,alignY:0,handleX:0,offsetX:-50,offsetY:8,scale:1.1}),this.myscore=Cut.row(.5).appendTo(this).pin({align:.5,scale:1.4}),this.mystar=Cut.image("hex:star.fill").appendTo(this.myscore),this.mynumb=Cut.string("hex:num_").appendTo(this.myscore),this.topscore=Cut.row(1).appendTo(this).pin({alignX:.5,alignY:1,offsetX:0,offsetY:-14,scale:.8}),this.topstar=Cut.image("hex:star").appendTo(this.topscore),this.topnumb=Cut.string("hex:num_").appendTo(this.topscore),this.listen("resize",function(e,t){this.pin({width:this.parent().pin("width"),height:this.parent().pin("height")})})}function Board(e){Board.prototype._super.call(this),this.spy(!0),this.play=e,this.hex=new Hex,this.hex.ui=e,this.hide(),this.listen(Cut.Mouse.START,function(e,t){return this.hex.mousedown(this.backwardPoint(t)),!0}),this.listen(Cut.Mouse.MOVE,function(e,t){return this.hex.mousemove(this.backwardPoint(t)),!0}),this.listen(Cut.Mouse.END,function(e,t){return this.hex.mouseup(this.backwardPoint(t)),!0}),this.listen(Cut.Mouse.CLICK,function(e,t){return this.hex.click(this.backwardPoint(t)),!0})}var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),E=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!E)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c});const DEBUG=!1;!checkDomain(["piqnt.com"]),define("def",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.2";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else{var o=x.keys(e);for(var i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)return}};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return arguments.length<2||n?e[x.random(e.length-1)]:x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={},s=n==null?x.identity:k(n);return T(t,function(n,o){var u=s.call(r,n,o,t);e(i,u,n)}),i}};x.groupBy=L(function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u;return function(){s=this,i=arguments,o=new Date;var a=function(){var f=new Date-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i)))},f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i)),u}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},x.pairs=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){var t={},n=x.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,Cut.Proto={},Cut._stats={create:0,tick:0,paint:0,paste:0},Cut.create=function(){return new Cut},Cut.prototype.render=function(e){Cut._stats.tick=Cut._stats.paint=Cut._stats.paste=0;var t=+(new Date);this._tick(),this._paint(e),Cut._stats.fps=1e3/(+(new Date)-t)},Cut.prototype._tick=function(){if(!this._visible)return;this._pin.tick(this);var e=this._tickBefore.length;for(var t=0;t<e;t++)Cut._stats.tick++,this._tickBefore[t].call(this);var n,r=this._first;while(n=r)r=n._next,n._tick();var e=this._tickAfter.length;for(var t=0;t<e;t++)Cut._stats.tick++,this._tickAfter[t].call(this)},Cut.prototype.tick=function(e,t){t?this._tickBefore.push(e):this._tickAfter.push(e)},Cut.prototype._paint=function(e){if(!this._visible)return;Cut._stats.paint++;var t=this.matrix();e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;e.globalAlpha!=n&&(e.globalAlpha=n);var r=this._outs.length;for(var i=0;i<r;i++)this._outs[i].paste(e);e.globalAlpha!=this._alpha&&(e.globalAlpha=this._alpha);var s,o=this._first;while(s=o)o=s._next,s._paint(e)},Cut.prototype.toString=function(){return"["+this._id+"]"},Cut.prototype.id=function(e){return arguments.length?(this._id=e,this):this._id},Cut.prototype.attr=function(e,t){return arguments.length<2?this._attrs?this._attrs[e]:undefined:((this._attrs?this._attrs:this._attrs={})[e]=t,this)},Cut.prototype.listen=function(e,t){if(typeof t!="function")return this;e=(Cut._isArray(e)?e.join(" "):e).split(/\s+/);for(var n=0;n<e.length;n++){var r=e[n];r&&(this._listeners=this._listeners||{},this._listeners[r]=this._listeners[r]||[],this._listeners[r].push(t))}return this},Cut.prototype.listeners=function(e){return this._listeners&&this._listeners[e]},Cut.prototype.publish=function(e,t){var n=this.listeners(e);if(!n||!n.length)return!1;for(var r=0;r<n.length;r++)n[r].apply(this,t);return!0},Cut.prototype.visit=function(e){var t=e.reverse,n=e.visible;if(e.start&&e.start(this))return;var r,i=t?this.last(n):this.first(n);while(r=i){i=t?r.prev(n):r.next(n);if(r.visit(e,t))return!0}return e.end&&e.end(this)},Cut.prototype.visible=function(e){return arguments.length?(this._visible=e,this._parent&&(this._parent._children_ts=Cut._TS++),this._pin_ts=Cut._TS++,this.touch(),this):this._visible},Cut.prototype.hide=function(){return this.visible(!1)},Cut.prototype.show=function(){return this.visible(!0)},Cut.prototype.parent=function(){return this._parent},Cut.prototype.next=function(e){var t=this._next;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.prev=function(e){var t=this._prev;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.first=function(e){var t=this._first;while(t&&e&&!t._visible)t=t._next;return t},Cut.prototype.last=function(e){var t=this._last;while(t&&e&&!t._visible)t=t._prev;return t},Cut.prototype.append=function(){for(var e=0;e<arguments.length;e++)arguments[e].appendTo(this);return this},Cut.prototype.prepend=function(){for(var e=0;e<arguments.length;e++)arguments[e].prependTo(this);return this},Cut.prototype.appendTo=function(e){if(!e)throw"Parent is null!";return this.remove(),e._last&&(e._last._next=this,this._prev=e._last),this._parent=e,e._last=this,e._first||(e._first=this),this._parent_ts=Cut._TS++,e._children_ts=Cut._TS++,e.touch(),this},Cut.prototype.prependTo=function(e){if(!e)throw"Parent is null!";return this.remove(),e._first&&(e._first._prev=this,this._next=e._first),this._parent=e,e._first=this,e._last||(e._last=this),this._parent_ts=Cut._TS++,e._children_ts=Cut._TS++,e.touch(),this},Cut.prototype.insertNext=function(){if(arguments.length)for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].insertAfter(this);return this},Cut.prototype.insertPrev=function(){if(arguments.length)for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].insertBefore(this);return this},Cut.prototype.insertBefore=function(e){if(!e)throw"Next is null!";this.remove();var t=e._parent,n=e._prev;e._prev=this,n&&(n._next=this)||t&&(t._first=this),this._parent=t,this._prev=n,this._next=e,this._parent_ts=Cut._TS++,this.touch()},Cut.prototype.insertAfter=function(e){if(!e)throw"Prev is null!";this.remove();var t=e._parent,n=e._next;e._next=this,n&&(n._prev=this)||t&&(t._last=this),this._parent=t,this._prev=e,this._next=n,this._parent_ts=Cut._TS++,this.touch()},Cut.prototype.remove=function(){if(arguments.length){for(var e=0;e<arguments.length;e++)arguments[e]&&arguments[e].remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev)),this._parent&&(this._parent._children_ts=Cut._TS++,this._parent.touch()),this._prev=this._next=this._parent=null,this._parent_ts=Cut._TS++,this},Cut.prototype.empty=function(){var e,t=this._first;while(e=t)t=e._next,e._prev=e._next=e._parent=null;return this._first=this._last=null,this._children_ts=Cut._TS++,this.touch(),this},Cut.prototype.touch=function(){return this._touch_ts=Cut._TS++,this._parent&&this._parent.touch(),this},Cut.prototype.spy=function(e){return arguments.length?(this._spy=e?!0:!1,this):this._spy},Cut.prototype.pin=function(){if(!arguments.length)return this._pin;var e=this._pin.update.apply(this._pin,arguments);return e===this._pin?this:e},Cut.prototype.pinChildren=function(e){return e&&Cut._extend(this._pinAll=this._pinAll||{},e),this._pinAllTicker?this:(this._pinAllTicker=function(){if(this._pinAll_mo==this._children_ts)return;this._pinAll_mo=this._children_ts;var e,t=this.first(!0);while(e=t)t=e.next(!0),e.pin(this._pinAll)},this.tick(this._pinAllTicker,!0),this)},Cut.prototype.matrix=function(){return this._pin.absoluteMatrix(this,this._parent?this._parent._pin:null)},Cut.prototype.tween=function(e,t){return Cut.Tween(this).tween(e,t)},Cut.Tween=function(e){function s(){return i!==r[r.length-1]&&(t=Cut._now(),e.touch(),r.push(i)),i}if(e._tween)return e._tween;var t=0,n={},r=[],i=null;return n.queue=function(e){return this},n.tween=function(e,t){return i={end:{},duration:e||400,delay:t||0},this},n.pin=function(e){var t=s().end;return arguments.length===1?Cut._extend(t,arguments[0]):arguments.length===2&&(t[arguments[0]]=arguments[1]),this},n.then=function(e){return s().then=e,this},n.easing=function(e){return s().easing=e,this},n.clear=function(t){var n;while(n=r.shift())t&&e.pin(n.end);return this},e.tick(function(){if(!r.length)return;this.touch();var n=Cut._now(),i=n-t;if(!i)return;var s=r[0];if(s.delay>0){s.delay-=i,t=n;return}var o=i/s.duration,u=o>=1;o=o>1?1:o,o=s.easing?s.easing(o):o;if(!s.start){s.start={};for(var a in s.end){var f=e.pin(a);s.start[a]=f||0}}for(var a in s.start){var l=s.start[a],c=s.end[a];e.pin(a,l+(c-l)*o)}u&&(r.shift(),t=n,s.then&&s.then.call(e))},!0),e._tween=n},Cut.root=function(e,t){return new Cut.Root(e,t)},Cut.Root=function(e,t){function i(){if(n===!0)return;var s=r._touch_ts;e(r),t(i),s==r._touch_ts&&r.pause()}Cut.String.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;var n=!0,r=this;this.start=function(){return this.resume()},this.pause=function(){return n=!0,this},this.resume=function(e){if(n||e)n=!1,t(i);return this},this.touch=function(){return this.resume(),Cut.prototype.touch.apply(this,arguments)};var s=null;this.viewbox=function(e,t,n){return s={width:e,height:t,mode:typeof n=="undefined"?"in":n},this},this.listen("resize",function(e,t){return s?this.pin({width:s.width,height:s.height,resizeMode:s.mode,resizeWidth:e,resizeHeight:t}):this.pin({width:e,height:t}),!0})},Cut.Root.prototype=new Cut(Cut.Proto),Cut.Root.prototype._super=Cut,Cut.Root.prototype.constructor=Cut.Root,Cut.image=function(e){var t=new Cut.Image;return e&&t.setImage(e),t},Cut.Image=function(){Cut.Image.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return},Cut.Image.prototype=new Cut(Cut.Proto),Cut.Image.prototype._super=Cut,Cut.Image.prototype.constructor=Cut.Image,Cut.Image.prototype.setImage=function(e){return this._outs[0]=Cut.Out.select(e),this.pin({width:this._outs[0]?this._outs[0].width():0,height:this._outs[0]?this._outs[0].height():0}),this},Cut.Image.prototype.cropX=function(e,t){return this.setImage(this._outs[0].cropX(e,t))},Cut.Image.prototype.cropY=function(e,t){return this.setImage(this._outs[0].cropY(e,t))},Cut.anim=function(e,t){var n=(new Cut.Anim).setFrames(e).gotoFrame(0);return t&&n.fps(t),n},Cut.Anim=function(){Cut.Anim.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;this._fps=Cut.Anim.FPS,this._ft=1e3/this._fps,this._time=0,this._frame=0,this._frames=[],this._labels={},this.tick(function(){if(this._time&&this._frames.length>1){var e=+(new Date)-this._time;if(e>=this._ft){var t=e<2*this._ft?1:Math.floor(e/this._ft);this._time+=t*this._ft,this.moveFrame(t),this._repeat&&(this._repeat-=t)<=0&&(this.stop(),this._callback&&this._callback())}this.touch()}},!1)},Cut.Anim.prototype=new Cut(Cut.Proto),Cut.Anim.prototype._super=Cut,Cut.Anim.prototype.constructor=Cut.Anim,Cut.Anim.FPS=22,Cut.Anim.prototype.fps=function(e){return arguments.length?(this._fps=e||Cut.Anim.FPS,this._ft=1e3/this._fps,this):this._fps},Cut.Anim.prototype.setFrames=function(e){this._time=this._time||0,this._frame=0,this._frames=[],this._labels={};var t=Cut.Out.select(e,!0);if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n];this._frames.push(r),this._labels[t[n].name]=n}return this},Cut.Anim.prototype.gotoFrame=function(e,t){return e=Cut.Math.rotate(e,this._frames.length),this._frame=e,t=t||!this._outs[0],this._outs[0]=this._frames[this._frame],t&&this.pin({width:this._outs[0].width(),height:this._outs[0].height()}),this._frame_ts=Cut._TS++,this.touch(),this},Cut.Anim.prototype.randomFrame=function(){return this.gotoFrame(Math.floor(Math.random()*this._frames.length))},Cut.Anim.prototype.moveFrame=function(e){return this.gotoFrame(this._frame+e)},Cut.Anim.prototype.gotoLabel=function(e,t){return this.gotoFrame(this._labels[e]||0,t)},Cut.Anim.prototype.repeat=function(e,t){return this._repeat=e*this._frames.length-1,this._callback=t,this},Cut.Anim.prototype.play=function(e){if(!this._time||e)this._time=+(new Date),this.gotoFrame(0);return this},Cut.Anim.prototype.stop=function(e){return this._time=null,Cut._isNum(e)&&this.gotoFrame(e),this},Cut.string=function(e){return(new Cut.String).setFont(e)},Cut.String=function(){Cut.String.prototype._super.apply(this,arguments);if(arguments[0]===Cut.Proto)return;this.row()},Cut.String.prototype=new Cut(Cut.Proto),Cut.String.prototype._super=Cut,Cut.String.prototype.constructor=Cut.String,Cut.String.prototype.setFont=function(e){return this._font=e,e=e.split(":",2),this.prefix=e.length>1?e[1]:e[0],this},Cut.String.prototype.setValue=function(e){if(this.value===e)return this;this.value=e,e.length||(e+="");var t=this._first;for(var n=0;n<e.length;n++)t=t||Cut.anim(this._font).appendTo(this),t.gotoLabel(this.prefix+e[n],!0).show(),t=t._next;while(t)t.hide(),t=t._next;return this},Cut.row=function(e){return Cut.create().row(e)},Cut.prototype.row=function(e){return this.box("row").pinChildren({alignY:e}),this},Cut.column=function(e){return Cut.create().column(e)},Cut.prototype.column=function(e){return this.box("column").pinChildren({alignX:e}),this},Cut.box=function(e){return(new Cut.create).box()},Cut.prototype.box=function(e){return this._boxTicker?this:(this._padding=0,this.padding=function(e){return this._padding=e,this},this._spacing=0,this.spacing=function(e){return this._spacing=e,this},this._boxTicker=function(){if(this._box_mo==this._touch_ts)return;this._box_mo=this._touch_ts;var t=0,n=0,r,i=this.first(!0),s=!0;while(r=i)i=r.next(!0),r.pin().relativeMatrix(),e=="column"?(!s&&(n+=this._spacing||0),r.pin("offsetY")!=n&&r.pin("offsetY",n),t=Math.max(t,r._pin._boundWidth),n+=r._pin._boundHeight):e=="row"?(!s&&(t+=this._spacing||0),r.pin("offsetX")!=t&&r.pin("offsetX",t),t+=r._pin._boundWidth,n=Math.max(n,r._pin._boundHeight)):(t=Math.max(t,r._pin._boundWidth),n=Math.max(n,r._pin._boundHeight)),s=!1;t+=this._padding*2,n+=this._padding*2,this.pin("width")!=t&&this.pin("width",t),this.pin("height")!=n&&this.pin("height",n)},this.tick(this._boxTicker),this)},Cut.Image.prototype.tile=function(e){function r(e){return n._outs[e]||(n._outs[e]=t.clone())}if(this._tileTicker)return this;var t=null,n=this;return this._tileTicker=function(){if(this._tile_mo==this._touch_ts)return;this._tile_mo=this._touch_ts,t=t||this._outs[0].clone();var n=t.left,i=t.right,s=t.top,o=t.bottom,u=t.width()-n-i,a=t.height()-s-o,f=this.pin("width");f=e?f:f-n-i;var l=this.pin("height");l=e?l:l-s-o;var c=e?-n:0,h=e?-s:0,p=0;s&&n&&r(p++).cropX(n,0).cropY(s,0).offset(c,h),o&&n&&r(p++).cropX(n,0).cropY(o,a+s).offset(c,h+l+s),s&&i&&r(p++).cropX(i,u+n).cropY(s,0).offset(c+f+n,h),o&&i&&r(p++).cropX(i,u+n).cropY(o,a+s).offset(c+f+n,h+l+s);var d=c+n,v=f;while(v>0){var m=Math.min(u,v);v-=u;var g=h+s,y=l;while(y>0){var b=Math.min(a,y);y-=a,r(p++).cropX(m,n).cropY(b,s).offset(d,g),v<0&&(n&&r(p++).cropX(n,0).cropY(b,s).offset(c,g),i&&r(p++).cropX(i,u+n).cropY(b,s).offset(d+m,g)),g+=b}s&&r(p++).cropX(m,n).cropY(s,0).offset(d,h),o&&r(p++).cropX(m,n).cropY(o,a+s).offset(d,g),d+=m}this._outs.length=p},this.tick(this._tileTicker),this},Cut.Image.prototype.stretch=function(e){function r(e){return n._outs[e]||(n._outs[e]=t.clone())}if(this._stretchTicker)return this;var t=null,n=this;return this._stretchTicker=function(){if(this._stretch_mo==this._pin._transform_ts)return;this._stretch_mo=this._pin._transform_ts,t=t||this._outs[0].clone();var n=t.left,i=t.right,s=t.top,o=t.bottom,u=t.width(),a=t.height(),f=this.pin("width"),l=this.pin("height");f=e?f+n+i:Math.max(f,n+i),l=e?l+s+o:Math.max(l,s+o);var c=0;s&&n&&r(c++).cropX(n,0).cropY(s,0).offset(0,0),o&&n&&r(c++).cropX(n,0).cropY(o,a-o).offset(0,l-o),s&&i&&r(c++).cropX(i,u-i).cropY(s,0).offset(f-i,0),o&&i&&r(c++).cropX(i,u-i).cropY(o,a-o).offset(f-i,l-o),s&&r(c++).cropX(u-n-i,n).cropY(s,0).offset(n,0).width(f-n-i),o&&r(c++).cropX(u-n-i,n).cropY(o,a-o).offset(n,l-o).width(f-n-i),n&&r(c++).cropX(n,0).cropY(a-s-o,s).offset(0,s).height(l-s-o),i&&r(c++).cropX(i,u-i).cropY(a-s-o,s).offset(f-i,s).height(l-s-o),r(c++).cropX(u-n-i,n).cropY(a-s-o,s).offset(n,s).width(f-n-i).height(l-s-o),this._outs.length=c},this.tick(this._stretchTicker),this},Cut._images={},Cut.loadImages=function(e,t){function a(){DEBUG&&console.log("Loading image completed."),l()}function f(e){DEBUG&&console.log("Error loading image: "+e),l()}function l(){--n<=0&&t&&t()}var n=0,r=!0,i=Cut._textures;for(var s in i){if(i[s].imagePath){n++;var o=i[s].imagePath,u=e(o,a,f);Cut.addImage(u,o)}r=!1}r&&(DEBUG&&console.log("No image to load."),t&&t())},Cut.getImage=function(e){return Cut._images[e]},Cut.addImage=function(e,t){return Cut._images[t]=e,this},Cut._textures={},Cut.addTexture=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];Cut._textures[t.name]=t,Cut.Out._cache[t.name]={},t.getImage=function(e){return function(){return e._image||(e._image=Cut.getImage(e.imagePath)),e._image}}(t);var n,r=t.cutouts||t.sprites;if(typeof t.filter=="function")for(var i=r.length-1;i>=0;i--)(n=t.filter(r[i]))?r[i]=n:r.splice(i,1);var s=t.ratio||1,o=t.trim||0;for(var i=r.length-1;i>=0;i--)n=r[i],n.x*=s,n.y*=s,n.w*=s,n.h*=s,n.width*=s,n.height*=s,n.top*=s,n.bottom*=s,n.left*=s,n.right*=s,o&&(n.x+=o,n.y+=o,n.w-=2*o,n.h-=2*o,n.width-=2*o,n.height-=2*o,n.top-=o,n.bottom-=o,n.left-=o,n.right-=o)}return this},Cut.Out=function(e,t,n){this.cutout=e,this.name=e.name,this.image=t,this.ratio=n||1,e.w=e.w||e.width,e.h=e.h||e.height,this.sx=e.x*this.ratio,this.sy=e.y*this.ratio,this.sw=e.w*this.ratio,this.sh=e.h*this.ratio,this.dx=0,this.dy=0,this.dw=e.w,this.dh=e.h,this.top=e.top||0,this.bottom=e.bottom||0,this.left=e.left||0,this.right=e.right||0},Cut.Out.prototype.clone=function(){return new Cut.Out(this.cutout,this.image,this.ratio)},Cut.Out.prototype.width=function(e){return arguments.length?(this.dw=e,this):this.dw},Cut.Out.prototype.height=function(e){return arguments.length?(this.dh=e,this):this.dh},Cut.Out.prototype.cropX=function(e,t){return t=t||0,this.sx=(this.cutout.x+t)*this.ratio,this.dw=Math.min(this.cutout.w-t,e),this.sw=this.dw*this.ratio,this},Cut.Out.prototype.cropY=function(e,t){return t=t||0,this.sy=(this.cutout.y+t)*this.ratio,this.dh=Math.min(this.cutout.h-t,e),this.sh=this.dh*this.ratio,this},Cut.Out.prototype.offset=function(e,t){return this.dx=e,this.dy=t,this},Cut.Out.prototype.paste=function(e){Cut._stats.paste++;var t=this.image();try{t&&e.drawImage(t,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)}catch(n){this.failed||console.log("Unable to paste: ",this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh,t),this.failed=!0}},Cut.Out.prototype.toString=function(){return"["+this.name+": "+this.dw+"x"+this.dh+"]"},Cut.Out.drawing=function(e,t,n,r,i){var s=document.createElement("canvas"),o=s.getContext("2d");return s.width=Math.ceil(e*n),s.height=Math.ceil(t*n),typeof n!="number"&&(i=r,r=n,n=1),r(o),i||(i={}),i.x||(i.x=0),i.y||(i.y=0),i.w||i.width||(i.w=e),i.h||i.height||(i.h=t),new Cut.Out(i,function(){return s},n)},Cut.Out._cache={},Cut.Out.select=function(e,t){if(typeof e!="string")return e;e=e.split(":",2);if(e.length<2)throw"Invalid selector: '"+e+"'!";var n=e[0],r=e[1];n=Cut._textures[n];if(n==null)return t?[]:null;var i=n.cutouts||n.sprites;if(!t){var s=Cut.Out._cache[n.name][r+"$"];if(typeof s=="undefined"){for(var o=0;o<i.length;o++)if(i[o].name==r){s=i[o];break}Cut.Out._cache[n.name][r+"$"]=s}if(!s)throw"'"+e+"' cutout not found!";return s?new Cut.Out(s,n.getImage,n.imageRatio):null}var s=Cut.Out._cache[n.name][r+"*"];if(typeof s=="undefined"){s=[];var u=r.length;for(var o=0;o<i.length;o++){var a=i[o];a.name&&a.name.substring(0,u)==r&&s.push(i[o])}Cut.Out._cache[n.name][r+"*"]=s}if(!s.length)throw"'"+e+"' cutout not found!";var f=[];for(var o=0;o<s.length;o++)f.push(new Cut.Out(s[o],n.getImage,n.imageRatio));return f},Cut.Pin=function(){this._owner=null,this._parent=null,this._relativeMatrix=new Cut.Matrix,this._absoluteMatrix=new Cut.Matrix,this._boundMatrix=new Cut.Matrix,this.reset()},Cut.Pin._EMPTY={},Cut.Pin.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewX=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boundX=0,this._boundY=0,this._boundWidth=this._width,this._boundHeight=this._height,this._translate_ts=Cut._TS++,this._transform_ts=Cut._TS++,this._matrix_ts=Cut._TS++},Cut.Pin.prototype.tick=function(e){return this._owner=e,this._parent=e._parent&&e._parent._pin,this._handled&&this._handle_mo!=this._transform_ts&&(this._handle_mo=this._transform_ts,this._translate_ts=Cut._TS++),this._aligned&&this._parent&&this._align_mo!=this._parent._transform_ts&&(this._align_mo=this._parent._transform_ts,this._translate_ts=Cut._TS++),this},Cut.Pin.prototype.toString=function(){return this._owner.id()+" ["+this._alignX+", "+this._alignY+"] ["+this._handleX+", "+this._handleY+"] ["+(this._parent?this._parent._owner.id():null)+"]"},Cut.Pin.prototype.absoluteMatrix=function(){var e=Math.max(this._transform_ts,this._translate_ts,this._parent?this._parent._matrix_ts:0);if(this._abs_mo==e)return this._absoluteMatrix;this._abs_mo=e;var t=this._absoluteMatrix;return t.copyFrom(this.relativeMatrix()),this._parent&&t.concat(this._parent._absoluteMatrix),this._matrix_ts=Cut._TS++,t},Cut.Pin.prototype.relativeMatrix=function(){var e=Math.max(this._transform_ts,this._translate_ts,this._parent?this._parent._transform_ts:0);if(this._rel_mo==e)return this._relativeMatrix;this._rel_mo=e;var t=this._relativeMatrix;return t.identity(),this._pivoted&&t.translate(-this._pivotX*this._width,-this._pivotY*this._height),t.scale(this._scaleX,this._scaleY),t.rotate(this._rotation),t.skew(this._skewX,this._skewX),this._pivoted&&t.translate(this._pivotX*this._width,this._pivotY*this._height),this.boundMatrix(),this._x=this._offsetX-this._boundX,this._y=this._offsetY-this._boundY,this._handled&&(this._x-=this._handleX*this._boundWidth,this._y-=this._handleY*this._boundHeight),this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),t.translate(this._x,this._y),this._relativeMatrix},Cut.Pin.prototype.boundMatrix=function(){if(this._bound_mo==this._transform_ts)return;this._bound_mo=this._transform_ts;if(this._pivoted){this._boundX=0,this._boundY=0,this._boundWidth=this._width,this._boundHeight=this._height;return}var e=this._boundMatrix;e.identity(),e.scale(this._scaleX,this._scaleY),e.rotate(this._rotation),e.skew(this._skewX,this._skewX);var t,n;e.a>0&&e.c>0||e.a<0&&e.c<0?(t=0,n=e.a*this._width+e.c*this._height):(t=e.a*this._width,n=e.c*this._height),this._boundX=Math.min(t,n),this._boundWidth=Math.abs(t-n),e.b>0&&e.d>0||e.b<0&&e.d<0?(t=0,n=e.b*this._width+e.d*this._height):(t=e.b*this._width,n=e.d*this._height),this._boundY=Math.min(t,n),this._boundHeight=Math.abs(t-n)},Cut.Pin.prototype.update=function(){if(arguments.length==1&&typeof arguments[0]=="string")return this["_"+arguments[0]];this._transform_flag=!1,this._translate_flag=!1;if(arguments.length==1&&typeof arguments[0]=="object"){var e=arguments[0],t,n;for(t in e)!Cut.Pin._setters[t]&&!Cut.Pin._setters2[t]&&DEBUG&&console.log("Invalid pin: "+t+"/"+e[t]);ctx=Cut.Pin._setters;for(t in e)n=e[t],(setter=ctx[t])&&(n||n===0)&&setter.call(ctx,this,n,e);ctx=Cut.Pin._setters2;for(t in e)n=e[t],(setter=ctx[t])&&(n||n===0)&&setter.call(ctx,this,n,e)}else if(arguments.length==2&&typeof arguments[0]=="string"){var t=arguments[0],n=arguments[1];(ctx=Cut.Pin._setters)&&(setter=ctx[t])?(n||n===0)&&setter.call(ctx,this,n,Cut.Pin._EMPTY):(ctx=Cut.Pin._setters2)&&(setter=ctx[t])?(n||n===0)&&setter.call(ctx,this,n,Cut.Pin._EMPTY):DEBUG&&console.log("Invalid pin: "+t+"/"+n)}return this._translate_flag&&(this._translate_flag=!1,this._translate_ts=Cut._TS++),this._transform_flag&&(this._transform_flag=!1,this._transform_ts=Cut._TS++),this._owner&&(this._owner._pin_ts=Cut._TS++,this._owner.touch()),this},Cut.Pin._setters={alpha:function(e,t,n){e._alpha=t},textureAlpha:function(e,t,n){e._textureAlpha=t},width:function(e,t,n){e._width_=t,e._width=t,e._transform_flag=!0},height:function(e,t,n){e._height_=t,e._height=t,e._transform_flag=!0},scale:function(e,t,n){e._scaleX=t,e._scaleY=t,e._transform_flag=!0},scaleX:function(e,t,n){e._scaleX=t,e._transform_flag=!0},scaleY:function(e,t,n){e._scaleY=t,e._transform_flag=!0},skew:function(e,t,n){e._skewX=t,e._skewY=t,e._transform_flag=!0},skewX:function(e,t,n){e._skewX=t,e._transform_flag=!0},skewY:function(e,t,n){e._skewY=t,e._transform_flag=!0},rotation:function(e,t,n){e._rotation=t,e._transform_flag=!0},pivot:function(e,t,n){e._pivotX=t,e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},pivotX:function(e,t,n){e._pivotX=t,e._pivoted=!0,e._transform_flag=!0},pivotY:function(e,t,n){e._pivotY=t,e._pivoted=!0,e._transform_flag=!0},offset:function(e,t,n){e._offsetX=t,e._offsetY=t,e._translate_flag=!0},offsetX:function(e,t,n){e._offsetX=t,e._translate_flag=!0},offsetY:function(e,t,n){e._offsetY=t,e._translate_flag=!0},align:function(e,t,n){this.alignX.apply(this,arguments),this.alignY.apply(this,arguments)},alignX:function(e,t,n){e._alignX=t,e._aligned=!0,e._translate_flag=!0,this.handleX(e,t,n)},alignY:function(e,t,n){e._alignY=t,e._aligned=!0,e._translate_flag=!0,this.handleY(e,t,n)},handle:function(e,t,n){this.handleX(e,t,n),this.handleY(e,t,n)},handleX:function(e,t,n){e._handleX=t,e._handled=!0,e._translate_flag=!0},handleY:function(e,t,n){e._handleY=t,e._handled=!0,e._translate_flag=!0}},Cut.Pin._setters2={resizeMode:function(e,t,n){Cut._isNum(n.resizeWidth)&&Cut._isNum(n.resizeHeight)&&(this.resizeWidth(e,n.resizeWidth,n,!0),this.resizeHeight(e,n.resizeHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)),e._width=n.resizeWidth/e._scaleX,e._height=n.resizeHeight/e._scaleY)},resizeWidth:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleX=t/e._width_,e._width=e._width_,e._transform_flag=!0},resizeHeight:function(e,t,n,r){if(n.resizeMode&&!r)return;e._scaleY=t/e._height_,e._height=e._height_,e._transform_flag=!0},scaleMode:function(e,t,n){Cut._isNum(n.scaleWidth)&&Cut._isNum(n.scaleHeight)&&(this.scaleWidth(e,n.scaleWidth,n,!0),this.scaleHeight(e,n.scaleHeight,n,!0),t=="out"?e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY):t=="in"&&(e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY)))},scaleWidth:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleX=t/e._width_,e._transform_flag=!0},scaleHeight:function(e,t,n,r){if(n.scaleMode&&!r)return;e._scaleY=t/e._height_,e._transform_flag=!0}},Cut.Matrix=function(e,t,n,r,i,s){this.changed=!0,this.a=e||1,this.b=t||0,this.c=n||0,this.d=r||1,this.tx=i||0,this.ty=s||0},Cut.Matrix.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.tx+", "+this.ty+"]"},Cut.Matrix.prototype.clone=function(){return new Cut.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},Cut.Matrix.prototype.copyTo=function(e){return e.copyFrom(this),this},Cut.Matrix.prototype.copyFrom=function(e){return this.changed=!0,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},Cut.Matrix.prototype.identity=function(){return this.changed=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Cut.Matrix.prototype.rotate=function(e){if(!e)return this;this.changed=!0;var t=e?Math.cos(e):1,n=e?Math.sin(e):0,r=t*this.a-n*this.b,i=t*this.b+n*this.a,s=t*this.c-n*this.d,o=t*this.d+n*this.c,u=t*this.tx-n*this.ty,a=t*this.ty+n*this.tx;return this.a=r,this.b=i,this.c=s,this.d=o,this.tx=u,this.ty=a,this},Cut.Matrix.prototype.translate=function(e,t){return!e&&!t?this:(this.changed=!0,this.tx+=e,this.ty+=t,this)},Cut.Matrix.prototype.scale=function(e,t){return!(e-1)&&!(t-1)?this:(this.changed=!0,this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.tx*=e,this.ty*=t,this)},Cut.Matrix.prototype.skew=function(e,t){return!e&&!t?this:(this.changed=!0,this.a+=this.b*t,this.d+=this.c*e,this.b+=this.a*e,this.c+=this.d*t,this.tx+=this.ty*t,this.ty+=this.tx*e,this)},Cut.Matrix.prototype.concat=function(e){this.changed=!0;var t=this.a*e.a+this.b*e.c,n=this.b*e.d+this.a*e.b,r=this.c*e.a+this.d*e.c,i=this.d*e.d+this.c*e.b,s=this.tx*e.a+e.tx+this.ty*e.c,o=this.ty*e.d+e.ty+this.tx*e.b;return this.a=t,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o,this},Cut.Matrix.prototype.reverse=function(){if(this.changed){this.changed=!1,this.reversed=this.reversed||new Cut.Matrix;var e=this.a*this.d-this.b*this.c;this.reversed.a=this.d/e,this.reversed.b=-this.b/e,this.reversed.c=-this.c/e,this.reversed.d=this.a/e,this.reversed.tx=(this.c*this.ty-this.tx*this.d)/e,this.reversed.ty=(this.tx*this.b-this.a*this.ty)/e}return this.reversed},Cut.Matrix.prototype.map=function(e,t){return t=t||{},t.x=this.a*e.x+this.c*e.y+this.tx,t.y=this.b*e.x+this.d*e.y+this.ty,t},Cut.Matrix.prototype.mapX=function(e,t){return this.a*e+this.c*t+this.tx},Cut.Matrix.prototype.mapY=function(e,t){return this.b*e+this.d*t+this.ty},Cut.Math={},Cut.Math.random=function(e,t){return arguments.length==0?(t=1,e=0):arguments.length==1&&(t=e,e=0),e==t?e:Math.random()*(t-e)+e},Cut.Math.rotate=function(e,t,n){return arguments.length<3&&(n=t||0,t=0),n>t?(e=(e-t)%(n-t),e+(e<0?n:t)):(e=(e-n)%(t-n),e+(e<=0?t:n))},Cut.Math.length=function(e,t){return Math.sqrt(e*e+t*t)},Cut._TS=0,Cut._isNum=function(e){return typeof e=="number"},Cut._isFunc=function(e){return typeof e=="function"},Cut._isArray="isArray"in Array?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},Cut._extend=function(e,t,n){if(n)for(var r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}else for(var i in t)e[i]=t[i];return e},Cut._now=function(){return typeof performance!="undefined"&&performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return+(new Date)}}(),define("cut-core",function(){}),DEBUG=!0,Cut.Mouse={CLICK:"click",START:"touchstart mousedown",MOVE:"touchmove mousemove",END:"touchend mouseup"},Cut.Mouse.subscribe=function(e,t,n){function h(e){g(e,t),DEBUG&&console.log("Mouse Start: "+e.type+" "+f),!n&&t.addEventListener(o,d),e.preventDefault(),m(e.type,e),c.x=f.x,c.y=f.y,c.state=1}function p(e){try{DEBUG&&console.log("Mouse End: "+e.type+" "+f),!n&&t.removeEventListener(o,d),e.preventDefault(),m(e.type,e),c.state==1&&c.x==f.x&&c.y==f.y?(DEBUG&&console.log("Mouse Click [+]"),m("click",e),c.state=2):c.state=0}catch(r){console&&console.log(r)}}function d(e){try{g(e,t),e.preventDefault(),m(e.type,e)}catch(n){console&&console.log(n)}}function v(e){try{g(e,t),DEBUG&&console.log("Mouse Click: "+e.type+" "+f),e.preventDefault(),c.state!=2?m(e.type,e):DEBUG&&console.log("Mouse Click [-]")}catch(n){console&&console.log(n)}}function m(t,n){f.type=t,f.event=n,l.x=f.x,l.y=f.y,e.visit(a)}function g(t,n){var r=!1;if(t.touches){if(!t.touches.length)return;r=!0,f.x=t.touches[0].pageX,f.y=t.touches[0].pageY}else f.x=t.clientX,f.y=t.clientY,!document.body.scrollLeft&&!document.body.scrollTop&&document.documentElement&&(f.x+=document.documentElement.scrollLeft,f.y+=document.documentElement.scrollTop);f.x-=n.clientLeft||0,f.y-=n.clientTop||0;var i=n;while(i)f.x-=i.offsetLeft||0,f.y-=i.offsetTop||0,r||(f.x+=i.scrollLeft||0,f.y+=i.scrollTop||0),i=i.offsetParent;f.x*=e.ratio||1,f.y*=e.ratio||1}t=t||document;var r="ontouchstart"in window,i="click",s=r?"touchstart":"mousedown",o=r?"touchmove":"mousemove",u=r?"touchend":"mouseup";t.addEventListener(i,v),t.addEventListener(s,h),t.addEventListener(u,p),n&&t.addEventListener(o,d);var a=null,f={x:0,y:0,toString:function(){return(this.x|0)+"x"+(this.y|0)}},l={x:0,y:0,toString:function(){return f+" / "+(this.x|0)+"x"+(this.y|0)}},c={x:0,y:0,state:0};a={reverse:!0,visible:!0,start:function(e){if(!e.spy()){e.matrix().reverse().map(f,l);if(l.x<0||l.x>e._pin._width||l.y<0||l.y>e._pin._height)return!0}},end:function(e){var t=e.listeners(f.type);if(t){e.matrix().reverse().map(f,l);for(var n=0;n<t.length;n++)if(t[n].call(e,f.event,l))return!0}}}},define("cut-mouse",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,window.addEventListener("load",function(){DEBUG&&console.log("On load."),Cut.Loader.start()},!1),Cut.Loader={start:function(){if(this.started)return;this.started=!0,Cut.Loader.play()},play:function(){this.played=!0;for(var e=this.loaders.length-1;e>=0;e--)this.roots.push(this.loaders[e]()),this.loaders.splice(e,1)},pause:function(){for(var e=this.loaders.length-1;e>=0;e--)this.roots[e].pause()},resume:function(){for(var e=this.loaders.length-1;e>=0;e--)this.roots[e].resume()},loaders:[],roots:[],load:function(e,t){function n(){function f(){DEBUG&&console.log("Images loaded."),n=t.getContext("2d");var r=window.devicePixelRatio||1,i=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;o=r/i,t.resize=l,DEBUG&&console.log("Loading..."),e(u,t),l(),window.addEventListener("resize",l,!1),DEBUG&&console.log("Start playing..."),u.start()}function l(){r?(i=window.innerWidth>0?window.innerWidth:screen.width,s=window.innerHeight>0?window.innerHeight:screen.height,t.style.width=i+"px",t.style.height=s+"px"):(i=t.clientWidth,s=t.clientHeight),i*=o,s*=o,t.width=i,t.height=s,u.ratio=o,DEBUG&&console.log("Resize: "+i+" x "+s+" / "+o),u.visit({start:function(e){var t=!0,n=e.listeners("resize");if(n)for(var r=0;r<n.length;r++)t&=!n[r].call(e,i,s);return t}})}var n=null,r=!1,i=0,s=0,o=1;DEBUG&&console.log("Creating root...");var u=Cut.root(function(e){n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,i,s),e.render(n)},requestAnimationFrame);t||(t=document.getElementById("cutjs"));if(!t){r=!0,DEBUG&&console.log("Creating element..."),t=document.createElement("canvas"),t.style.position="absolute";var a=document.body;a.insertBefore(t,a.firstChild)}return DEBUG&&console.log("Loading images..."),Cut.loadImages(function(e,t,n){var r=new Image;return DEBUG&&console.log("Loading image: "+e),r.onload=t,r.onerror=n,r.src=e,r},f),u}this.played?this.roots.push(n()):this.loaders.push(n)}},!function(){var e=["ms","moz","webkit","o"];for(var t=0;t<e.length&&!window.requestAnimationFrame;t++){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var t=(new Date).getTime();return r=Math.max(r+16,t),window.setTimeout(function(){e(r)},r-t)}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("cut-loader",function(){}),Cut.addTexture({name:"bg",imagePath:"media/graphics/bg.png",sprites:[{name:"full",x:0,y:0,width:512,height:512}]},{name:"hex",imagePath:"media/graphics/hex.png",imageRatio:4,sprites:[{name:"c_r",x:0,y:0,width:30,height:30},{name:"c_g",x:30,y:0,width:30,height:30},{name:"c_b",x:60,y:0,width:30,height:30},{name:"c_y",x:90,y:0,width:30,height:30},{name:"c_p",x:120,y:0,width:30,height:30},{name:"c_x",x:150,y:0,width:30,height:30},{name:"cell",x:180,y:0,width:30,height:30},{name:"back",x:5,y:55,width:40,height:40},{name:"reset_white",x:55,y:55,width:40,height:40},{name:"reset_black",x:105,y:55,width:40,height:40},{name:"mode_1",x:0,y:94,width:150,height:62},{name:"mode_2",x:0,y:154,width:150,height:62},{name:"mode_3",x:0,y:214,width:150,height:62},{name:"logo",x:0,y:295,width:100,height:60},{name:"star",x:0,y:433,width:18,height:15},{name:"star.fill",x:20,y:433,width:18,height:15},{name:"num_0",x:0,y:403,width:11,height:15},{name:"num_1",x:20,y:403,width:11,height:15},{name:"num_2",x:40,y:403,width:13,height:15},{name:"num_3",x:60,y:403,width:11.5,height:15},{name:"num_4",x:80,y:403,width:12.5,height:15},{name:"num_5",x:100,y:403,width:12,height:15},{name:"num_6",x:120,y:403,width:12,height:15},{name:"num_7",x:140,y:403,width:15,height:15},{name:"num_8",x:160,y:403,width:11,height:15},{name:"num_9",x:180,y:403,width:10,height:15},{name:"num_-",x:200,y:403,width:11,height:15},{name:"num_+",x:220,y:403,width:10,height:15},{name:"num_:",x:240,y:403,width:6,height:15},{name:"space",x:507,y:507,width:5,height:5}]}),define("textures",function(){}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),define("polyfills",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console,Hex._colors=["y","b","r","g","p"],Hex._color_x="x",Hex._ij=[[-1,0],[0,-1],[1,-1],[1,0],[0,1],[-1,1]].map(function(e){return{i:e[0],j:e[1]}}),Hex._xy=_.range(6).map(function(e){var t=(e+.5)*Math.PI/3;return{x:Math.cos(t),y:Math.sin(t)}}),Hex._dir=function(e){return e>=6?e%6:e<0?e%6+6:e},Hex._dirOfXY=function(e,t){var n=Math.round(Math.atan2(t,e)*3/Math.PI-.5);return Hex._dir(n)},Hex._xOfIJ=function(e,t){return e*Math.sin(Math.PI/3)},Hex._yOfIJ=function(e,t){return t+e/2},Hex.prototype.init=function(e,t){DEBUG&&console.log("Hex.init");switch(this.mode=e||this.mode||1){case 1:this.play=new FlipMode,t=t||4;break;case 2:this.play=new SlideMode,t=t||3;break;case 3:this.play=new MoveMode,t=t||4}this.height=Math.max(4,t)*2-1,this.width=this.height*Math.sin(Math.PI/3),this.destroy(),this.keyCells={},this.cells=[],this.make(t),this.halted=!1,this.status=this.status||new Status,this.status.hex=this,this.status.init(),this.play.hex=this,this.play.init(!e)},Hex.prototype.make=function(e){DEBUG&&console.log("Hex.make");var t=[this.cellAt(0,0,!0)],n=[];_.range(e-1).forEach(function(){t.forEach(function(e){Hex._ij.forEach(function(t){var r=e.i+t.i,i=e.j+t.j;this.cellAt(r,i)||n.push(this.cellAt(r,i,!0))},this)},this),t=n},this)},Hex.prototype.halt=function(){return DEBUG&&console.log("Hex.halt"),this.halted=!0,this},Hex.prototype.destroy=function(){return DEBUG&&console.log("Hex.destroy"),this.status&&this.status.reset(),this.cells&&this.cells.forEach(function(e){e.remove()}),this},Hex.prototype.clear=function(){return DEBUG&&console.log("Hex.clear"),this.cells&&this.cells.forEach(function(e){e.hide(),e.dropBit(!0)}),this},Hex._save_keys={score:1,i:1,j:1,bit:1,color:1},Hex.prototype.highScore=function(e,t){if(!(mode=this.mode))return null;try{var n=null;try{n=JSON.parse(localStorage.getItem("highscores"))}catch(r){}return n=n||{},n[mode]=n[mode]||[],_.isNumber(e)&&(n[mode].push({name:t||"",score:e}),n[mode]=_.sortBy(n[mode],"score").reverse(),n[mode].length=Math.min(n[mode].length,10),DEBUG&&console.log(JSON.stringify(n)),localStorage.setItem("highscores",JSON.stringify(n))),n[mode]}catch(r){console.log(r)}return[]},Hex.prototype.loadGame=function(e){DEBUG&&console.log("Hex.loadGame",e);try{var t=localStorage.getItem(e);return t?(t=JSON.parse(t),this.status.setScore(t._status.score),t._cells.forEach(function(e){var t=this.cellAt(e.i,e.j,!0);e.bit&&t.newBit(e.bit.color)},this),t._queue&&(this.queue=t._queue),!0):!1}catch(n){console.log(n)}return!1},Hex.prototype.saveGame=function(e){DEBUG&&console.log("Hex.saveGame",e);try{var t={};t._status=this.status,t._cells=this.cells,this.queue&&(t._queue=this.queue),t=JSON.stringify(t,function(e,t){return e===""?t:_.isNumber(e)||/\d+/.test(e)?t:e[0]=="_"?t:Hex._save_keys[e]?t:undefined}),localStorage.setItem(e,t)}catch(n){console.log(n)}},Hex.prototype.dropGame=function(e){DEBUG&&console.log("Hex.dropGame",e),localStorage.setItem(e,"")},Hex.prototype.cellAt=function(e,t,n){var r=e+"-"+t,i=this.keyCells[r];return i||!n?i:(i=(new Cell(e,t,Hex._xOfIJ(e,t),Hex._yOfIJ(e,t),r)).init(this),this.cells.push(i),this.keyCells[r]=i)},Hex.prototype.nearestCell=function(e,t,n){n=n||1;var r=e-n,i=e+n,s=t-n,o=t+n,u=n*n,a=null;return this.cells.forEach(function(n){if(r<=n.x&&n.x<=i&&s<=n.y&&n.y<=o){var f=n.x-e,l=n.y-t,c=f*f+l*l;c<u&&(u=c,a=n)}}),a},Hex.prototype.findPath=function(e,t){var n=+(new Date),r=[e];while(r.length){var i=r.shift();i.flag=n;if(this.connectedCells(i).some(function(e){return e==t?!0:(!e.bit&&e.flag!=n&&(e.flag=n,r.push(e)),!1)}))return!0}return!1},Hex.prototype.connectedCells=function(e){var t=[];return Hex._ij.forEach(function(n){(cell=this.cellAt(e.i+n.i,e.j+n.j))&&t.push(cell)},this),t},Hex.prototype.rowCells=function(e,t){var n=Hex._ij[Hex._dir(t)],r=[e],i;for(var s=1;i=this.cellAt(e.i+s*n.i,e.j+s*n.j);s++)r.push(i);for(var s=-1;i=this.cellAt(e.i+s*n.i,e.j+s*n.j);s--)r.unshift(i);return r},Hex.prototype.bitCells=function(e){var t=[];return this.cells.forEach(function(n){(e&&!n.bit||!e&&n.bit)&&t.push(n)}),t},Hex.prototype.fillSome=function(e,t){if(this.halted)return;var n;t&&this.queue&&this.queue.length?n=this.queue:n=_.range(e).map(function(){return Hex._colors.sample()});var r=0,i=this.bitCells(!0);return i.sample(n.length).forEach(function(e,t){r++,e.newBit(n[t])}),t?(this.queue=_.range(e).map(function(){return Hex._colors.sample()}),this.onQueue(this.queue)):this.queue=null,r},Hex.prototype.fillUp=function(e){if(this.halted)return;this.cells.forEach(function(t){t.bit||t.newBit(e)})},Hex.prototype.rotateRow=function(e,t,n,r){if(this.halted)return;if(!n)return;n<0&&(t=(t+3)%6,n=-n);var i=this.rowCells(e,t);for(var s=0;s<n;s++){var o=i[0],u=o.dropBit();for(var a=1;a<i.length;a++){var f=i[a];o.drawBit(f),o=f}o.setBit(u)}},Hex.prototype.compact=function(e){if(this.halted)return;var t=Hex._ij[Hex._dir(e)],n=this.bitCells(!0),r=!0;while(r){r=!1;for(var i=0;i<n.length;i++){var s=n[i],o=this.cellAt(s.i+t.i,s.j+t.j);o&&o.bit&&(s.drawBit(o),n[i]=o,r=!0)}}},Hex.prototype.flipBack=function(e,t,n){if(this.halted)return;t=t||[];var r=this,i=function(){r.connectedCells(e).forEach(function(e){r.flipBack(e,t,n)})};return e.colored()?n?n==e.bit.color?(e.dropBit(!0,!0),t.push(e),i(),t.length):0:(n=e.bit.color,e.dropBit(!0,!0),t.push(e),i(),t.length>1?t.length:(t.forEach(function(e){e.newBit(Hex._color_x)}),-t.length)):0},Hex.prototype.removeRow=function(e){if(this.halted)return;var t=[],n=this;this.cells.forEach(function(r){r.colored()&&Hex._ij.forEach(function(i){var s=[r];for(var o=1;o<e;o++){var u=n.cellAt(r.i+o*i.i,r.j+o*i.j);if(!u||!u.bit||u.bit.color!=r.bit.color)break;s.push(u)}s.length>=e&&t.push(s)})});var r=0;return t.forEach(function(e){e.forEach(function(e){e.dropBit(!0,!0)&&r++})}),r},Hex.prototype.mousedown=function(e){!this.halted&&this.play.mousedown(e)},Hex.prototype.mousemove=function(e){!this.halted&&this.play.mousemove(e)},Hex.prototype.mouseup=function(e){!this.halted&&this.play.mouseup(e)},Hex.prototype.click=function(e){!this.halted&&this.play.click(e)},Hex.prototype.onQueue=function(e){},PlayMode.prototype.init=function(){(function(){this.hex.fillUp()}).bind(this).delay(150)},PlayMode.prototype.mousedown=function(e){},PlayMode.prototype.mousemove=function(e){},PlayMode.prototype.mouseup=function(e){},PlayMode.prototype.click=function(e){},FlipMode.prototype=new PlayMode,FlipMode.prototype._super=PlayMode,FlipMode.prototype.constructor=FlipMode,FlipMode.prototype.init=function(){FlipMode.prototype._super.prototype.init.call(this),this.hex.status.setTimeout(6e4,this.finish.bind(this))},FlipMode.prototype.finish=function(e){this.hex.halt(),this.hex.clear(),this.hex.status.addScore(0),this.hex.highScore(this.hex.status.score),this.hex.status.timeover()},FlipMode.prototype.mousedown=function(e){var t=this.hex.nearestCell(e.x,e.y);if(!t)return;var n=this.hex.flipBack(t);n*=n<0?10:1,this.hex.status.addScore(n),function(){this.hex.compact(1)}.bind(this).delay(50),function(){this.hex.fillUp()}.bind(this).delay(150)},MoveMode.prototype=new PlayMode,MoveMode.prototype._super=PlayMode,MoveMode.prototype.constructor=MoveMode,MoveMode.prototype.init=function(e){this.hex.cells.forEach(function(e){e.show()});if(e)this.hex.dropGame(this.key);else if(this.hex.loadGame(this.key)){this.hex.onQueue(this.hex.queue);return}this.refresh()},MoveMode.prototype.finish=function(){this.hex.halt(),this.hex.clear(),this.hex.status.addScore(0),this.hex.highScore(this.hex.status.score),this.hex.dropGame(this.key),this.hex.status.gameover()},MoveMode.prototype.mousedown=function(e){var t=this.hex.nearestCell(e.x,e.y);t?t.bit&&(this.src?this.src!=t&&(this.src.deselect(),this.src=t,this.src.select()):(this.src=t,this.src.select())):this.src&&(this.src.deselect(),this.src=null)},MoveMode.prototype.mouseup=function(e){var t=this.hex.nearestCell(e.x,e.y);t&&!t.bit&&this.src&&(this.src.deselect(),t.setBit(this.src.dropBit()),function(){this.refresh(!0)}.bind(this).delay(200),this.src=null)},MoveMode.prototype.refresh=function(e){var t=this.hex.removeRow(this.n);this.hex.status.addScore(t);var n=this.hex.bitCells().length;n==this.hex.cells.length?this.finish.bind(this).delay(500):e&&!t||!n?function(){var e=this.hex.status.score;e<60?e=3:e<120?e=4:e<240?e=5:e<420?e=6:e<720?e=7:e=8,this.hex.fillSome(e,!0),this.refresh.bind(this).delay(400)}.bind(this).delay(t?300:0):this.hex.saveGame(this.key)},SlideMode.prototype=new PlayMode,SlideMode.prototype._super=PlayMode,SlideMode.prototype.constructor=SlideMode,SlideMode.prototype.init=function(){SlideMode.prototype._super.prototype.init.call(this),this.hex.status.setTimeout(6e4,this.finish.bind(this))},SlideMode.prototype.finish=function(){this.hex.halt(),this.hex.clear(),this.hex.status.addScore(0),this.hex.highScore(this.hex.status.score),this.hex.status.timeover()},SlideMode.prototype.mousedown=function(e){this.point_down=e;var t=this.hex.nearestCell(e.x,e.y);if(!t)return;this.cell_down=t,this.dir=null},SlideMode.prototype.mousemove=function(e){if(!this.cell_down)return;var t=e.x-this.point_down.x,n=e.y-this.point_down.y;this.dir==null&&t*t+n*n>=.25&&(this.dir=Hex._dirOfXY(t,n),this.dist=0);if(this.dir!=null){var r=Hex._xy[this.dir].x*t+Hex._xy[this.dir].y*n,i=r-this.dist,s=Math.round(i);i-=Math.round(i),this.dist=this.dist+s,this.hex.rotateRow(this.cell_down,this.dir,s,i)}},SlideMode.prototype.mouseup=function(e){if(!this.cell_down)return;this.refresh()},SlideMode.prototype.refresh=function(){var e=this.dist?this.hex.removeRow(this.n):0;e?(this.hex.status.addScore(e,!this.cell_down),function(){this.hex.fillUp(),this.refresh.bind(this).delay(200)}.bind(this).delay(300)):this.dir!=null&&this.hex.rotateRow(this.cell_down,this.dir,-this.dist),this.cell_down=null,this.dir=null},Cell.prototype.init=function(e){return this.hex=e,this.onInit(),this},Cell.prototype.show=function(){return this.onView(),this},Cell.prototype.hide=function(){return this.onHide(),this},Cell.prototype.remove=function(e){return this.dropBit(!0,e),this.onRemove(),this},Cell.prototype.newBit=function(e){e=e||Hex._colors.sample(),this.setBit((new Bit(e)).init(this.hex))},Cell.prototype.setBit=function(e){this.bit=e;if(!this.bit)return;this.bit.jump(this.x,this.y)},Cell.prototype.drawBit=function(e){this.bit=e.dropBit();if(!this.bit)return;this.bit.walk(this.x,this.y)},Cell.prototype.dropBit=function(e,t){if(!this.bit)return null;var n=this.bit;return this.bit=null,e&&n.remove(t),n},Cell.prototype.select=function(){return this.bit&&this.bit.select(),this},Cell.prototype.deselect=function(){return this.bit&&this.bit.deselect(),this},Cell.prototype.colored=function(){return this.bit&&this.bit.color&&this.bit.color!=Hex._color_x},Bit.prototype.init=function(e){return this.hex=e,this.onInit(),this},Bit.prototype.jump=function(e,t){return this.onJump(e,t),this},Bit.prototype.walk=function(e,t){return this.onWalk(e,t),this},Bit.prototype.remove=function(e){return this.onRemove(e),this},Bit.prototype.select=function(){return this.onSelect(),this},Bit.prototype.deselect=function(){return this.onDeselect(),this},Status.prototype.reset=function(){return this.highscores=this.topscore=0,this.score=this.scoreAdded=0,this.start=this.stop=this.time=null,this.timer&&window.clearTimeout(this.timer),this.timeout&&window.clearTimeout(this.timeout),this.timeoutCallback=null,this.onUpdate(),this},Status.prototype.init=function(){return this.onInit(),this.reset(),this.highscores=this.hex.highScore(),this.topscore=this.highscores.length>0?this.highscores[0].score:0,this.onStart(),this},Status.prototype.setScore=function(e){return this.score=e,this.onUpdate(),this},Status.prototype.addScore=function(e,t){return this.score+=e,this.scoreAdded=t?this.scoreAdded+e:e,this.onUpdate(),this},Status.prototype.startTimer=function(){return this.start=+(new Date),this.runTimer(),this},Status.prototype.stopTimer=function(){return this.stop=+(new Date),this.timer&&window.clearTimeout(this.timer),this},Status.prototype.runTimer=function(){return this.time=Math.max(0,+(new Date)-this.start),this.onUpdate(),this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(this.runTimer.bind(this),500),this},Status.prototype.showTimer=function(){this.time=Math.max(0,+(new Date)-this.start),this.onUpdate()},Status.prototype.setTimeout=function(e,t){return this.start=+(new Date),this.stop=this.start+e,this.runTimeout(),this.timeoutCallback=t,this},Status.prototype.addTimeout=function(e){return this.stop=this.stop+e,this},Status.prototype.runTimeout=function(){return this.time=Math.max(0,this.stop- +(new Date)),this.onUpdate(),this.time>0?this.timeout=window.setTimeout(this.runTimeout.bind(this),500):this.timeoutCallback&&this.timeoutCallback(),this},Status.prototype.timeover=function(){this.onTimeover()},Status.prototype.gameover=function(){this.onGameover()},Array.prototype.sample=function(e){if(!_.isNumber(e)||!e)return this[Math.floor(Math.random()*this.length)];e=Math.min(e,this.length);var t=this.slice(0),n=[];for(var r=0;r<e;r++)n.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);return n},Array.prototype.at=function(e){return e=this.length>1?e%this.length:0,e=e<0?e+this.length:e,this[e]},Function.prototype.delay=function(e){return _(this).delay(e)},define("game",function(){}),DEBUG=(typeof DEBUG=="undefined"||DEBUG)&&console;var _width=200,_height=300,_cell_space=29,_widthMax=600,_heightMax=650,_boardWidthMax=350,_boardHeightMax=500,_boardWidth=.85,_boardHeight=.72,_ratio=1;Cut.Loader.load(function(e){return Cut.Mouse.subscribe(e),(new App).appendTo(e)}),App.prototype=new Cut,App.prototype._super=Cut,App.prototype.constructor=App,App.prototype.openHome=function(){this.home.open(),this.play.close()},App.prototype.openPlay=function(e){this.home.close(),this.play.open(e)},Home.prototype=new Cut,Home.prototype._super=Cut,Home.prototype.constructor=Home,Home.prototype.open=function(){if(!this.visible())for(var e=0;e<this.buttons.length;e++)this.buttons[e].pin("pivot",.5).tween(250,e*70).clear().pin({scaleX:1.1}).tween(250).pin({scaleX:1});this.show()},Home.prototype.close=function(e){this.hide()},Play.prototype=new Cut,Play.prototype._super=Cut,Play.prototype.constructor=Play,Play.prototype.open=function(e){this.show(),this.queue.hide(),this.board.open(e)},Play.prototype.close=function(e){this.hide(),this.board&&this.board.close()},Board.prototype=new Cut,Board.prototype._super=Cut,Board.prototype.constructor=Board,Board.prototype.open=function(e){this.hex.init(e),this.show(),this.resize()},Board.prototype.resize=function(e,t){e&&t?(this.widthMax=_boardWidthMax*_ratio/this.play.game.box.pin("scaleX"),this.heightMax=_boardHeightMax*_ratio/this.play.game.box.pin("scaleY"),this.widthMax=Math.min(e*_boardWidth,this.widthMax),this.heightMax=Math.min(t*_boardHeight,this.heightMax)):this.pin({width:this.hex.width*_cell_space,height:this.hex.height*_cell_space,scaleMode:"in",scaleWidth:this.widthMax,scaleHeight:this.heightMax})},Board.prototype.close=function(){this.hide(),this.hex.destroy()},Board.prototype.backwardPoint=function(e){return{x:e.x/_cell_space,y:e.y/_cell_space}},Board.prototype.forwardX=function(e,t){return(e-.5)*_cell_space},Board.prototype.forwardY=function(e,t){return(t-.5)*_cell_space},Hex.prototype.onQueue=function(e){this.ui.queue.setValue(e.join("")).show()},Cell.prototype.onInit=function(){if(!this.ui){var e=this.hex.ui.board;this.ui=Cut.image("hex:cell").appendTo(e).hide().pin({offsetX:e.forwardX(this.x,this.y),offsetY:e.forwardY(this.x,this.y)})}},Cell.prototype.onView=function(){this.ui&&this.ui.show()},Cell.prototype.onHide=function(){this.ui&&this.ui.hide()},Cell.prototype.onRemove=function(){this.ui&&(this.ui.remove(),this.ui=null)},Bit.prototype.pin=function(e,t){var n=this.hex.ui.board,r={};return arguments.length==2&&(r.offsetX=n.forwardX(e,t),r.offsetY=n.forwardY(e,t)),r.scaleX=r.scaleY=this.alpha*(1-this.selected/5),r},Bit.prototype.onInit=function(){this.ui||(this.ui=Cut.image("hex:c_"+this.color).pin("pivot",.5)),this.ui.appendTo(this.hex.ui.board),this.alpha=0,this.selected=0,this.ui.pin(this.pin())},Bit.prototype.onJump=function(e,t){this.alpha=0,this.ui.pin(this.pin(e,t)),this.alpha=1,this.ui.tween(100).clear().pin(this.pin())},Bit.prototype.onWalk=function(e,t){this.alpha=1,this.ui.tween(100).clear().pin(this.pin(e,t))},Bit.prototype.onSelect=function(){this.selected=1,this.ui.tween(100).pin(this.pin())},Bit.prototype.onDeselect=function(){this.selected=0,this.ui.tween(100).pin(this.pin())},Bit.prototype.onRemove=function(e){if(!this.ui)return;this.alpha=0,e?this.ui.tween(50).pin(this.pin()).then(this.ui.remove):this.ui.remove()},Status.prototype.onInit=function(){if(this.ui)return;this.ui=this.hex.ui},Status.prototype.onUpdate=function(){if(!this.ui)return;this.ui.score.setValue(this.score),this.scoreAdded?this.ui.scoreAdded.setValue(pSign(this.scoreAdded)).show():this.ui.scoreAdded.hide();if(this.time!=null&&this.time>=0){var e=Math.floor(this.time/1e3),t=e%60,n=(e-t)/60;this.ui.timeout.setValue(n+":"+("0"+t).slice(-2)).show()}else this.ui.timeout.hide()},Status.prototype.onStart=function(){this.ui.reset.stop(0),this.ui.myscore.hide();var e=this.topscore;e?(this.ui.topnumb.setValue(e),this.ui.topscore.show()):this.ui.topscore.hide()},Status.prototype.onTimeover=function(){this.ui.reset.play(!0);var e=this.score,t=this.topscore;this.ui.mynumb.setValue(e),e>0&&(!t||e>t)?this.ui.mystar.show():this.ui.mystar.hide(),this.ui.myscore.show()},Status.prototype.onGameover=function(){this.onTimeover()},define("app",function(){}),requirejs.config({paths:{def:"def.dev","cut-core":"bower_components/cutjs/cut-core","cut-mouse":"bower_components/cutjs/cut-mouse","cut-loader":"bower_components/cutjs/cut-loader",underscore:"bower_components/underscore/underscore",domReady:"bower_components/requirejs-domready/domReady"},shim:{app:{deps:["cut-core","cut-core","cut-mouse","cut-loader","polyfills","game"]},"cut-core":{exports:"Cut"},"cut-mouse":{deps:["cut-core"]},"cut-loader":{deps:["cut-core"]},textures:{deps:["cut-core"]},game:{deps:["underscore","polyfills"]},underscore:{exports:"_"}}}),require(["domReady","def","underscore","cut-core","cut-mouse","cut-loader","textures","polyfills","game","app"],function(e){e(function(){Cut.Loader.start()})}),define("required",function(){});