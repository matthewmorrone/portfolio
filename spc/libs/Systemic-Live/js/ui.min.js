function uialert(text,container,delay){var alertDiv=$('<div class="alert alert-warning alert-dismissable">'+text+'<button type="button" class="close" data-dismiss="alert">&times;</button>');container=container||".container",delay=delay||400,$(container).prepend(alertDiv),_.delay(function(){delay>0&&$(alertDiv).hide(400,function(){$(alertDiv).remove()})},3e3)}function about(sys){$("#about-star").html("Loading information..."),$.get("star.php?star="+encodeURIComponent(sys),function(data){$("#about-star").html(data)})}SYSTEMIC_PARAMETERS=location.search,$(document).ready(function(){$(".combobox").select2({width:"300"}),$("#systems").click(function(){$("#rv").click(),_.defer(function(){K.loadSys($("#systems").val()),about($("#systems").val())})}),$("#optimize").click(function(){K.optimize()});var rvtooltip=function(){var pt=K.getRVPlot();if("#rv"==pt||"#res"==pt){var d=JDtoDateArray(this.x);return'<span style="color:'+this.series.color+'">'+this.series.name.replace("datafiles/","")+"</span><br>Date: <strong>"+d[0]+"/"+d[1]+"/"+d[2]+"</strong><br>Julian Date: <strong>"+this.x.toFixed(2)+"</strong><br>RV Value: <strong>"+this.y.toFixed(2)+" m/s</strong>"}return"#dynamical"==pt?'<span style="color:'+this.series.color+'">'+this.series.name+"</span><br>Time: <strong>"+this.x.toFixed(2)+"</strong> years<br>Value: <strong>"+this.y.toFixed(4)+"</strong>":!1};$("#rvplot").highcharts({chart:{type:"scatter",zoomType:"xy"},tooltip:{enabled:!0,formatter:rvtooltip},legend:{useHTML:!0},title:{enabled:!1,text:""},xAxis:{title:{enabled:!0,text:"Time [Julian Days]"}},yAxis:{title:{enabled:!0,text:"Radial velocity [m/s]"}},series:[{color:COLORS[0],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:COLORS[1],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:COLORS[2],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:COLORS[3],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:COLORS[4],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:COLORS[5],name:"",marker:{symbol:"circle"},visible:!1,showInLegend:!1},{color:"black",type:"line",name:"RV signal",showInLegend:!1,marker:{enabled:!1},turboThreshold:1,shadow:!1,stickyTracking:!1,tooltip:null,enableMouseTracking:!1},{color:COLORS[0],name:"Planet 1",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}},{color:COLORS[1],name:"Planet 2",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}},{color:COLORS[2],name:"Planet 3",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}},{color:COLORS[3],name:"Planet 4",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}},{color:COLORS[4],name:"Planet 5",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}},{color:COLORS[5],name:"Planet 6",type:"line",visible:!1,showInLegend:!1,marker:{enabled:!1}}]}),$("#psplot").highcharts({chart:{type:"line"},tooltip:{enabled:!0,formatter:function(){return"Period: "+Math.pow(10,this.x).toFixed(4)+", power: "+this.y.toFixed(2)+"<br>Estimated false alarm probability: "+K.getFAPforPeriod(this.x).toPrecision(5)}},legend:{enabled:!1},title:{enabled:!1,text:""},xAxis:{title:{enabled:!0,text:"Period [d]"},labels:{formatter:function(){return Math.pow(10,this.value).toFixed(2)}}},yAxis:{title:{enabled:!0,text:"Power"},min:0},series:[{color:"black",type:"line",name:"Power",marker:{enabled:!1},turboThreshold:1},{color:"black",type:"line",lineWidth:1,dashStyle:"Dot",name:"black",marker:{enabled:!1,states:{hover:!1}},enableMouseTracking:!1},{color:"black",type:"line",lineWidth:1,dashStyle:"Dot",name:"FAP (10^-2)",marker:{enabled:!1,states:{hover:!1}},enableMouseTracking:!1},{color:"black",type:"line",lineWidth:1,dashStyle:"Dot",name:"FAP (10^-3)",marker:{enabled:!1,states:{hover:!1}},enableMouseTracking:!1}]}),$("#rvtabs a").click(function(e){e.preventDefault();var option=$(e.target).attr("href");return"#phased"==option&&0==K.getNplanets()?(uialert("Add a planet first.","#top-plot"),void 0):"#dynamical"==option&&K.getNplanets()<2?(uialert("You need to have at least two planets in the fit to see some dynamical interaction.","#top-plot"),void 0):($(this).tab("show"),$("#alert-short-period").hide(),$("#phased-toolbox").css("display","#phased"==option?"block":"none"),$("#dynamical-toolbox").css("display","#dynamical"==option?"block":"none"),K.setRVPlot($(e.target).attr("href")),void 0)}),$("#addPlanet").click(function(){K.addPlanet()}),$("#removePlanet").click(function(){K.removePlanet()}),$("#integrated").click(function(){$("#rv").click(),$("#phased").attr("enabled",!$(this).is(":checked")),K.setIntegrated($(this).is(":checked"))}),$("#stop").click(function(){K.stop()});for(var i=1;MAX_PLANETS>=i;i++)for(var j=0;MAX_ELEMENTS>j;j++){var s=$("#elementSlider_"+i+"_"+j);s.attr("min",EL_MIN_MAX[j][0]),s.attr("max",EL_MIN_MAX[j][1]),s.attr("step",.05),function(slider,timeout,i,j){var timer,trig=function(){K.refresh(["psplot"])};slider.bind("change",function(){timer&&clearTimeout(timer),timer=setTimeout(trig,timeout);var v=parseFloat(this.value);(0==j||1==j)&&(v=Math.pow(10,v)),K.setElement(i,j,v,!1)})}(s,1e3,i,j);var t=$("#element_"+i+"_"+j);t.keyup(function(i,j){return function(e){13==e.keyCode&&(e.preventDefault(),K.setElement(i,j,parseFloat(this.value)))}}(i,j)),t.blur(function(){K.refresh("elements")})}for(var i=0;MAX_SETS>i;i++){var l=$("#offsetLabel_"+i);l.css("color",COLORS[i]);var s=$("#offsetSlider_"+i);s.attr("min",-VOMAX),s.attr("max",VOMAX),s.attr("step",.05),function(slider,timeout,i){var timer,trig=function(){K.refresh(["psplot"])};slider.bind("change",function(){timer&&clearTimeout(timer),timer=setTimeout(trig,timeout);var v=parseFloat(this.value);K.setParam(i,v,!1)})}(s,2e3,i);var t=$("#offset_"+i);t.keyup(function(i){return function(e){13==e.keyCode&&(e.preventDefault(),K.setParam(i,parseFloat(this.value),!0))}}(i)),t.blur(function(){K.refresh("params")})}for(var help_ids=["help_top","help_rvplot","help_psplot","help_statistics","help_offsets","help_planets","help_orbit"],i=0;i<help_ids.length;i++)$("#"+help_ids[i]).popover({title:"Help",html:!0,placement:"auto top",content:helpdoc[help_ids[i]]});$("#zoomIn").click(function(){K.zoomInOut(1)}),$("#zoomOut").click(function(){K.zoomInOut(-1)}),$("#orbit-download").click(function(){var img=document.getElementById("orbitalplot").toDataURL("image/png");window.open(img,"_blank")}),$("#share").click(function(){this.select()}),$("#share-bookmark").click(function(){if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(document.title,window.location.href,"");else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(location.href,document.title);else{if(window.opera&&window.print)return this.title=document.title,!0;var na=navigator.userAgent.toLowerCase();-1!=na.indexOf("chrome")?uialert("Use 'Bookmark This Page...' from the menu to bookmark this fit.","#share-panel",-1):-1!=na.indexOf("mobile")?uialert("Use the Bookmark button to bookmark this fit.","#share-panel",-1):uialert("Use 'Add Bookmark...' from the menu to bookmark this fit.","#share-panel",-1)}return!0}),$("#share-email").click(function(){var url=$("#share").val(),star=_.parameter("sys").replace(".sys",""),mailurl="mailto:someone@email.com?subject="+encodeURIComponent("My fit for "+star)+"&body="+encodeURIComponent("Here's the link:\n\n"+url);window.location=mailurl,console.log(mailurl)}),$("#phased-planet").change(function(){var p=+$("#phased-planet").val();console.log("Phased planet: "+p),K.getNplanets()<p?(uialert("There is no planet "+p+" in the current fit.","#top-plot"),$("#phased-planet").val(1)):K.setPhasedPlanet(p)}),$("#dynamical-integrate").click(function(){if(K.getNplanets()<2)return uialert("There will be no dynamical interaction with fewer than two planets!","#top-plot"),void 0;var nyears=parseFloat($("#dynamical-years").val());K.integrateForward(nyears)}),$("#dynamical-plot").change(function(){K.setIntegratePlot($(this).prop("selectedIndex"))}),$("#ps-set").click(function(){var min=0|+$("#ps-from").val(),max=0|+$("#ps-to").val();return min>max||.01>min||.01>max||min>1e5||max>1e5?(uialert("Invalid range for periodogram.","#bottom-plot"),void 0):(min==max&&(max=min+1,$("#ps-to").val(max)),K.setPSRange(min,max),void 0)}),$("#ps-reset").click(function(){K.setPSRange(1,2e4)}),K.init(),_.parameter("sys")?($("#systems").select2("val",_.parameter("sys")),_.defer(function(){K.loadFromURL()}),about(_.parameter("sys"))):(K.resetSeries(),K.loadSys("14Her.sys"),about("14Her.sys")),$(window).resize(_.debounce(function(){$("#rvplot").highcharts().setSize($("#top-plot").width()-20,400),$("#psplot").highcharts().setSize($("#bottom-plot").width()-20,400)},300)),_.defer(function(){uialert("Welcome to Systemic Live!")})});